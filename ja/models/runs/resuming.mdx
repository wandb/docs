---
title: Run の再開
description: 一時停止または終了した W&B Run を再開する
---

run が停止またはクラッシュした場合の振る舞いを指定します。 run を再開したり、自動再開を有効にしたりするには、その run に関連付けられた一意の run ID を `id` パラメータで指定する必要があります。

```python
import wandb
# runを再開または新規作成するための初期化
with wandb.init(entity="<entity>", project="<project>", id="<run ID>", resume="<resume>") as run:
        # ここにトレーニングコードを記述
```

<Note>
W&B では、 run を保存する W&B Projects の名前を指定することを推奨しています。
</Note>

`resume` パラメータに以下のいずれかの 引数 を渡して、W&B の動作を決定します。いずれの場合も、W&B はまずその run ID が既に存在するかどうかを確認します。

| 引数 | 説明 | Run ID が存在する場合 | Run ID が存在しない場合 | ユースケース |
| --- | --- | -- | --| -- |
| `"must"` | 指定された run ID の run を必ず再開します。 | 同じ run ID で run を再開します。 | エラーを発生させます。 | 必ず同じ run ID を使用して run を再開したい場合。 |
| `"allow"`| run ID が存在すれば run を再開することを許可します。 | 同じ run ID で run を再開します。 | 指定された run ID で新しい run を初期化します。 | 既存の run を上書きせずに再開したい場合。 |
| `"never"`| 指定された run ID の run を再開することを許可しません。 | エラーを発生させます。 | 指定された run ID で新しい run を初期化します。 | |

{/* - `"must"`: run ID が存在する場合、W&B はその run ID で run を再開します。run ID が存在しない場合、W&B は何もしません。 
- `"allow"`: run ID が存在する場合、W&B はその run ID で run を再開します。run ID が存在しない場合、W&B は指定された run ID で新しい run を初期化します。
- `"never"`: run ID が存在する場合、W&B は何もしません。run ID が存在しない場合、W&B は指定された run ID で新しい run を開始します。 */}

また、`resume="auto"` を指定すると、W&B が自動的に run の再試行を試みるように設定できます。ただし、その場合は同じ ディレクトリー から run を再起動する必要があります。詳細については、[run の自動再開を有効にする](#enable-runs-to-automatically-resume) セクションを参照してください。

以下のすべての例において、 `<>` で囲まれた 値 は自身の環境に合わせて置き換えてください。

## 同じ run ID を使用して run を再開する
run が停止、クラッシュ、または失敗した場合、同じ run ID を使用して再開できます。そのためには、 run を初期化する際に以下を指定します。

* `resume` パラメータを `"must"` に設定する (`resume="must"`) 
* 停止またはクラッシュした run の run ID を指定する

{/* run を初期化する際に `resume` パラメータを `"must"` (`resume="must"`) に設定し、停止またはクラッシュした run の run ID を指定します。 */}

以下の コードスニペット は、W&B Python SDK でこれを行う方法を示しています。

```python
with wandb.init(entity="<entity>", project="<project>", id="<run ID>", resume="must") as run:
        # ここにトレーニングコードを記述
```

<Warning>
複数の プロセス が同時に同じ `id` を使用すると、予期しない結果が生じます。

複数の プロセス を管理する方法の詳細については、[分散トレーニング実験のログ記録](/models/track/log/distributed-training/) を参照してください。
</Warning>

## 既存の run を上書きせずに再開する
既存の run を上書きすることなく、停止またはクラッシュした run を再開します。これは、 プロセス が正常に終了しなかった場合に特に役立ちます。次に W&B を開始したとき、W&B は最後のステップから ログ 記録を開始します。

W&B で run を初期化する際に、`resume` パラメータを `"allow"` (`resume="allow"`) に設定します。停止またはクラッシュした run の run ID を指定してください。以下の コードスニペット は、W&B Python SDK でこれを行う方法を示しています。

```python
import wandb

with wandb.init(entity="<entity>", project="<project>", id="<run ID>", resume="allow") as run:
        # ここにトレーニングコードを記述
```


## run の自動再開を有効にする
以下の コードスニペット は、Python SDK または 環境 変数を使用して run の自動再開を有効にする方法を示しています。

<Tabs>
<Tab title="W&B Python SDK">
以下の コードスニペット は、Python SDK で W&B run ID を指定する方法を示しています。

`<>` で囲まれた 値 を自身のものに置き換えてください。

```python
with wandb.init(entity="<entity>", project="<project>", id="<run ID>", resume="<resume>") as run:
        # ここにトレーニングコードを記述
```
</Tab>
<Tab title="シェルスクリプト">
以下の例は、bash スクリプト で W&B の `WANDB_RUN_ID` 変数を指定する方法を示しています。

```bash title="run_experiment.sh"
RUN_ID="$1"

WANDB_RESUME=allow WANDB_RUN_ID="$RUN_ID" python eval.py
```
ターミナル から、W&B run ID と共に シェルスクリプト を実行できます。以下の コードスニペット は run ID `akj172` を渡しています。

```bash
sh run_experiment.sh akj172 
```
</Tab>
</Tabs>


<Warning>
自動再開は、失敗した プロセス と同じファイルシステム上で プロセス が再起動された場合にのみ機能します。
</Warning>


例えば、`Users/AwesomeEmployee/Desktop/ImageClassify/training/` という ディレクトリー で `train.py` という python スクリプト を実行するとします。`train.py` 内で、自動再開を有効にした run が作成されます。次に、トレーニングスクリプト が停止したとします。この run を再開するには、`Users/AwesomeEmployee/Desktop/ImageClassify/training/` 内で `train.py` スクリプト を再起動する必要があります。


<Note>
ファイルシステムを共有できない場合は、`WANDB_RUN_ID` 環境 変数を指定するか、W&B Python SDK で run ID を渡してください。run ID の詳細については、「run とは何か」ページの [カスタム run ID](./#custom-run-ids) セクションを参照してください。
</Note>





## プリエンプティブルな Sweeps run の再開
中断された [sweep](/models/sweeps/) run を自動的にキューに戻します。これは、SLURM ジョブのプリエンプティブルキュー、EC2 スポットインスタンス、Google Cloud プリエンプティブル VM など、プリエンプション（中断）が発生する可能性のある計算 環境 で sweep agent を実行する場合に特に便利です。

[`mark_preempting`](/models/ref/python/experiments/run#mark_preempting) 関数を使用して、中断された sweep run を自動的に再キューイングします。例：

```python
with wandb.init() as run:
    run.mark_preempting()
```
以下の表は、 sweep run の終了ステータスに基づいて W&B が run をどのように処理するかを示しています。

| ステータス | 振る舞い |
|------| ---------|
| ステータスコード 0 | run は正常に終了したとみなされ、再キューイングされません。 |
| 0 以外のステータス | W&B は自動的に sweep に関連付けられた run キューに run を追加します。 |
| ステータスなし | run が sweep run キューに追加されます。 sweep agent はキューが空になるまで run を消費します。キューが空になると、 sweep キューは sweep 探索アルゴリズムに基づいて新しい run の生成を再開します。 |