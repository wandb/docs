---
title: クエリ パネル の概要
description: このページの一部の機能はベータ版であり、機能フラグによって非表示になっています。関連するすべての機能をアンロックするには、プロフィールページのバイオ（自己紹介欄）に
  `weave-plot` を追加してください。
---

<Note>
W&B Weave（Generative AI アプリケーション構築のための W&B ツールスイート）をお探しですか？ Weave のドキュメントはこちらで確認できます： [wandb.me/weave](https://wandb.github.io/weave/?utm_source=wandb_docs&utm_medium=docs&utm_campaign=weave-nudge)
</Note>

クエリパネルを使用すると、データをクエリし、インタラクティブに可視化できます。

<Frame>
    <img src="/images/weave/pretty_panel.png" alt="Query panel"  />
</Frame>

{/* <Note>
このチームがクエリパネルを使用してベンチマークをどのように可視化したかについては、[Keras XLA benchmark report](http://wandb.me/keras-xla-benchmark) を参照してください。
</Note> */}

## クエリパネルの作成

Workspace または Report 内にクエリを追加します。

<Tabs>
<Tab title="Project workspace">
1. プロジェクトの Workspace に移動します。
2. 右上隅にある `Add panel` をクリックします。
3. ドロップダウンから `Query panel` を選択します。
</Tab>
<Tab title="W&B Report">
`/Query panel` と入力して選択します。

<Frame>
    <img src="/images/weave/add_weave_panel_report_1.png" alt="Query panel option"  />
</Frame>

または、一連の Runs にクエリを関連付けることもできます：
1. Report 内で `/Panel grid` と入力して選択します。
2. `Add panel` ボタンをクリックします。
3. ドロップダウンから `Query panel` を選択します。
</Tab>
</Tabs>
  

## クエリの構成要素

### 式 (Expressions)

クエリ式を使用して、Runs、Artifacts、Models、Tables など、W&B に保存されているデータをクエリします。

#### 例： テーブルをクエリする
W&B Table をクエリしたいとします。トレーニングコードで `"cifar10_sample_table"` という名前のテーブルをログに記録します。

```python
import wandb
# runを初期化してテーブルをログ記録
with wandb.init() as run:
  run.log({"cifar10_sample_table":<MY_TABLE>})
```

クエリパネル内では、以下の式でテーブルをクエリできます：
```python
runs.summary["cifar10_sample_table"]
```
<Frame>
    <img src="/images/weave/basic_weave_expression.png" alt="Table query expression"  />
</Frame>

詳細な解説：

* `runs` は、Query Panel が Workspace にある場合に、クエリ式に自動的に注入される変数です。その「値」は、その特定の Workspace で表示されている Runs のリストです。[Run 内で使用可能なさまざまな属性についてはこちらをご覧ください](/models/track/public-api-guide/#understanding-the-different-attributes)。
* `summary` は、Run の Summary オブジェクトを返す op（オペレーション）です。Ops は _マップ (mapped)_ されます。つまり、この op はリスト内の各 Run に適用され、結果として Summary オブジェクトのリストが返されます。
* `["cifar10_sample_table"]` は、ブラケットで示される Pick op で、パラメータとして `predictions` を取ります。Summary オブジェクトは辞書やマップのように動作するため、この操作は各 Summary オブジェクトから `predictions` フィールドを抽出（ピック）します。

インタラクティブに独自のクエリを作成する方法を学ぶには、[Query panel demo](https://wandb.ai/luis_team_test/weave_example_queries/reports/Weave-queries---Vmlldzo1NzIxOTY2?accessToken=bvzq5hwooare9zy790yfl3oitutbvno2i6c2s81gk91750m53m2hdclj0jvryhcr) を参照してください。

### 設定 (Configurations)

パネルの左上隅にあるギアアイコンを選択して、クエリ設定を展開します。これにより、パネルのタイプや結果パネルのパラメータを設定できます。

<Frame>
    <img src="/images/weave/weave_panel_config.png" alt="Panel configuration menu"  />
</Frame>

### 結果パネル (Result panels)

最後に、クエリ結果パネルは、選択されたクエリパネルを使用し、設定に従ってクエリ式の結果をインタラクティブな形式でレンダリングします。以下の画像は、同じデータを Table と Plot で表示した例です。

<Frame>
    <img src="/images/weave/result_panel_table.png" alt="Table result panel"  />
</Frame>

<Frame>
    <img src="/images/weave/result_panel_plot.png" alt="Plot result panel"  />
</Frame>

## 基本操作
以下は、クエリパネル内で行える一般的な操作です。
### ソート (Sort)
カラムオプションからソートします：
<Frame>
    <img src="/images/weave/weave_sort.png" alt="Column sort options"  />
</Frame>

### フィルタ (Filter)
クエリ内で直接フィルタリングするか、左上隅にあるフィルタボタン（2番目の画像）を使用してフィルタリングできます。
<Frame>
    <img src="/images/weave/weave_filter_1.png" alt="Query filter syntax"  />
</Frame>
<Frame>
    <img src="/images/weave/weave_filter_2.png" alt="Filter button"  />
</Frame>

### マップ (Map)
マップ操作はリストを反復処理し、データの各要素に関数を適用します。これはクエリで直接行うか、カラムオプションから新しいカラムを挿入することで行えます。
<Frame>
    <img src="/images/weave/weave_map.png" alt="Map operation query"  />
</Frame>
<Frame>
    <img src="/images/weave/weave_map.gif" alt="Map column insertion"  />
</Frame>

### グループ化 (Groupby)
クエリを使用するか、カラムオプションからグループ化できます。
<Frame>
    <img src="/images/weave/weave_groupby.png" alt="Group by query"  />
</Frame>
<Frame>
    <img src="/images/weave/weave_groupby.gif" alt="Group by column options"  />
</Frame>

### 結合 (Concat)
concat 操作では、2つのテーブルを連結できます。パネル設定から連結や結合を行うことが可能です。
<Frame>
    <img src="/images/weave/weave_concat.gif" alt="Table concatenation"  />
</Frame>

### 結合 (Join)
クエリ内で直接テーブルを結合（Join）することも可能です。以下のクエリ式を考えてみましょう：
```python
project("luis_team_test", "weave_example_queries").runs.summary["short_table_0"].table.rows.concat.join(\
project("luis_team_test", "weave_example_queries").runs.summary["short_table_1"].table.rows.concat,\
(row) => row["Label"],(row) => row["Label"], "Table1", "Table2",\
"false", "false")
```
<Frame>
    <img src="/images/weave/weave_join.png" alt="Table join operation"  />
</Frame>

左側のテーブルは以下から生成されます：
```python
project("luis_team_test", "weave_example_queries").\
runs.summary["short_table_0"].table.rows.concat.join
```
右側のテーブルは以下から生成されます：
```python
project("luis_team_test", "weave_example_queries").\
runs.summary["short_table_1"].table.rows.concat
```
ここで：
* `(row) => row["Label"]` は各テーブルのセレクターで、どのカラムで結合するかを決定します。
* `"Table1"` と `"Table2"` は結合された後の各テーブルの名前です。
* `true` と `false` は、左および右の内部/外部結合の設定です。


## Runs オブジェクト
クエリパネルを使用して `runs` オブジェクトにアクセスします。Run オブジェクトには実験の記録が保存されています。詳細は [Accessing runs object](https://wandb.ai/luis_team_test/weave_example_queries/reports/Weave-queries---Vmlldzo1NzIxOTY2?accessToken=bvzq5hwooare9zy790yfl3oitutbvno2i6c2s81gk91750m53m2hdclj0jvryhcr#3.-accessing-runs-object) で確認できますが、概要として `runs` オブジェクトでは以下のものが利用可能です：
* `summary`: Run の結果を要約する情報の辞書。これは accuracy や loss のようなスカラー値、あるいは大きなファイルである場合もあります。デフォルトでは、`wandb.Run.log()` はサマリーをログ記録された時系列データの最終値に設定します。サマリーの内容を直接設定することもできます。サマリーは Run の「出力」と考えてください。
* `history`: loss のようにモデルのトレーニング中に変化する値を保存するための辞書のリスト。`wandb.Run.log()` コマンドはこのオブジェクトにデータを追加します。
* `config`: トレーニング Run のハイパーパラメーターや、データセット Artifact を作成する Run のプロセッシングメソッドなど、Run の設定情報の辞書。これらは Run の「入力」と考えてください。
<Frame>
    <img src="/images/weave/weave_runs_object.png" alt="Runs object structure"  />
</Frame>

## Artifacts へのアクセス

Artifacts は W&B の中核となるコンセプトです。これらはバージョン管理された、名前付きのファイルやディレクトリーのコレクションです。Artifacts を使用して、モデルの重み、データセット、その他のファイルやディレクトリーを追跡します。Artifacts は W&B に保存され、ダウンロードしたり他の Runs で使用したりできます。詳細と例については [Accessing artifacts](https://wandb.ai/luis_team_test/weave_example_queries/reports/Weave-queries---Vmlldzo1NzIxOTY2?accessToken=bvzq5hwooare9zy790yfl3oitutbvno2i6c2s81gk91750m53m2hdclj0jvryhcr#4.-accessing-artifacts) を参照してください。Artifacts は通常、`project` オブジェクトからアクセスされます：
* `project.artifactVersion()`: プロジェクト内の指定された名前とバージョンの特定の Artifact バージョンを返します。
* `project.artifact("")`: プロジェクト内の指定された名前の Artifact を返します。その後、`.versions` を使用して、この Artifact の全バージョンのリストを取得できます。
* `project.artifactType()`: プロジェクト内の指定された名前の `artifactType` を返します。その後、`.artifacts` を使用して、このタイプを持つ全 Artifacts のリストを取得できます。
* `project.artifactTypes`: プロジェクト配下のすべての Artifact タイプのリストを返します。
<Frame>
    <img src="/images/weave/weave_artifacts.png" alt="Artifact access methods"  />
</Frame>