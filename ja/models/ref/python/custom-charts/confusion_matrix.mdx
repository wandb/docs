---
title: confusion_matrix()
namespace: python_sdk_custom_charts
python_object_type: function
---
import { GitHubLink } from '/snippets/en/_includes/github-source-link.mdx';

<GitHubLink url="https://github.com/wandb/wandb/blob/main/wandb/plot/confusion_matrix.py" />

### <kbd>function</kbd> `confusion_matrix`

```python
confusion_matrix(
    probs: 'Sequence[Sequence[float]] | None' = None,
    y_true: 'Sequence[T] | None' = None,
    preds: 'Sequence[T] | None' = None,
    class_names: 'Sequence[str] | None' = None,
    title: 'str' = 'Confusion Matrix Curve',
    split_table: 'bool' = False
) → CustomChart
```

一連の確率または予測値から混同行列（confusion matrix）を作成します。

**Args:**

 - `probs`: 各クラスの予測確率のシーケンス。形状は (N, K) である必要があります。ここで N はサンプル数、K はクラス数です。これが指定された場合、`preds` は指定しないでください。
 - `y_true`: 正解ラベルのシーケンス。
 - `preds`: 予測されたクラスラベルのシーケンス。これが指定された場合、`probs` は指定しないでください。
 - `class_names`: クラス名のシーケンス。指定されない場合、クラス名は "Class_1"、"Class_2" などのように定義されます。
 - `title`: 混同行列チャートのタイトル。
 - `split_table`: テーブルを W&B UI 上で別のセクションに分割するかどうか。`True` の場合、テーブルは "Custom Chart Tables" という名前のセクションに表示されます。デフォルトは `False` です。

**Returns:**

 - `CustomChart`: W&B にログを記録できるカスタムチャートオブジェクト。チャートをログに記録するには、`wandb.log()` に渡します。

**Raises:**

 - `ValueError`: `probs` と `preds` の両方が指定された場合、または予測数と正解ラベル数が一致しない場合。また、ユニークな予測クラス数がクラス名リストの数を超えた場合、またはユニークな正解ラベル数がクラス名リストの数を超えた場合。
 - `wandb.Error`: numpy がインストールされていない場合。

**Examples:**

野生動物の分類のために、ランダムな確率を使用して混同行列をログに記録する例：

```python
import numpy as np
import wandb

# 野生動物のクラス名を定義
wildlife_class_names = ["Lion", "Tiger", "Elephant", "Zebra"]

# ランダムな正解ラベルを生成 (10サンプルに対して 0 から 3)
wildlife_y_true = np.random.randint(0, 4, size=10)

# 各クラスのランダムな確率を生成 (10サンプル x 4クラス)
wildlife_probs = np.random.rand(10, 4)
wildlife_probs = np.exp(wildlife_probs) / np.sum(
    np.exp(wildlife_probs),
    axis=1,
    keepdims=True,
)

# W&B run を初期化し、混同行列をログに記録
with wandb.init(project="wildlife_classification") as run:
    confusion_matrix = wandb.plot.confusion_matrix(
         probs=wildlife_probs,
         y_true=wildlife_y_true,
         class_names=wildlife_class_names,
         title="Wildlife Classification Confusion Matrix",
    )
    run.log({"wildlife_confusion_matrix": confusion_matrix})
```

この例では、ランダムな確率を使用して混同行列が生成されます。

シミュレーションされたモデル予測と 85% の精度で混同行列をログに記録する例：

```python
import numpy as np
import wandb

# 野生動物のクラス名を定義
wildlife_class_names = ["Lion", "Tiger", "Elephant", "Zebra"]

# 200枚の動物画像に対する正解ラベルをシミュレート (不均衡な分布)
wildlife_y_true = np.random.choice(
    [0, 1, 2, 3],
    size=200,
    p=[0.2, 0.3, 0.25, 0.25],
)

# 85% の精度を持つモデル予測をシミュレート
wildlife_preds = [
    y_t
    if np.random.rand() < 0.85
    else np.random.choice([x for x in range(4) if x != y_t])
    for y_t in wildlife_y_true
]

# W&B run を初期化し、混同行列をログに記録
with wandb.init(project="wildlife_classification") as run:
    confusion_matrix = wandb.plot.confusion_matrix(
         preds=wildlife_preds,
         y_true=wildlife_y_true,
         class_names=wildlife_class_names,
         title="Simulated Wildlife Classification Confusion Matrix",
    )
    run.log({"wildlife_confusion_matrix": confusion_matrix})
```

この例では、混同行列を生成するために、85% の精度で予測がシミュレートされています。