---
title: Evaluations ã¸ã®ã‚¤ãƒ³ãƒˆãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³
description: W&B Weave ã‚’ä½¿ç”¨ã—ãŸ è©•ä¾¡ (Evaluations) ã® ã‚¤ãƒ³ãƒˆãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ (intro) ã«ã¤ã„ã¦å­¦ç¿’ã—ã¾ã™
---

<Note>
ã“ã‚Œã¯å¯¾è©±å‹ã® ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ ã§ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã™ã‚‹ã‹ã€ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
- [Google Colab ã§é–‹ã](https://colab.research.google.com/github/wandb/docs/blob/main/weave/cookbooks/source/Intro_to_Weave_Hello_Eval.ipynb)
- [GitHub ã§ã‚½ãƒ¼ã‚¹ã‚’è¡¨ç¤º](https://github.com/wandb/docs/blob/main/weave/cookbooks/source/Intro_to_Weave_Hello_Eval.ipynb)
</Note>

## ğŸ”‘ äº‹å‰æº–å‚™

Weave ã®è©•ä¾¡ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã€ä»¥ä¸‹ã®æº–å‚™ã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚

1. W&B Weave SDK ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€ [APIã‚­ãƒ¼](https://wandb.ai/settings#apikeys) ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚
2. OpenAI SDK ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€ [APIã‚­ãƒ¼](https://platform.openai.com/api-keys) ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚
3. W&B ã® Projects ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚

```python lines
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
!pip install wandb weave openai -q

import os
from getpass import getpass

from openai import OpenAI
from pydantic import BaseModel

import weave

# ğŸ”‘ APIã‚­ãƒ¼ã®è¨­å®š
# ã“ã®ã‚»ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ã¨ getpass ã«ã‚ˆã‚Š APIã‚­ãƒ¼ ã®å…¥åŠ›ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚å…¥åŠ›å†…å®¹ã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚
#####
print("---")
print(
    "W&B APIã‚­ãƒ¼ã®ä½œæˆã¯ã“ã¡ã‚‰: https://wandb.ai/settings#apikeys"
)
os.environ["WANDB_API_KEY"] = getpass("W&B APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: ")
print("---")
print("OpenAI APIã‚­ãƒ¼ã¯ã“ã¡ã‚‰ã§ç”Ÿæˆã§ãã¾ã™: https://platform.openai.com/api-keys")
os.environ["OPENAI_API_KEY"] = getpass("OpenAI APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: ")
print("---")
#####

# ğŸ  W&B ã® ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ åã‚’å…¥åŠ›
weave_client = weave.init("MY_PROJECT_NAME")  # ğŸ ã‚ãªãŸã® W&B ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ å
```

## ğŸ åˆã‚ã¦ã®è©•ä¾¡ã‚’å®Ÿè¡Œã™ã‚‹

ä»¥ä¸‹ã® ã‚³ãƒ¼ãƒ‰ ã‚µãƒ³ãƒ—ãƒ«ã¯ã€ Weave ã® `Model` ãŠã‚ˆã³ `Evaluation` API ã‚’ä½¿ç”¨ã—ã¦ LLM ã‚’è©•ä¾¡ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ã¾ãšã€ `weave.Model` ã‚’ç¶™æ‰¿ã—ã¦ Weave ã® Models ã‚’å®šç¾©ã—ã€ ãƒ¢ãƒ‡ãƒ« åã¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå½¢å¼ã‚’æŒ‡å®šã—ã¦ã€ `@weave.op` ã§ `predict` ãƒ¡ã‚½ãƒƒãƒ‰ ã‚’ãƒˆãƒ¬ãƒ¼ã‚¹ã—ã¾ã™ã€‚ `predict` ãƒ¡ã‚½ãƒƒãƒ‰ ã¯ OpenAI ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é€ä¿¡ã—ã€ Pydantic ã‚¹ã‚­ãƒ¼ãƒï¼ˆ `FruitExtract` ï¼‰ã‚’ä½¿ç”¨ã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ§‹é€ åŒ–ã•ã‚ŒãŸå‡ºåŠ›ã«ãƒ‘ãƒ¼ã‚¹ã—ã¾ã™ã€‚æ¬¡ã«ã€å…¥åŠ›æ–‡ã¨æœŸå¾…ã•ã‚Œã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§æ§‹æˆã•ã‚Œã‚‹å°ã•ãªè©•ä¾¡ç”¨ Datasets ã‚’ä½œæˆã—ã¾ã™ã€‚ç¶šã„ã¦ã€ ãƒ¢ãƒ‡ãƒ« ã®å‡ºåŠ›ã¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ©ãƒ™ãƒ«ã‚’æ¯”è¼ƒã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°é–¢æ•°ï¼ˆã“ã‚Œã‚‚ `@weave.op` ã§ãƒˆãƒ¬ãƒ¼ã‚¹ï¼‰ã‚’å®šç¾©ã—ã¾ã™ã€‚æœ€å¾Œã«ã€ã™ã¹ã¦ã‚’ `weave.Evaluation` ã«ãƒ©ãƒƒãƒ—ã—ã€ Datasets ã¨ã‚¹ã‚³ã‚¢ãƒ©ãƒ¼ã‚’æŒ‡å®šã—ã¦ã€ `evaluate()` ã‚’å‘¼ã³å‡ºã—ã€è©•ä¾¡ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ ã‚’éåŒæœŸã§å®Ÿè¡Œã—ã¾ã™ã€‚

```python lines
# 1. Weave ãƒ¢ãƒ‡ãƒ«ã‚’æ§‹ç¯‰
class FruitExtract(BaseModel):
    fruit: str
    color: str
    flavor: str

class ExtractFruitsModel(weave.Model):
    model_name: str
    prompt_template: str

    @weave.op()
    def predict(self, sentence: str) -> dict:
        client = OpenAI()

        response = client.beta.chat.completions.parse(
            model=self.model_name,
            messages=[
                {
                    "role": "user",
                    "content": self.prompt_template.format(sentence=sentence),
                }
            ],
            response_format=FruitExtract,
        )
        result = response.choices[0].message.parsed
        return result

model = ExtractFruitsModel(
    name="gpt4o",
    model_name="gpt-4o",
    prompt_template='Extract fields ("fruit": <str>, "color": <str>, "flavor": <str>) as json, from the following text : {sentence}',
)

# 2. ã‚µãƒ³ãƒ—ãƒ«ã‚’é›†ã‚ã‚‹
sentences = [
    "There are many fruits that were found on the recently discovered planet Goocrux. There are neoskizzles that grow there, which are purple and taste like candy.",
    "Pounits are a bright green color and are more savory than sweet.",
    "Finally, there are fruits called glowls, which have a very sour and bitter taste which is acidic and caustic, and a pale orange tinge to them.",
]
labels = [
    {"fruit": "neoskizzles", "color": "purple", "flavor": "candy"},
    {"fruit": "pounits", "color": "green", "flavor": "savory"},
    {"fruit": "glowls", "color": "orange", "flavor": "sour, bitter"},
]
examples = [
    {"id": "0", "sentence": sentences[0], "target": labels[0]},
    {"id": "1", "sentence": sentences[1], "target": labels[1]},
    {"id": "2", "sentence": sentences[2], "target": labels[2]},
]

# 3. è©•ä¾¡ã®ãŸã‚ã®ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°é–¢æ•°ã‚’å®šç¾©
@weave.op()
def fruit_name_score(target: dict, output: FruitExtract) -> dict:
    target_flavors = [f.strip().lower() for f in target["flavor"].split(",")]
    output_flavors = [f.strip().lower() for f in output.flavor.split(",")]
    # ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ã®ã„ãšã‚Œã‹ãŒå‡ºåŠ›ã®ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    matches = any(tf in of for tf in target_flavors for of in output_flavors)
    return {"correct": matches}

# 4. è©•ä¾¡ã‚’å®Ÿè¡Œ
evaluation = weave.Evaluation(
    name="fruit_eval",
    dataset=examples,
    scorers=[fruit_name_score],
)
await evaluation.evaluate(model)
```

## ğŸš€ ä»–ã®ä¾‹ã‚’ãŠæ¢ã—ã§ã™ã‹ï¼Ÿ

- [è©•ä¾¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã§æ§‹ç¯‰ã™ã‚‹æ–¹æ³•](/weave/tutorial-eval) ã‚’å­¦ã¶ã€‚
- [RAGã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã—ã¦è©•ä¾¡ã™ã‚‹æ–¹æ³•](/weave/tutorial-rag) ã‚’å­¦ã¶ã€‚