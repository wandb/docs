---
title: OIDC を使用した SSO の設定
---

W&B ServerがOpenID Connect (OIDC) 互換のアイデンティティプロバイダーをサポートしていることで、Okta、Keycloak、Auth0、Google、Entraなどの外部アイデンティティプロバイダーを通じて、ユーザーアイデンティティとグループメンバーシップの管理が可能になります。

## OpenID Connect (OIDC)

W&B Serverは、外部アイデンティティプロバイダー (IdP) と統合するために、以下のOIDC認証フローをサポートしています。
1. Implicit Flow with Form Post 
2. Authorization Code Flow with Proof Key for Code Exchange (PKCE)

これらのフローはユーザーを認証し、アクセス制御を管理するために必要なアイデンティティ情報（IDトークンの形式）をW&B Serverに提供します。

IDトークンは、ユーザーの名前、ユーザー名、メールアドレス、グループメンバーシップなどのアイデンティティ情報を含むJWTです。W&B Serverはこのトークンを使用してユーザーを認証し、システム内の適切なロールやグループにマッピングします。

W&B Serverのコンテキストにおいて、アクセストークンはユーザーに代わってAPIへのリクエストを認可するものですが、W&B Serverの主な関心事はユーザー認証とアイデンティティであるため、IDトークンのみを必要とします。

環境変数を使用して、 [専用クラウド](/platform/hosting/hosting-options/dedicated_cloud) または [Self-Managed](/platform/hosting/hosting-options/self-managed) インスタンスの [IAMオプションを設定](/platform/hosting/iam/advanced_env_vars/) することができます。

[専用クラウド](/platform/hosting/hosting-options/dedicated_cloud) または [Self-Managed](/platform/hosting/hosting-options/self-managed) のW&B Serverインストールにおけるアイデンティティプロバイダーの設定を支援するため、各種IdP向けの以下のガイドラインに従ってください。SaaS バージョンのW&Bを使用している場合は、組織用のAuth0テナント設定のサポートについて [support@wandb.com](mailto:support@wandb.com) までお問い合わせください。

<Tabs>
<Tab title="Cognito">
AWS Cognitoを認可のためにセットアップするには、以下の手順に従ってください。

1. まず、AWSアカウントにサインインし、 [AWS Cognito](https://aws.amazon.com/cognito/) アプリに移動します。

    <Frame>
    <img src="/images/hosting/setup_aws_cognito.png" alt="AWS Cognito setup"  />
    </Frame>

2. IdPでアプリケーションを設定するために、許可されたコールバックURLを指定します。
     * コールバックURLとして `http(s)://YOUR-W&B-HOST/oidc/callback` を追加します。`YOUR-W&B-HOST` を実際のW&Bホストパスに置き換えてください。

3. IdPがユニバーサルログアウトをサポートしている場合は、ログアウトURLを `http(s)://YOUR-W&B-HOST` に設定します。`YOUR-W&B-HOST` を実際のW&Bホストパスに置き換えてください。

    例えば、アプリケーションが `https://wandb.mycompany.com` で動作している場合、 `YOUR-W&B-HOST` を `wandb.mycompany.com` に置き換えます。

    以下の画像は、AWS Cognitoで許可されたコールバックURLとサインアウトURLを指定する方法を示しています。

    <Frame>
    <img src="/images/hosting/setup_aws_cognito_ui_settings.png" alt="Host configuration"  />
    </Frame>

    _wandb/local_ は、デフォルトで [`implicit` grant with the `form_post` response type](https://auth0.com/docs/get-started/authentication-and-authorization-flow/implicit-flow-with-form-post) を使用します。 

    また、 [PKCE Code Exchange](https://www.oauth.com/oauth2-servers/pkce/) フローを使用する `authorization_code` grantを実行するように _wandb/local_ を設定することもできます。 

4. AWS Cognitoがアプリにトークンを配信する方法を設定するために、1つ以上のOAuth grant typeを選択します。
5. W&Bは特定のOpenID Connect (OIDC) スコープを必要とします。AWS Cognitoアプリから以下を選択してください。
    * "openid" 
    * "profile"
    * "email"

    例えば、AWS CognitoアプリのUIは以下の画像のようになります。

    <Frame>
    <img src="/images/hosting/setup_aws_required_fields.png" alt="Required fields"  />
    </Frame>

    設定ページの **Auth Method** を選択するか、環境変数 `OIDC_AUTH_METHOD` を設定して、 _wandb/local_ にどのgrantを使用するか伝えます。

    Auth Methodは `pkce` に設定する必要があります。

6. クライアントIDとOIDC発行者（issuer）のURLが必要です。OpenIDディスカバリドキュメントは `$OIDC_ISSUER/.well-known/openid-configuration` で利用可能である必要があります。

    例えば、 **User Pools** セクション内の **App Integration** タブから、Cognito IdP URLにユーザープールIDを付加することで発行者URLを生成できます。

    <Frame>
    <img src="/images/hosting/setup_aws_cognito_issuer_url.png" alt="AWS Cognito issuer URL"  />
    </Frame>

    IDP URLには "Cognito domain" を使用しないでください。Cognitoはディスカバリドキュメントを `https://cognito-idp.$REGION.amazonaws.com/$USER_POOL_ID` で提供します。
</Tab>
<Tab title="Okta">
Oktaを認可のためにセットアップするには、以下の手順に従ってください。

1. [Okta Portal](https://login.okta.com/) にログインします。

2. 左側で **Applications** を選択し、再度 **Applications** を選択します。
    <Frame>
    <img src="/images/hosting/okta_select_applications.png" alt="Okta Applications menu"  />
    </Frame>

3. "Create App integration" をクリックします。
    <Frame>
    <img src="/images/hosting/okta_create_new_app_integration.png" alt="Create App integration button"  />
    </Frame>

4. "Create a new app integration" 画面で、 **OIDC - OpenID Connect** と **Single-Page Application** を選択し、 "Next" をクリックします。
    <Frame>
    <img src="/images/hosting/okta_create_a_new_app_integration.png" alt="OIDC Single-Page Application selection"  />
    </Frame>

5. "New Single-Page App Integration" 画面で、以下の値を入力して **Save** をクリックします。
    - App integration name: 例 "W&B"
    - Grant type: **Authorization Code** と **Implicit (hybrid)** の両方を選択
    - Sign-in redirect URIs: https://YOUR_W_AND_B_URL/oidc/callback
    - Sign-out redirect URIs: https://YOUR_W_AND_B_URL/logout
    - Assignments: **Skip group assignment for now** を選択
    <Frame>
    <img src="/images/hosting/okta_new_single_page_app_integration.png" alt="Single-Page App configuration"  />
    </Frame>

6. 作成したOktaアプリケーションの概要画面で、 **General** タブの **Client Credentials** にある **Client ID** をメモします。
    <Frame>
    <img src="/images/hosting/okta_make_note_of_client_id.png" alt="Okta Client ID location"  />
    </Frame>

7. Okta OIDC Issuer URLを確認するには、左側の **Settings** から **Account** を選択します。
    Okta UIの **Organization Contact** の下に会社名が表示されます。
    <Frame>
    <img src="/images/hosting/okta_identify_oidc_issuer_url.png" alt="Okta organization settings"  />
    </Frame>

OIDC issuer URLの形式は `https://COMPANY.okta.com` です。COMPANYを対応する値に置き換えて、メモしておいてください。
</Tab>
<Tab title="Entra">
1. [Azure Portal](https://portal.azure.com/) にログインします。

2. **Microsoft Entra ID** サービスに移動し、左サイドバーから **App registrations** を選択します。

3. ページ上部の **New registration** をクリックします。

4. "Register an application" 画面で、以下を設定します。
   - **Name**: わかりやすい名前を入力（例: "Weights and Biases application"）
   - **Supported account types**: デフォルトの "Single tenant" のままにするか、必要に応じて変更
   - **Redirect URI**: プラットフォームの種類で **Single-page application** を選択し、 `https://YOUR_W_AND_B_URL/oidc/callback` を入力
   - **Register** をクリック

5. 登録後、概要ページから以下の値をメモします。
   - **Application (client) ID** - これがOIDCクライアントIDです
   - **Directory (tenant) ID** - OIDC発行者URLに使用されます

   <Frame>
   <img src="/images/hosting/entra_app_overview_make_note.png" alt="Application and Directory IDs"  />
   </Frame>

6. 認証設定を行います。
   - 左サイドバーから **Authentication** を選択
   - **Front-channel logout URL** に `https://YOUR_W_AND_B_URL/logout` を入力
   - **Save** をクリック

7. クライアントシークレットを作成します。
   - 左サイドバーから **Certificates & secrets** を選択
   - **New client secret** をクリック
   - 説明を入力（例: "wandb"）
   - 有効期限を選択
   - **Add** をクリック
   - **重要**: シークレットの **Value** （Secret IDではなく）をすぐにコピーして保存してください

   <Frame>
   <img src="/images/hosting/entra_make_note_of_secret_value.png" alt="Client secret value"  />
   </Frame>

これで、以下の3つの必須データが揃いました。
- **OIDC Client ID**: ステップ5のアプリケーション (クライアント) ID
- **OIDC Client Secret**: ステップ7のシークレットの値
- **OIDC Issuer URL**: `https://login.microsoftonline.com/{TenantID}/v2.0` （{TenantID}をステップ5のディレクトリIDに置き換えてください）

<Note>
v2.0 エンドポイントは、個人のMicrosoftアカウントと職場/学校アカウントの両方をサポートしています。組織で v1.0 エンドポイントが必要な場合は、代わりに `https://login.microsoftonline.com/{TenantID}` を使用してください。
</Note>

W&B Serverを設定する際は、以下を使用してください。
- **Auth Method**: `pkce` （Entra IDに推奨）
- **OIDC Client Secret**: Entra IDアプリケーションには必須です
</Tab>
</Tabs>

## W&B ServerでのSSO設定

SSOをセットアップするには、管理者権限と以下の情報が必要です。
- OIDC Client ID
- OIDC Auth method (`implicit` または `pkce`)
- OIDC Issuer URL
- OIDC Client Secret（オプション。IdPの設定によります）

IdPがOIDC Client Secretを必要とする場合は、 [環境変数](/platform/hosting/env-vars) `GORILLA_OIDC_SECRET` を渡して指定します。
- UIでは、 **System Console** > **Settings** > **Advanced** > **User Spec** に移動し、以下のように `extraENV` セクションに `GORILLA_OIDC_SECRET` を追加します。
- Helmでは、以下のように `values.global.extraEnv` を設定します。

```yaml
values:
  global:
    extraEnv:
      GORILLA_OIDC_SECRET="<your_secret>"
```

<Note>
SSOの設定後にインスタンスにログインできなくなった場合は、環境変数 `LOCAL_RESTORE=true` を設定してインスタンスを再起動できます。これにより、コンテナログに一時パスワードが出力され、SSOが無効になります。SSOの問題を解決したら、SSOを再度有効にするためにその環境変数を削除する必要があります。
</Note>

<Tabs>
<Tab title="System Console">
System ConsoleはSystem Settingsページの後継です。 [W&B Kubernetes Operator](/platform/hosting/operator/) ベースのデプロイメントで利用可能です。

1. [Access the W&B Management Console](/platform/hosting/operator/#access-the-wb-management-console) を参照してください。

2. **Settings** に移動し、 **Authentication** を選択します。 **Type** ドロップダウンで **OIDC** を選択します。
    <Frame>
    <img src="/images/hosting/sso_configure_via_console.png" alt="System Console OIDC configuration"  />
    </Frame>

3. 各値を入力します。

4. **Save** をクリックします。

5. ログアウトしてから再度ログインし、今度はIdPのログイン画面を使用します。

## カスタマーネームスペースの確認

W&B 専用クラウド または Self-Managed で CoreWeave ストレージを使用したチームレベルの BYOB を設定する前に、組織の **カスタマーネームスペース** を取得する必要があります。これは **Authentication** タブの下部で確認およびコピーできます。

カスタマーネームスペースを使用した CoreWeave ストレージの設定に関する詳細な手順については、 [CoreWeave requirements for Dedicated Cloud / Self-Managed](/platform/hosting/data-security/secure-storage-connector#coreweave-customer-namespace) を参照してください。
</Tab>
<Tab title="System settings">
1. Weights & Biasesインスタンスにサインインします。
2. W&B Appに移動します。

    <Frame>
    <img src="/images/hosting/system_settings.png" alt="W&B App navigation"  />
    </Frame>

3. ドロップダウンから **System Settings** を選択します。

    <Frame>
    <img src="/images/hosting/system_settings_select_settings.png" alt="System Settings dropdown"  />
    </Frame>

4. Issuer、Client ID、Authentication Methodを入力します。
5. **Update settings** を選択します。

<Frame>
    <img src="/images/hosting/system_settings_select_update.png" alt="Update settings button"  />
</Frame>
</Tab>
</Tabs>

<Note>
SSOの設定後にインスタンスにログインできなくなった場合は、環境変数 `LOCAL_RESTORE=true` を設定してインスタンスを再起動できます。これにより、コンテナログに一時パスワードが出力され、SSOがオフになります。SSOの問題を解決したら、SSOを再度有効にするためにその環境変数を削除する必要があります。
</Note>

## Security Assertion Markup Language (SAML)
W&B ServerはSAMLをサポートしていません。