---
title: ì˜¨ë¼ì¸ ëª¨ë‹ˆí„°ë§
description: W&B Weaveë¥¼ ì‚¬ìš©í•œ ì˜¨ë¼ì¸ ëª¨ë‹ˆí„°ë§ ë°©ë²• ì•Œì•„ë³´ê¸°
---

<Note>
ì´ê²ƒì€ ì¸í„°ë™í‹°ë¸Œ ë…¸íŠ¸ë¶ì…ë‹ˆë‹¤. ë¡œì»¬ì—ì„œ ì‹¤í–‰í•˜ê±°ë‚˜ ì•„ë˜ ë§í¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
- [Google Colabì—ì„œ ì—´ê¸°](https://colab.research.google.com/github/wandb/docs/blob/main/weave/cookbooks/source/online_monitoring.ipynb)
- [GitHubì—ì„œ ì†ŒìŠ¤ ë³´ê¸°](https://github.com/wandb/docs/blob/main/weave/cookbooks/source/online_monitoring.ipynb)
</Note>

# Weaveì™€ ì¸í…Œê·¸ë ˆì´ì…˜: í”„ë¡œë•ì…˜ ëŒ€ì‹œë³´ë“œ

GenAI íˆ´ë§ í™˜ê²½ì€ ìƒˆë¡œìš´ í”„ë ˆì„ì›Œí¬, íˆ´, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ëŠì„ì—†ì´ ë“±ì¥í•˜ë©° ë¹ ë¥´ê²Œ ì§„í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤. WeaveëŠ” ëª¨ë“  GenAI ëª¨ë‹ˆí„°ë§ ë° í‰ê°€ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ëŠ” ì›ìŠ¤í†± ì†”ë£¨ì…˜ì„ ì§€í–¥í•©ë‹ˆë‹¤. ì´ëŠ” ë•Œë•Œë¡œ ê¸°ì¡´ í”Œë«í¼ê³¼ í†µí•©í•˜ê±°ë‚˜, í”„ë¡œì íŠ¸ ë˜ëŠ” ì¡°ì§ì˜ íŠ¹ì • ìš”êµ¬ì‚¬í•­ì— ë§ê²Œ Weaveë¥¼ í™•ì¥í•´ì•¼ í•  í•„ìš”ê°€ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

ì´ ì¿¡ë¶ì—ì„œëŠ” Weaveì˜ ê°•ë ¥í•œ APIì™€ í•¨ìˆ˜ë¥¼ í™œìš©í•˜ì—¬ Weaveì˜ Traces ë·°ë¥¼ í™•ì¥í•œ í”„ë¡œë•ì…˜ ëª¨ë‹ˆí„°ë§ìš© ì»¤ìŠ¤í…€ ëŒ€ì‹œë³´ë“œë¥¼ ë§Œë“œëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ë‹¤ìŒ ë‚´ìš©ì— ì¤‘ì ì„ ë‘¡ë‹ˆë‹¤:

- Weaveì—ì„œ traces, ë¹„ìš©, í”¼ë“œë°± ë° ê¸°íƒ€ ë©”íŠ¸ë¦­ ê°€ì ¸ì˜¤ê¸°
- ì‚¬ìš©ì í”¼ë“œë°± ë° ë¹„ìš© ë¶„í¬ë¥¼ ìœ„í•œ ì§‘ê³„ ë·° ìƒì„±
- ì‹œê°„ì— ë”°ë¥¸ í† í° ì‚¬ìš©ëŸ‰ ë° ì§€ì—° ì‹œê°„ ì‹œê°í™”

streamlitì„ ì„¤ì¹˜í•˜ê³  [ì´ í”„ë¡œë•ì…˜ ëŒ€ì‹œë³´ë“œ ìŠ¤í¬ë¦½íŠ¸](https://github.com/NiWaRe/agent-dev-collection)ë¥¼ ì‹¤í–‰í•˜ì—¬ ìì‹ ì˜ Weave í”„ë¡œì íŠ¸ë¡œ ëŒ€ì‹œë³´ë“œë¥¼ ì‚¬ìš©í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!

<img src="https://github.com/NiWaRe/knowledge-worker-weave/blob/master/screenshots/dashboard_weave_preview.jpg?raw=true" width="1000" alt="Example Production Dashboard with Weave" />

# 1. ì„¤ì •

ì´ íŠœí† ë¦¬ì–¼ì„ ë”°ë¼ í•˜ë ¤ë©´ ë‹¤ìŒ íŒ¨í‚¤ì§€ë§Œ ì„¤ì¹˜í•˜ë©´ ë©ë‹ˆë‹¤:

```python lines
!pip install streamlit pandas plotly weave
```

# 2. êµ¬í˜„

## 2.1 Weave Client ì´ˆê¸°í™” ë° ë¹„ìš© ì •ì˜

ë¨¼ì €, Weave clientë¥¼ ì´ˆê¸°í™”í•˜ê³  ê° ëª¨ë¸ì— ëŒ€í•œ ë¹„ìš©ì„ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

- ë§ì€ í‘œì¤€ ëª¨ë¸ì— ëŒ€í•œ í‘œì¤€ ë¹„ìš©ì„ í¬í•¨í•´ ë‘ì—ˆì§€ë§Œ, ì‚¬ìš©ìê°€ ì§ì ‘ ì»¤ìŠ¤í…€ ë¹„ìš©ê³¼ ì»¤ìŠ¤í…€ ëª¨ë¸ì„ ì‰½ê²Œ ì¶”ê°€í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œëŠ” ëª‡ ê°€ì§€ ëª¨ë¸ì— ëŒ€í•´ ì»¤ìŠ¤í…€ ë¹„ìš©ì„ ì¶”ê°€í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” í‘œì¤€ ë¹„ìš©ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
- ë¹„ìš©ì€ Weaveì˜ ê° callì— ëŒ€í•´ íŠ¸ë˜í‚¹ëœ í† í°ì„ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤. ë§ì€ LLM ë²¤ë” ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê²½ìš° í† í° ì‚¬ìš©ëŸ‰ì´ ìë™ìœ¼ë¡œ íŠ¸ë˜í‚¹ë˜ì§€ë§Œ, ì„ì˜ì˜ callì— ëŒ€í•´ ì»¤ìŠ¤í…€ í† í° ìˆ˜ë¥¼ ë°˜í™˜í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì»¤ìŠ¤í…€ ëª¨ë¸ì— ëŒ€í•œ í† í° ìˆ˜ ì •ì˜ ë° ë¹„ìš© ê³„ì‚° ë°©ë²•ì€ ì´ ì¿¡ë¶ì„ ì°¸ì¡°í•˜ì„¸ìš” - [custom cost cookbook](/weave/cookbooks/custom_model_cost#setting-up-a-model-with-weave).

```python lines
PROJECT_NAME = "wandb-smle/weave-cookboook-demo"
# python
import weave

MODEL_NAMES = [
    # ëª¨ë¸ ì´ë¦„, prompt ë¹„ìš©, completion ë¹„ìš©
    ("gpt-4o-2024-05-13", 0.03, 0.06),
    ("gpt-4o-mini-2024-07-18", 0.03, 0.06),
    ("gemini/gemini-1.5-flash", 0.00025, 0.0005),
    ("gpt-4o-mini", 0.03, 0.06),
    ("gpt-4-turbo", 0.03, 0.06),
    ("claude-3-haiku-20240307", 0.01, 0.03),
    ("gpt-4o", 0.03, 0.06),
]

def init_weave_client(project_name):
    try:
        client = weave.init(project_name)
        for model, prompt_cost, completion_cost in MODEL_NAMES:
            client.add_cost(
                llm_id=model,
                prompt_token_cost=prompt_cost,
                completion_token_cost=completion_cost,
            )
    except Exception as e:
        print(f"Failed to initialize Weave client for project '{project_name}': {e}")
        return None
    else:
        return client

client = init_weave_client(PROJECT_NAME)
```

## 2.2 Weaveì—ì„œ Calls ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

Weaveì—ì„œ call ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ë‘ ê°€ì§€ ì˜µì…˜ì´ ìˆìŠµë‹ˆë‹¤:

1. ë°ì´í„°ë¥¼ call-by-call ë°©ì‹ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
2. í•˜ì´ ë ˆë²¨ API ì‚¬ìš©í•˜ê¸°

### 2.2.1 ë°ì´í„°ë¥¼ call-by-call ë°©ì‹ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°

Weaveì˜ ë°ì´í„°ì— ì—‘ì„¸ìŠ¤í•˜ëŠ” ì²« ë²ˆì§¸ ì˜µì…˜ì€ í•„í„°ë§ëœ call ë¦¬ìŠ¤íŠ¸ë¥¼ ê²€ìƒ‰í•˜ê³  ì›í•˜ëŠ” ë°ì´í„°ë¥¼ call-by-callë¡œ ì¶”ì¶œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ `calls_query_stream` APIë¥¼ ì‚¬ìš©í•˜ì—¬ Weaveì—ì„œ call ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- `calls_query_stream` API: Weaveì—ì„œ call ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” APIì…ë‹ˆë‹¤.
- `filter` ì‚¬ì „: call ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ í•„í„° íŒŒë¼ë¯¸í„°ë¥¼ í¬í•¨í•©ë‹ˆë‹¤ - ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](/weave/reference/python-sdk/trace_server/trace_server_interface#class-callschema)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
- `expand_columns` ë¦¬ìŠ¤íŠ¸: call ë°ì´í„°ì—ì„œ í™•ì¥í•  ì»¬ëŸ¼ì„ í¬í•¨í•©ë‹ˆë‹¤.
- `sort_by` ë¦¬ìŠ¤íŠ¸: call ë°ì´í„°ì˜ ì •ë ¬ íŒŒë¼ë¯¸í„°ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
- `include_costs` ë¶ˆë¦¬ì–¸: call ë°ì´í„°ì— ë¹„ìš©ì„ í¬í•¨í• ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
- `include_feedback` ë¶ˆë¦¬ì–¸: call ë°ì´í„°ì— í”¼ë“œë°±ì„ í¬í•¨í• ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

```python lines
import itertools
from datetime import datetime, timedelta

import pandas as pd

def fetch_calls(client, project_id, start_time, trace_roots_only, limit):
    filter_params = {
        "project_id": project_id,
        "filter": {"started_at": start_time, "trace_roots_only": trace_roots_only},
        "expand_columns": ["inputs.example", "inputs.model"],
        "sort_by": [{"field": "started_at", "direction": "desc"}],
        "include_costs": True,
        "include_feedback": True,
    }
    try:
        calls_stream = client.server.calls_query_stream(filter_params)
        calls = list(
            itertools.islice(calls_stream, limit)
        )  # ê°€ì ¸ì˜¬ call ìˆ˜ê°€ ë„ˆë¬´ ë§ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ì œí•œì„ ë‘¡ë‹ˆë‹¤.
        print(f"Fetched {len(calls)} calls.")
    except Exception as e:
        print(f"Error fetching calls: {e}")
        return []
    else:
        return calls

calls = fetch_calls(client, PROJECT_NAME, datetime.now() - timedelta(days=1), True, 100)
# python
# ì›ì‹œ ë°ì´í„°ëŠ” Call ì˜¤ë¸Œì íŠ¸ì˜ ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤.
pd.DataFrame([call.dict() for call in calls]).head(3)
```

Weaveì—ì„œ ë°˜í™˜ëœ ê²°ê³¼ë¥¼ ì‚¬ìš©í•˜ë©´ callì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ë§¤ìš° ì‰½ìŠµë‹ˆë‹¤. ê´€ë ¨ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì—¬ ì‚¬ì „ ë¦¬ìŠ¤íŠ¸ì— ì €ì¥í•œ ë‹¤ìŒ, ì´ ë¦¬ìŠ¤íŠ¸ë¥¼ pandas DataFrameìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.

```python lines
import json
from datetime import datetime

import pandas as pd

def process_calls(calls):
    records = []
    for call in calls:
        feedback = call.summary.get("weave", {}).get("feedback", [])
        thumbs_up = sum(
            1
            for item in feedback
            if isinstance(item, dict) and item.get("payload", {}).get("emoji") == "ğŸ‘"
        )
        thumbs_down = sum(
            1
            for item in feedback
            if isinstance(item, dict) and item.get("payload", {}).get("emoji") == "ğŸ‘"
        )
        latency = call.summary.get("weave", {}).get("latency_ms", 0)

        records.append(
            {
                "Call ID": call.id,
                "Trace ID": call.trace_id,  # traceë¥¼ ê²€ìƒ‰í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê³ ìœ  ID
                "Display Name": call.display_name,  # UI ë˜ëŠ” í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆëŠ” ì„ íƒì  ì´ë¦„
                "Latency (ms)": latency,
                "Thumbs Up": thumbs_up,
                "Thumbs Down": thumbs_down,
                "Started At": pd.to_datetime(getattr(call, "started_at", datetime.min)),
                "Inputs": json.dumps(call.inputs, default=str),
                "Outputs": json.dumps(call.output, default=str),
            }
        )
    return pd.DataFrame(records)
# python
df_calls = process_calls(calls)
df_calls.head(3)
```

### 2.2.2 í•˜ì´ ë ˆë²¨ API ì‚¬ìš©í•˜ê¸°

ëª¨ë“  callì„ ì¼ì¼ì´ ì‚´í´ë³´ëŠ” ëŒ€ì‹ , WeaveëŠ” ëª¨ë¸ ë¹„ìš©, í”¼ë“œë°± ë° ê¸°íƒ€ ë©”íŠ¸ë¦­ì— ì§ì ‘ ì—‘ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” í•˜ì´ ë ˆë²¨ APIë„ ì œê³µí•©ë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ ë¹„ìš©ì˜ ê²½ìš°, `query_costs` APIë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ëœ ëª¨ë“  LLMì˜ ë¹„ìš©ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```python lines
# ë¹„ìš© APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ìš© ê°€ì ¸ì˜¤ê¸°
costs = client.query_costs()
df_costs = pd.DataFrame([cost.dict() for cost in costs])
df_costs["total_cost"] = (
    df_costs["prompt_token_cost"] + df_costs["completion_token_cost"]
)

# ê° ê³ ìœ  llm_idì— ëŒ€í•´ ì²« ë²ˆì§¸ í–‰ë§Œ í‘œì‹œ
df_costs
```

## 2.4 ì…ë ¥ ìˆ˜ì§‘ ë° ì‹œê°í™” ìƒì„±

ë‹¤ìŒìœ¼ë¡œ plotlyë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œê°í™”ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ ê°€ì¥ ê¸°ë³¸ì ì¸ ëŒ€ì‹œë³´ë“œì´ì§€ë§Œ, ì›í•˜ëŠ” ëŒ€ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ë” ë³µì¡í•œ ì˜ˆì‹œëŠ” [ì—¬ê¸°](https://github.com/NiWaRe/knowledge-worker-weave/blob/master/prod_dashboard.py)ì—ì„œ Streamlit ì˜ˆì‹œë¥¼ í™•ì¸í•˜ì„¸ìš”.

```python lines
import plotly.express as px
import plotly.graph_objects as go

def plot_feedback_pie_chart(thumbs_up, thumbs_down):
    fig = go.Figure(
        data=[
            go.Pie(
                labels=["Thumbs Up", "Thumbs Down"],
                values=[thumbs_up, thumbs_down],
                marker={"colors": ["#66b3ff", "#ff9999"]},
                hole=0.3,
            )
        ]
    )
    fig.update_traces(textinfo="percent+label", hoverinfo="label+percent")
    fig.update_layout(showlegend=False, title="Feedback Summary")
    return fig

def plot_model_cost_distribution(df):
    fig = px.bar(
        df,
        x="llm_id",
        y="total_cost",
        color="llm_id",
        title="Cost Distribution by Model",
    )
    fig.update_layout(xaxis_title="Model", yaxis_title="Cost (USD)")
    return fig

# ëª¨ë“  í”Œë¡¯ì— ëŒ€í•œ ì†ŒìŠ¤ ì½”ë“œ ë³´ê¸°
# python
plot_feedback_pie_chart(df_calls["Thumbs Up"].sum(), df_calls["Thumbs Down"].sum())
# python
plot_model_cost_distribution(df_costs)
```

# ê²°ë¡ 

ì´ ì¿¡ë¶ì—ì„œëŠ” Weaveì˜ APIì™€ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¤ìŠ¤í…€ í”„ë¡œë•ì…˜ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œë¥¼ ë§Œë“œëŠ” ë°©ë²•ì„ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤. WeaveëŠ” í˜„ì¬ ì‰¬ìš´ ë°ì´í„° ì…ë ¥ë¿ë§Œ ì•„ë‹ˆë¼ ì»¤ìŠ¤í…€ í”„ë¡œì„¸ìŠ¤ë¥¼ ìœ„í•œ ë°ì´í„° ì¶”ì¶œì„ ìœ„í•œ ì‹ ì†í•œ í†µí•©ì— ì¤‘ì ì„ ë‘ê³  ìˆìŠµë‹ˆë‹¤.

- **ë°ì´í„° ì…ë ¥:**
  - [@weave-op()](/weave/quickstart#2-log-a-trace-to-a-new-project) ë°ì½”ë ˆì´í„°ë¥¼ í†µí•œ í”„ë ˆì„ì›Œí¬ ë…ë¦½ì ì¸ tracing ë° CSVì—ì„œ callì„ ì„í¬íŠ¸í•˜ëŠ” ê¸°ëŠ¥ (ê´€ë ¨ [import cookbook](/weave/cookbooks/import_from_csv) ì°¸ì¡°)
  - ë‹¤ì–‘í•œ í”„ë¡œê·¸ë˜ë° í”„ë ˆì„ì›Œí¬ ë° ì–¸ì–´ì—ì„œ Weaveë¡œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ê¸° ìœ„í•œ ì„œë¹„ìŠ¤ API ì—”ë“œí¬ì¸íŠ¸. ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](https://docs.wandb.ai/weave/reference/service-api/calls/call-start)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
- **ë°ì´í„° ì¶œë ¥:**
  - CSV, TSV, JSONL, JSON í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì‰½ê²Œ ë‹¤ìš´ë¡œë“œ - ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](/weave/reference/service-api)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
  - ë°ì´í„°ì— ëŒ€í•œ í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì—‘ì„¸ìŠ¤ë¥¼ ì‚¬ìš©í•œ ì‰¬ìš´ ë‚´ë³´ë‚´ê¸° - ì´ ì¿¡ë¶ì— ì„¤ëª…ëœ ë‚´ë³´ë‚´ê¸° íŒ¨ë„ì˜ "Use Python" ì„¹ì…˜ì„ ì°¸ì¡°í•˜ì„¸ìš”. ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](/weave/guides/tracking/tracing#querying-and-exporting-calls)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

ì´ ì»¤ìŠ¤í…€ ëŒ€ì‹œë³´ë“œëŠ” Weaveì˜ ê¸°ë³¸ Traces ë·°ë¥¼ í™•ì¥í•˜ì—¬, í”„ë¡œë•ì…˜ í™˜ê²½ì˜ LLM ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë§ì¶¤í™”ëœ ëª¨ë‹ˆí„°ë§ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. ë” ë³µì¡í•œ ëŒ€ì‹œë³´ë“œë¥¼ í™•ì¸í•˜ê³  ì‹¶ë‹¤ë©´, ìì‹ ì˜ Weave í”„ë¡œì íŠ¸ URLì„ ì¶”ê°€í•  ìˆ˜ ìˆëŠ” [ì´ ë ˆí¬ì§€í† ë¦¬](https://github.com/NiWaRe/agent-dev-collection)ì˜ Streamlit ì˜ˆì‹œë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”.