---
title: í”¼ë“œë°± í”„ë¡œë•ì…˜
description: W&B Weaveë¥¼ ì‚¬ìš©í•˜ì—¬ í”¼ë“œë°± í”„ë¡œë“œë¥¼ í™œìš©í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì„¸ìš”.
---

<Note>
ì´ê²ƒì€ ì¸í„°ë™í‹°ë¸Œ ë…¸íŠ¸ë¶ì…ë‹ˆë‹¤. ë¡œì»¬ì—ì„œ ì‹¤í–‰í•˜ê±°ë‚˜ ì•„ë˜ ë§í¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
- [Google Colabì—ì„œ ì—´ê¸°](https://colab.research.google.com/github/wandb/docs/blob/main/weave/cookbooks/source/feedback_prod.ipynb)
- [GitHubì—ì„œ ì†ŒìŠ¤ ë³´ê¸°](https://github.com/wandb/docs/blob/main/weave/cookbooks/source/feedback_prod.ipynb)
</Note>

## 

ìƒì„±ëœ LLM ì‘ë‹µì„ ìë™ìœ¼ë¡œ í‰ê°€í•˜ëŠ” ê²ƒì€ ì¢…ì¢… ì–´ë µìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ìœ„í—˜ í—ˆìš© ë²”ìœ„ì— ë”°ë¼ ì‚¬ìš©ìë¡œë¶€í„° ì§ì ‘ í”¼ë“œë°±ì„ ìˆ˜ì§‘í•˜ì—¬ ê°œì„ ì´ í•„ìš”í•œ ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” ì‚¬ìš©ì í”¼ë“œë°±ì„ ìˆ˜ì§‘í•˜ê¸° ìœ„í•œ ì˜ˆì‹œ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì»¤ìŠ¤í…€ ì±—ë´‡ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
ì¸í„°í˜ì´ìŠ¤ êµ¬ì¶•ì„ ìœ„í•´ Streamlitì„ ì‚¬ìš©í•˜ê³ , LLM ìƒí˜¸ì‘ìš©ê³¼ í”¼ë“œë°±ì„ Weave ì— ìº¡ì²˜í•©ë‹ˆë‹¤.

## ì„¤ì •

```python lines
!pip install weave openai streamlit wandb
!pip install set-env-colab-kaggle-dotenv -q # í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ì„ ìœ„í•´ ì‚¬ìš©
python
# OpenAI ë° WandB API í‚¤ê°€ í¬í•¨ëœ .env íŒŒì¼ì„ ì¶”ê°€í•˜ì„¸ìš”
from set_env import set_env

_ = set_env("OPENAI_API_KEY")
_ = set_env("WANDB_API_KEY")
```

ë‹¤ìŒìœ¼ë¡œ, ì•„ë˜ ë‚´ìš©ì„ í¬í•¨í•˜ëŠ” `chatbot.py` íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤:

```python lines {13,15,27}
# chatbot.py

import openai
import streamlit as st
import wandb
from set_env import set_env

import weave

_ = set_env("OPENAI_API_KEY")
_ = set_env("WANDB_API_KEY")

wandb.login()

weave_client = weave.init("feedback-example")
oai_client = openai.OpenAI()

def init_states():
    """session_state í‚¤ê°€ ì•„ì§ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° ì„¤ì •í•©ë‹ˆë‹¤."""
    if "messages" not in st.session_state:
        st.session_state["messages"] = []
    if "calls" not in st.session_state:
        st.session_state["calls"] = []
    if "session_id" not in st.session_state:
        st.session_state["session_id"] = "123abc"

@weave.op
def chat_response(full_history):
    """
    ì§€ê¸ˆê¹Œì§€ì˜ ì „ì²´ ëŒ€í™” ê¸°ë¡ì„ ë°”íƒ•ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¬ë° ëª¨ë“œì—ì„œ OpenAI APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
    full_historyëŠ” ë”•ì…”ë„ˆë¦¬ ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤: [{"role":"user"|"assistant","content":...}, ...]
    """
    stream = oai_client.chat.completions.create(
        model="gpt-4", messages=full_history, stream=True
    )
    response_text = st.write_stream(stream)
    return {"response": response_text}

def render_feedback_buttons(call_idx):
    """í•´ë‹¹ í˜¸ì¶œì— ëŒ€í•´ ì¢‹ì•„ìš”/ì‹«ì–´ìš” ë° í…ìŠ¤íŠ¸ í”¼ë“œë°± ë²„íŠ¼ì„ ë Œë”ë§í•©ë‹ˆë‹¤."""
    col1, col2, col3 = st.columns([1, 1, 4])

    # ì¢‹ì•„ìš” ë²„íŠ¼
    with col1:
        if st.button("ğŸ‘", key=f"thumbs_up_{call_idx}"):
            st.session_state.calls[call_idx].feedback.add_reaction("ğŸ‘")
            st.success("í”¼ë“œë°± ê°ì‚¬í•©ë‹ˆë‹¤!")

    # ì‹«ì–´ìš” ë²„íŠ¼
    with col2:
        if st.button("ğŸ‘", key=f"thumbs_down_{call_idx}"):
            st.session_state.calls[call_idx].feedback.add_reaction("ğŸ‘")
            st.success("í”¼ë“œë°± ê°ì‚¬í•©ë‹ˆë‹¤!")

    # í…ìŠ¤íŠ¸ í”¼ë“œë°±
    with col3:
        feedback_text = st.text_input("í”¼ë“œë°±", key=f"feedback_input_{call_idx}")
        if (
            st.button("í”¼ë“œë°± ì œì¶œ", key=f"submit_feedback_{call_idx}")
            and feedback_text
        ):
            st.session_state.calls[call_idx].feedback.add_note(feedback_text)
            st.success("í”¼ë“œë°±ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!")

def display_old_messages():
    """st.session_state.messagesì— ì €ì¥ëœ ëŒ€í™”ì™€ í”¼ë“œë°± ë²„íŠ¼ì„ í‘œì‹œí•©ë‹ˆë‹¤."""
    for idx, message in enumerate(st.session_state.messages):
        with st.chat_message(message["role"]):
            st.markdown(message["content"])

            # ì–´ì‹œìŠ¤í„´íŠ¸ ë©”ì‹œì§€ì¸ ê²½ìš° í”¼ë“œë°± ì–‘ì‹ì„ í‘œì‹œ
            if message["role"] == "assistant":
                # st.session_state.callsì—ì„œ ì´ ì–´ì‹œìŠ¤í„´íŠ¸ ë©”ì‹œì§€ì˜ ì¸ë±ìŠ¤ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
                assistant_idx = (
                    len(
                        [
                            m
                            for m in st.session_state.messages[: idx + 1]
                            if m["role"] == "assistant"
                        ]
                    )
                    - 1
                )
                # ì¢‹ì•„ìš”/ì‹«ì–´ìš” ë° í…ìŠ¤íŠ¸ í”¼ë“œë°± ë Œë”ë§
                if assistant_idx < len(st.session_state.calls):
                    render_feedback_buttons(assistant_idx)

def display_chat_prompt():
    """ì±„íŒ… í”„ë¡¬í”„íŠ¸ ì…ë ¥ ìƒìë¥¼ í‘œì‹œí•©ë‹ˆë‹¤."""
    if prompt := st.chat_input("ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”!"):
        # ìƒˆ ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ì¦‰ì‹œ ë Œë”ë§
        with st.chat_message("user"):
            st.markdown(prompt)

        # ì„¸ì…˜ì— ì‚¬ìš©ì ë©”ì‹œì§€ ì €ì¥
        st.session_state.messages.append({"role": "user", "content": prompt})

        # APIë¥¼ ìœ„í•œ ì±„íŒ… ê¸°ë¡ ì¤€ë¹„
        full_history = [
            {"role": msg["role"], "content": msg["content"]}
            for msg in st.session_state.messages
        ]

        with st.chat_message("assistant"):
            # ëŒ€í™” ì¸ìŠ¤í„´ìŠ¤ íŠ¸ë˜í‚¹ì„ ìœ„í•´ Weave ì†ì„± ì²¨ë¶€
            with weave.attributes(
                {"session": st.session_state["session_id"], "env": "prod"}
            ):
                # OpenAI API í˜¸ì¶œ (ìŠ¤íŠ¸ë¦¼)
                result, call = chat_response.call(full_history)

                # ì–´ì‹œìŠ¤í„´íŠ¸ ë©”ì‹œì§€ ì €ì¥
                st.session_state.messages.append(
                    {"role": "assistant", "content": result["response"]}
                )

                # íŠ¹ì • ì‘ë‹µì— í”¼ë“œë°±ì„ ì—°ê²°í•˜ê¸° ìœ„í•´ weave í˜¸ì¶œ ì˜¤ë¸Œì íŠ¸ ì €ì¥
                st.session_state.calls.append(call)

                # ìƒˆ ë©”ì‹œì§€ì— ëŒ€í•œ í”¼ë“œë°± ë²„íŠ¼ ë Œë”ë§
                new_assistant_idx = (
                    len(
                        [
                            m
                            for m in st.session_state.messages
                            if m["role"] == "assistant"
                        ]
                    )
                    - 1
                )

                # í”¼ë“œë°± ë²„íŠ¼ ë Œë”ë§
                if new_assistant_idx < len(st.session_state.calls):
                    render_feedback_buttons(new_assistant_idx)

def main():
    st.title("ì¦‰ê°ì ì¸ í”¼ë“œë°± ì–‘ì‹ì´ í¬í•¨ëœ ì±—ë´‡")
    init_states()
    display_old_messages()
    display_chat_prompt()

if __name__ == "__main__":
    main()
```

`streamlit run chatbot.py` ëª…ë ¹ì–´ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì œ ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ëŒ€í™”í•˜ê³  ê° ì‘ë‹µ í›„ì— í”¼ë“œë°± ë²„íŠ¼ì„ í´ë¦­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
Weave UIë¥¼ ë°©ë¬¸í•˜ì—¬ ì²¨ë¶€ëœ í”¼ë“œë°±ì„ í™•ì¸í•˜ì„¸ìš”.

## ì„¤ëª…

ë°ì½”ë ˆì´í„°ê°€ ì ìš©ëœ ì˜ˆì¸¡ í•¨ìˆ˜ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ê°€ì •í•´ ë³´ê² ìŠµë‹ˆë‹¤:

```python lines {5}
import weave

weave.init("feedback-example")

@weave.op
def predict(input_data):
    # ì—¬ê¸°ì— ì˜ˆì¸¡ ë¡œì§ ì‘ì„±
    some_result = "hello world"
    return some_result
```

ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©ìì—ê²Œ ëª¨ë¸ ì‘ë‹µì„ ì „ë‹¬í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```python lines
with weave.attributes(
    {"session": "123abc", "env": "prod"}
):  # ì…ë ¥ ë° ì¶œë ¥ê³¼ í•¨ê»˜ í˜¸ì¶œì— ì„ì˜ì˜ ì†ì„±ì„ ì²¨ë¶€í•©ë‹ˆë‹¤.
    result = predict(input_data="your data here")  # ì•± UIë¥¼ í†µí•œ ì‚¬ìš©ì ì§ˆë¬¸
```

í”¼ë“œë°±ì„ ì²¨ë¶€í•˜ë ¤ë©´ `call` ì˜¤ë¸Œì íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì´ëŠ” í•¨ìˆ˜ë¥¼ í‰ì†Œì²˜ëŸ¼ í˜¸ì¶œí•˜ëŠ” ëŒ€ì‹  `.call()` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```python lines
result, call = predict.call(input_data="your data here")
```

ì´ call ì˜¤ë¸Œì íŠ¸ëŠ” íŠ¹ì • ì‘ë‹µì— í”¼ë“œë°±ì„ ì—°ê²°í•˜ëŠ” ë° í•„ìš”í•©ë‹ˆë‹¤.
í˜¸ì¶œì„ ìˆ˜í–‰í•œ í›„, ì‘ì—…ì˜ ê²°ê³¼ê°’ì€ ìœ„ì˜ `result`ë¥¼ í†µí•´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python lines
call.feedback.add_reaction("ğŸ‘")  # ì•± UIë¥¼ í†µí•œ ì‚¬ìš©ì ë°˜ì‘
```

## ê²°ë¡ 

ì´ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” Streamlitì„ ì‚¬ìš©í•˜ì—¬ ì…ë ¥ê³¼ ì¶œë ¥ì„ Weave ì— ìº¡ì²˜í•˜ê³ , ì‚¬ìš©ì í”¼ë“œë°±ì„ ë°›ê¸° ìœ„í•œ ğŸ‘ğŸ‘ ë²„íŠ¼ì„ í¬í•¨í•œ ì±„íŒ… UIë¥¼ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.