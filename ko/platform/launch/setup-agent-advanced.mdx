---
title: "Launch 에이전트 설정하기"
---

<div id="advanced-agent-setup">
  # 고급 에이전트 설정
</div>

이 가이드는 다양한 환경에서 컨테이너 이미지를 빌드하도록 W&amp;B Launch 에이전트를 설정하는 방법을 설명합니다.

<Note>
  빌드는 git 작업과 코드 아티팩트 작업에서만 필요합니다. 이미지 작업은 빌드가 필요하지 않습니다.

  작업 유형에 대한 자세한 내용은 [Launch 작업 생성](/ko/platform/launch/create-launch-job/)을 참고하세요.
</Note>

<div id="builders">
  ## 빌더
</div>

Launch 에이전트는 [Docker](https://docs.docker.com/) 또는 [Kaniko](https://github.com/GoogleContainerTools/kaniko)를 사용해 이미지를 빌드할 수 있습니다.

* Kaniko: Kubernetes에서 빌드를 특권(privileged) 컨테이너로 실행하지 않고 컨테이너 이미지를 빌드합니다.
* Docker: 로컬에서 `docker build` 명령을 실행하여 컨테이너 이미지를 빌드합니다.

빌더 유형은 Launch 에이전트 설정의 `builder.type` 키로 제어할 수 있으며, `docker`, `kaniko`, 또는 빌드를 끄기 위한 `noop` 중 하나로 설정할 수 있습니다. 기본적으로 에이전트 Helm 차트는 `builder.type`을 `noop`으로 설정합니다. `builder` 섹션의 추가 키는 빌드 프로세스를 구성하는 데 사용됩니다.

에이전트 설정에 빌더가 지정되지 않았고 사용 가능한 `docker` CLI가 감지되면, 에이전트는 기본적으로 Docker를 사용합니다. Docker를 사용할 수 없는 경우 에이전트는 기본적으로 `noop`을 사용합니다.

<Note>
  Kubernetes 클러스터에서 이미지를 빌드할 때는 Kaniko를 사용하세요. 그 외의 모든 경우에는 Docker를 사용하세요.
</Note>

<div id="pushing-to-a-container-registry">
  ## 컨테이너 레지스트리에 푸시하기
</div>

Launch 에이전트는 빌드하는 모든 이미지를 고유한 source hash로 태깅합니다. 에이전트는 `builder.destination` 키에 지정된 레지스트리로 이미지를 푸시합니다.

예를 들어 `builder.destination` 키가 `my-registry.example.com/my-repository`로 설정된 경우, 에이전트는 이미지를 `my-registry.example.com/my-repository:<source-hash>`로 태깅한 뒤 푸시합니다. 해당 이미지가 이미 레지스트리에 존재하면 빌드는 수행되지 않습니다.

<div id="agent-configuration">
  ### 에이전트 구성
</div>

Helm 차트를 통해 에이전트를 배포하는 경우, 에이전트 구성은 `values.yaml` 파일의 `agentConfig` 키에 제공해야 합니다.

`wandb launch-agent`로 직접 에이전트를 실행하는 경우, `--config` 플래그로 YAML 파일 경로를 전달하여 에이전트 구성을 제공할 수 있습니다. 기본적으로 구성은 `~/.config/wandb/launch-config.yaml`에서 로드됩니다.

Launch 에이전트 구성(`launch-config.yaml`)에서 `environment`와 `registry` 키에 각각 대상 리소스 환경 이름과 컨테이너 레지스트리를 지정합니다.

아래 탭은 사용 중인 `environment`와 `registry`에 따라 Launch 에이전트를 구성하는 방법을 보여줍니다.

<Tabs>
  <Tab title="AWS">
    AWS `environment` 구성을 위해서는 `region` 키가 필요합니다. `region`에는 에이전트가 실행되는 AWS 리전을 설정해야 합니다.

    ```yaml title="launch-config.yaml"
    environment:
      type: aws
      region: <aws-region>
    builder:
      type: <kaniko|docker>
      # 에이전트가 이미지를 저장할 ECR 리포지토리의 URI입니다.
      # region이 environment에 구성한 값과 일치하는지 확인하세요.
      destination: <account-id>.ecr.<aws-region>.amazonaws.com/<repository-name>
      # Kaniko를 사용하는 경우, 에이전트가 빌드 컨텍스트를 저장할
      # S3 버킷을 지정합니다.
      build-context-store: s3://<bucket-name>/<path>
    ```

    에이전트는 boto3를 사용하여 기본 AWS 자격 증명을 로드합니다. 기본 AWS 자격 증명을 구성하는 방법에 대한 자세한 내용은 [boto3 문서](https://boto3.amazonaws.com/v1/documentation/api/latest/index.html)를 참고하세요.
  </Tab>

  <Tab title="Google Cloud">
    Google Cloud `environment`에는 `region` 및 `project` 키가 필요합니다. `region`에는 에이전트가 실행되는 리전을 설정합니다. `project`에는 에이전트가 실행되는 Google Cloud 프로젝트를 설정합니다. 에이전트는 Python에서 `google.auth.default()`를 사용하여 기본 자격 증명을 로드합니다.

    ```yaml title="launch-config.yaml"
    environment:
      type: gcp
      region: <gcp-region>
      project: <gcp-project-id>
    builder:
      type: <kaniko|docker>
      # 에이전트가 이미지를 저장할 Artifact Registry 리포지토리와
      # 이미지 이름의 URI입니다. region과 project가 environment에
      # 구성한 값과 일치하는지 확인하세요.
      uri: <region>-docker.pkg.dev/<project-id>/<repository-name>/<image-name>
      # Kaniko를 사용하는 경우, 에이전트가 빌드 컨텍스트를 저장할
      # GCS 버킷을 지정합니다.
      build-context-store: gs://<bucket-name>/<path>
    ```

    에이전트에서 사용할 수 있도록 기본 Google Cloud 자격 증명을 구성하는 방법에 대한 자세한 내용은 [`google-auth` 문서](https://google-auth.readthedocs.io/en/latest/reference/google.auth.html#google.auth.default)를 참고하세요.
  </Tab>

  <Tab title="Azure">
    Azure `environment`에는 추가 키가 필요하지 않습니다. 에이전트가 시작되면 `azure.identity.DefaultAzureCredential()`을 사용하여 기본 Azure 자격 증명을 로드합니다.

    ```yaml title="launch-config.yaml"
    environment:
      type: azure
    builder:
      type: <kaniko|docker>
      # 에이전트가 이미지를 저장할 Azure Container Registry 리포지토리의 URI입니다.
      destination: https://<registry-name>.azurecr.io/<repository-name>
      # Kaniko를 사용하는 경우, 에이전트가 빌드 컨텍스트를 저장할
      # Azure Blob Storage 컨테이너를 지정합니다.
      build-context-store: https://<storage-account-name>.blob.core.windows.net/<container-name>
    ```

    기본 Azure 자격 증명을 구성하는 방법에 대한 자세한 내용은 [`azure-identity` 문서](https://learn.microsoft.com/python/api/azure-identity/azure.identity.defaultazurecredential?view=azure-python)를 참고하세요.
  </Tab>
</Tabs>

<div id="agent-permissions">
  ## 에이전트 권한
</div>

에이전트에 필요한 권한은 사용 사례에 따라 달라집니다.

<div id="cloud-registry-permissions">
  ### 클라우드 레지스트리 권한
</div>

다음은 Launch 에이전트가 클라우드 레지스트리와 상호작용하기 위해 일반적으로 필요한 권한입니다.

<Tabs>
  <Tab title="AWS">
    ```yaml
    {
      'Version': '2012-10-17',
      'Statement':
        [
          {
            'Effect': 'Allow',
            'Action':
              [
                'ecr:CreateRepository',
                'ecr:UploadLayerPart',
                'ecr:PutImage',
                'ecr:CompleteLayerUpload',
                'ecr:InitiateLayerUpload',
                'ecr:DescribeRepositories',
                'ecr:DescribeImages',
                'ecr:BatchCheckLayerAvailability',
                'ecr:BatchDeleteImage',
              ],
            'Resource': 'arn:aws:ecr:<region>:<account-id>:repository/<repository>',
          },
          {
            'Effect': 'Allow',
            'Action': 'ecr:GetAuthorizationToken',
            'Resource': '*',
          },
        ],
    }
    ```
  </Tab>

  <Tab title="Google Cloud">
    ```js
    artifactregistry.dockerimages.list;
    artifactregistry.repositories.downloadArtifacts;
    artifactregistry.repositories.list;
    artifactregistry.repositories.uploadArtifacts;
    ```
  </Tab>

  <Tab title="Azure">
    Kaniko 빌더를 사용하는 경우 [`AcrPush` 역할](https://learn.microsoft.com/azure/role-based-access-control/built-in-roles/containers#acrpush)을 추가합니다.
  </Tab>
</Tabs>

<div id="storage-permissions-for-kaniko">
  ### Kaniko를 위한 스토리지 권한
</div>

Kaniko 빌더를 사용하는 경우 Launch 에이전트에는 클라우드 스토리지에 이미지를 푸시할 수 있는 권한이 필요합니다. Kaniko는 빌드 작업이 실행되는 파드 외부에 있는 컨텍스트 스토어를 사용합니다.

<Tabs>
  <Tab title="AWS">
    AWS에서 Kaniko 빌더에 권장되는 컨텍스트 스토어는 Amazon S3입니다. 아래 정책을 사용하여 에이전트에 S3 버킷에 대한 액세스 권한을 부여할 수 있습니다:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "ListObjectsInBucket",
          "Effect": "Allow",
          "Action": ["s3:ListBucket"],
          "Resource": ["arn:aws:s3:::<BUCKET-NAME>"]
        },
        {
          "Sid": "AllObjectActions",
          "Effect": "Allow",
          "Action": "s3:*Object",
          "Resource": ["arn:aws:s3:::<BUCKET-NAME>/*"]
        }
      ]
    }
    ```
  </Tab>

  <Tab title="Google Cloud">
    Google Cloud에서는 에이전트가 빌드 컨텍스트를 GCS에 업로드하려면 다음 IAM 권한이 필요합니다:

    ```js
    storage.buckets.get;
    storage.objects.create;
    storage.objects.delete;
    storage.objects.get;
    ```
  </Tab>

  <Tab title="Azure">
    에이전트가 Azure Blob Storage에 빌드 컨텍스트를 업로드하려면 [Storage Blob Data Contributor](https://learn.microsoft.com/azure/role-based-access-control/built-in-roles#storage-blob-data-contributor) 역할이 필요합니다.
  </Tab>
</Tabs>

<div id="customizing-the-kaniko-build">
  ## Kaniko 빌드 사용자 지정
</div>

에이전트 구성의 `builder.kaniko-config` 키에서 Kaniko 작업이 사용할 Kubernetes Job 스펙을 지정합니다. 예를 들어:

```yaml title="launch-config.yaml"
builder:
  type: kaniko
  build-context-store: <my-build-context-store>
  destination: <my-image-destination>
  build-job-name: wandb-image-build
  kaniko-config:
    spec:
      template:
        spec:
          containers:
          - args:
            - "--cache=false" # Args는 "key=value" 형식이어야 합니다
            env:
            - name: "MY_ENV_VAR"
              value: "my-env-var-value"
```

<div id="deploy-launch-agent-into-coreweave">
  ## CoreWeave에 Launch agent 배포하기
</div>

원하는 경우 W&amp;B Launch agent를 CoreWeave 클라우드 인프라에 배포할 수 있습니다. CoreWeave는 GPU 가속 워크로드를 위해 특화된 클라우드 인프라입니다.

Launch agent를 CoreWeave에 배포하는 방법에 대한 자세한 내용은 [CoreWeave 문서](https://docs.coreweave.com/partners/weights-and-biases#integration)를 참고하세요.

<Note>
  Launch agent를 CoreWeave 인프라에 배포하려면 [CoreWeave 계정](https://cloud.coreweave.com/login)을 생성해야 합니다.
</Note>