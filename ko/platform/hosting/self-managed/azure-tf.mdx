---
description: Azure에서 W&B Server 호스팅.
title: Azure에 W&B 플랫폼 배포
---

<Note>
  W&amp;B는 [W&amp;B Multi-tenant Cloud](/ko/platform/hosting/hosting-options/multi_tenant_cloud) 또는 [W&amp;B Dedicated Cloud](/ko/platform/hosting/hosting-options/dedicated_cloud/)와 같은 완전 관리형 배포 옵션 사용을 권장합니다. W&amp;B 완전 관리형 서비스는 구성 작업이 거의 필요 없거나 전혀 필요 없으면서도 사용하기 쉽고 안전합니다.
</Note>

Self-Managed W&amp;B Server를 사용하기로 했다면, Azure에 플랫폼을 배포할 때 [W&amp;B Server Azure Terraform Module](https://registry.terraform.io/modules/wandb/wandb/azurerm/latest)을 사용할 것을 W&amp;B에서 권장합니다.

해당 모듈 문서는 매우 방대하며 사용할 수 있는 모든 옵션을 포함하고 있습니다. 이 문서에서는 그중 일부 배포 옵션만 다룹니다.

시작하기 전에, Terraform의 [State File](https://developer.hashicorp.com/terraform/language/state)을 저장할 [remote backends](https://developer.hashicorp.com/terraform/language/backend) 중 하나(원격 백엔드)를 선택할 것을 권장합니다.

State File은 모든 컴포넌트를 다시 생성하지 않고도 배포를 업그레이드하거나 변경 사항을 적용하는 데 필요한 리소스입니다.

Terraform Module은 다음 `필수` 컴포넌트를 배포합니다:

* Azure Resource Group
* Azure Virtual Network (VPC)
* Azure MySQL Flexible Server
* Azure Storage Account &amp; Blob Storage
* Azure Kubernetes Service
* Azure Application Gateway

다른 배포 옵션에는 다음 선택적 컴포넌트도 포함될 수 있습니다:

* Azure Cache for Redis
* Azure Event Grid

<div id="pre-requisite-permissions">
  ## **사전 필요 권한**
</div>

AzureRM provider를 구성하는 가장 간단한 방법은 [Azure CLI](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/guides/azure_cli)를 사용하는 것입니다. 다만 자동화를 위해서는 [Azure Service Principal](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/guides/service_principal_client_secret)을 사용하는 것도 유용할 수 있습니다.
어떤 인증 방법을 사용하든, Terraform을 실행할 계정은 Introduction에서 설명한 모든 구성 요소를 생성할 수 있는 권한을 가지고 있어야 합니다.

<div id="general-steps">
  ## 일반 단계
</div>

이 항목에서 설명하는 단계는 이 문서에서 다루는 모든 배포 옵션에 공통으로 적용됩니다.

1. 개발 환경을 준비합니다.
   * [Terraform](https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli)을 설치합니다.
   * 사용할 코드를 저장할 Git 리포지토리를 만드는 것을 권장하지만, 로컬에 파일을 둔 채로 사용해도 됩니다.

2. **`terraform.tfvars` 파일을 생성합니다.** `tvfars` 파일의 내용은 설치 유형에 따라 사용자 정의할 수 있지만, 최소 권장 구성은 아래 예시와 같습니다.

   ```bash
    namespace     = "wandb"
    wandb_license = "xxxxxxxxxxyyyyyyyyyyyzzzzzzz"
    subdomain     = "wandb-aws"
    domain_name   = "wandb.ml"
    location      = "westeurope"
   ```

   여기에서 정의하는 변수들은 배포 전에 미리 결정해야 합니다. `namespace` 변수는 Terraform이 생성하는 모든 리소스 이름 앞에 붙는 문자열입니다.

   `subdomain`과 `domain` 값을 조합하면 W&amp;B가 설정될 FQDN이 결정됩니다. 위 예시에서 W&amp;B FQDN은 `wandb-aws.wandb.ml`이 되며, 이 FQDN 레코드가 생성될 DNS `zone_id`와 연결됩니다.

3. **`versions.tf` 파일을 생성합니다.**

   이 파일에는 AWS에 W&amp;B를 배포하는 데 필요한 Terraform 버전과 Terraform provider 버전이 포함됩니다.

   ```bash
     terraform {
    required_version = "~> 1.3"

    required_providers {
      azurerm = {
        source  = "hashicorp/azurerm"
        version = "~> 3.17"
      }
    }
     }
   ```

   AWS provider를 설정하려면 [Terraform 공식 문서](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#provider-configuration)를 참고하십시오.

   선택 사항이지만 **강력히 권장하는 내용**으로, 문서의 앞부분에서 언급한 [remote backend 설정](https://developer.hashicorp.com/terraform/language/backend)을 추가할 수 있습니다.

4. **`variables.tf` 파일을 생성합니다.** `terraform.tfvars`에서 설정한 각 옵션에 대해 Terraform에는 이에 대응하는 변수 선언이 필요합니다.

   ```bash
       variable "namespace" {
         type        = string
         description = "리소스 이름 앞에 붙일 문자열입니다."
       }

       variable "location" {
         type        = string
         description = "Azure Resource Group 위치"
       }

       variable "domain_name" {
         type        = string
         description = "Weights & Biases UI에 접근하기 위한 도메인입니다."
       }

       variable "subdomain" {
         type        = string
         default     = null
         description = "Weights & Biases UI에 접근하기 위한 서브도메인입니다. 기본값은 Route53 Route에 레코드를 생성합니다."
       }

       variable "license" {
         type        = string
         description = "사용자의 wandb/local 라이선스"
       }
   ```

<div id="recommended-deployment">
  ## 권장 배포
</div>

이 배포 구성은 가장 간단한 옵션으로, 모든 필수(`Mandatory`) 구성요소를 생성하고 `Kubernetes Cluster`에 최신 버전의 `W&B`를 설치합니다.

1. **`main.tf` 생성**

   `General Steps`에서 파일을 생성했던 것과 동일한 디렉터리에 다음 내용을 가진 `main.tf` 파일을 생성합니다:

   ```bash
     provider "azurerm" {
    features {}
     }

     provider "kubernetes" {
    host                   = module.wandb.cluster_host
    cluster_ca_certificate = base64decode(module.wandb.cluster_ca_certificate)
    client_key             = base64decode(module.wandb.cluster_client_key)
    client_certificate     = base64decode(module.wandb.cluster_client_certificate)
     }

     provider "helm" {
    kubernetes {
      host                   = module.wandb.cluster_host
      cluster_ca_certificate = base64decode(module.wandb.cluster_ca_certificate)
      client_key             = base64decode(module.wandb.cluster_client_key)
      client_certificate     = base64decode(module.wandb.cluster_client_certificate)
    }
     }

     # 필요한 모든 서비스를 기동합니다
     module "wandb" {
    source  = "wandb/wandb/azurerm"
    version = "~> 1.2"

    namespace   = var.namespace
    location    = var.location
    license     = var.license
    domain_name = var.domain_name
    subdomain   = var.subdomain

    deletion_protection = false

    tags = {
      "Example" : "PublicDns"
    }
     }

     output "address" {
    value = module.wandb.address
     }

     output "url" {
    value = module.wandb.url
     }
   ```

2. **W&amp;B 배포**

   W&amp;B를 배포하려면 다음 명령을 실행합니다:

   ```
   terraform init
   terraform apply -var-file=terraform.tfvars
   ```

<div id="deployment-with-redis-cache">
  ## Redis 캐시를 사용한 배포
</div>

또 다른 배포 옵션으로 `Redis`를 사용해 SQL 쿼리를 캐싱하여, 실험 메트릭을 로드할 때 애플리케이션 응답 속도를 높일 수 있습니다.

캐시를 활성화하려면 [권장 배포](#recommended-deployment)에서 사용한 동일한 `main.tf` 파일에 `create_redis = true` 옵션을 추가해야 합니다.

```bash
# 필요한 모든 서비스 시작
module "wandb" {
  source  = "wandb/wandb/azurerm"
  version = "~> 1.2"


  namespace   = var.namespace
  location    = var.location
  license     = var.license
  domain_name = var.domain_name
  subdomain   = var.subdomain

  create_redis       = true # Redis 생성
  [...]
```

<div id="deployment-with-external-queue">
  ## 외부 큐를 사용하는 배포
</div>

배포 옵션 3은 외부 `message broker`를 활성화하는 것입니다. W&amp;B에는 이미 내장 broker가 있으므로 이는 선택 사항입니다. 이 옵션은 성능상 이점을 제공하지 않습니다.

`message broker`를 제공하는 Azure 리소스는 `Azure Event Grid`이며, 이를 활성화하려면 [권장 배포](#recommended-deployment)에서 사용했던 동일한 `main.tf`에 `use_internal_queue = false` 옵션을 추가해야 합니다.

```bash
# 필요한 모든 서비스 시작
module "wandb" {
  source  = "wandb/wandb/azurerm"
  version = "~> 1.2"


  namespace   = var.namespace
  location    = var.location
  license     = var.license
  domain_name = var.domain_name
  subdomain   = var.subdomain

  use_internal_queue       = false # Azure Event Grid 활성화
  [...]
}
```

<div id="other-deployment-options">
  ## 기타 배포 옵션
</div>

세 가지 배포 옵션을 모두 조합해 사용할 수 있으며, 모든 구성을 하나의 파일에 정의할 수 있습니다.
[Terraform 모듈](https://github.com/wandb/terraform-azure-wandb)은 표준 옵션 및 [권장 배포](#recommended-deployment)에 있는 최소 구성과 함께 조합해 사용할 수 있는 여러 옵션을 제공합니다.