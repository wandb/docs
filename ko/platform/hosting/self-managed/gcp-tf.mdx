---
description: Google Cloud에서 W&B Server 호스팅.
title: Google Cloud에 W&B Platform 배포
---

<Note>
  W&amp;B는 [W&amp;B Multi-tenant Cloud](/ko/platform/hosting/hosting-options/multi_tenant_cloud) 또는 [W&amp;B Dedicated Cloud](/ko/platform/hosting/hosting-options/dedicated_cloud/)와 같은 완전 관리형 배포 옵션을 사용할 것을 권장합니다. W&amp;B 완전 관리형 서비스는 구성 작업이 거의 필요 없거나 전혀 필요 없으며, 간단하고 안전하게 사용할 수 있습니다.
</Note>

Self-Managed W&amp;B Server를 사용하기로 결정했다면, W&amp;B는 Google Cloud에 플랫폼을 배포하기 위해 [W&amp;B Server Google Cloud Terraform Module](https://registry.terraform.io/modules/wandb/wandb/google/latest)을 사용할 것을 권장합니다.

이 모듈에 대한 문서는 방대하며, 사용할 수 있는 모든 옵션을 포함합니다.

시작하기 전에, W&amp;B는 [State File](https://developer.hashicorp.com/terraform/language/state)을 저장하기 위해 Terraform에서 사용할 수 있는 [remote backends](https://developer.hashicorp.com/terraform/language/backend/remote) 중 하나를 선택할 것을 권장합니다.

State File은 모든 컴포넌트를 다시 생성하지 않고도 배포에 대한 업그레이드를 진행하거나 변경 사항을 적용하는 데 필요한 리소스입니다.

Terraform Module은 다음과 같은 `필수` 컴포넌트를 배포합니다:

* VPC
* Cloud SQL for MySQL
* Cloud Storage Bucket
* Google Kubernetes Engine
* Memorystore for Redis
* KMS Crypto Key
* Load Balancer

다른 배포 옵션에는 다음과 같은 선택적 컴포넌트도 포함될 수 있습니다:

* Memory store for Redis
* Pub/Sub 메시징 시스템

<div id="prerequisite-permissions">
  ## 사전 필수 권한
</div>

Terraform을 실행할 계정은 사용하는 Google Cloud 프로젝트에서 `roles/owner` 역할이 있어야 합니다.

<div id="general-steps">
  ## 일반적인 단계
</div>

이 항목의 단계는 이 문서에서 다루는 모든 배포 옵션에 공통적으로 적용됩니다.

1. 개발 환경을 준비합니다.
   * [Terraform](https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli)을 설치합니다.
   * 사용하려는 코드를 포함하는 Git 저장소를 만드는 것을 권장하지만, 로컬에 파일을 두어도 됩니다.
   * [Google Cloud Console](https://console.cloud.google.com/)에서 프로젝트를 생성합니다.
   * `gcloud auth application-default login`을 사용해 Google Cloud에 인증합니다(먼저 [gcloud를 설치](https://cloud.google.com/sdk/docs/install)했는지 확인하세요).

2. `terraform.tfvars` 파일을 생성합니다.

   `tvfars` 파일 내용은 설치 유형에 따라 사용자 환경에 맞게 변경할 수 있지만, 최소 권장 설정은 아래 예시와 비슷합니다.

   ```bash
   project_id  = "wandb-project"
   region      = "europe-west2"
   zone        = "europe-west2-a"
   namespace   = "wandb"
   license     = "xxxxxxxxxxyyyyyyyyyyyzzzzzzz"
   subdomain   = "wandb-gcp"
   domain_name = "wandb.ml"
   ```

   여기에서 정의된 변수들은 배포 전에 미리 결정해야 합니다. `namespace` 변수는 Terraform이 생성하는 모든 리소스 이름 앞에 붙는 문자열입니다.

   `subdomain`과 `domain`을 조합해 W&amp;B가 구성될 FQDN을 만듭니다. 위 예시에서는 W&amp;B FQDN이 `wandb-gcp.wandb.ml`이 됩니다.

3. `variables.tf` 파일을 생성합니다.

   `terraform.tfvars`에서 설정된 각 옵션에 대해 Terraform에는 이에 대응하는 변수 선언이 필요합니다.

   ```hcl
   variable "project_id" {
     type        = string
     description = "Project ID"
   }

   variable "region" {
     type        = string
     description = "Google region"
   }

   variable "zone" {
     type        = string
     description = "Google zone"
   }

   variable "namespace" {
     type        = string
     description = "Namespace prefix used for resources"
   }

   variable "domain_name" {
     type        = string
     description = "Domain name for accessing the Weights & Biases UI."
   }

   variable "subdomain" {
     type        = string
     description = "Subdomain for access the Weights & Biases UI."
   }

   variable "license" {
     type        = string
     description = "W&B License"
   }
   ```

<div id="deployment-recommended-20-mins">
  ## 배포 - 권장 (~20분)
</div>

이 구성은 가장 간단한 배포 옵션으로, 모든 `Mandatory` 컴포넌트를 생성하고 `Kubernetes Cluster`에 최신 버전의 `W&B`를 설치합니다.

1. `main.tf` 파일을 생성합니다.

   [General Steps](#general-steps)에서 파일을 생성했던 것과 동일한 디렉터리에 다음 내용을 포함하는 `main.tf` 파일을 생성합니다:

   ```hcl
   provider "google" {
    project = var.project_id
    region  = var.region
    zone    = var.zone
   }

   provider "google-beta" {
    project = var.project_id
    region  = var.region
    zone    = var.zone
   }

   data "google_client_config" "current" {}

   provider "kubernetes" {
     host                   = "https://${module.wandb.cluster_endpoint}"
     cluster_ca_certificate = base64decode(module.wandb.cluster_ca_certificate)
     token                  = data.google_client_config.current.access_token
   }

   # 필요한 모든 서비스를 프로비저닝합니다
   module "wandb" {
     source  = "wandb/wandb/google"
     version = "~> 10.0"

     namespace   = var.namespace
     license     = var.license
     domain_name = var.domain_name
     subdomain   = var.subdomain
   }

   # 프로비저닝된 IP 주소로 DNS를 업데이트해야 합니다
   output "url" {
     value = module.wandb.url
   }

   output "address" {
     value = module.wandb.address
   }

   output "bucket_name" {
     value = module.wandb.bucket_name
   }
   ```

2. W&amp;B를 배포합니다.

   W&amp;B를 배포하려면 다음 명령을 실행합니다:

   ```bash
   terraform init
   terraform apply -var-file=terraform.tfvars
   ```

<div id="other-deployment-options">
  ## 기타 배포 옵션
</div>

세 가지 배포 옵션을 모두 조합하여 모든 구성을 하나의 파일에 추가할 수 있습니다.
[Terraform Module](https://github.com/wandb/terraform-google-wandb)은 표준 옵션 및 `Deployment - Recommended`에 있는 최소 구성과 함께 조합해 사용할 수 있는 여러 가지 옵션을 제공합니다.

{/* ## 업그레이드(출시 예정) */}

<div id="manual-configuration">
  ## 수동 구성
</div>

W&amp;B의 파일 스토리지 백엔드로 Google Cloud Storage 버킷을 사용하려면 다음을 생성해야 합니다.

* [Pub/Sub 주제 및 구독](#create-pubsub-topic-and-subscription)
* [스토리지 버킷](#create-storage-bucket)
* [Pub/Sub 알림](#create-pubsub-notification)

<div id="create-pubsub-topic-and-subscription">
  ### PubSub Topic 및 Subscription 생성
</div>

아래 절차에 따라 Pub/Sub Topic과 Subscription을 생성합니다:

1. Google Cloud Console에서 Pub/Sub 서비스로 이동합니다.
2. **Create Topic**을 선택하고 Topic 이름을 입력합니다.
3. 페이지 하단에서 **Create subscription**을 선택합니다. **Delivery Type**이 **Pull**로 설정되어 있는지 확인합니다.
4. **Create**를 클릭합니다.

인스턴스를 실행 중인 서비스 계정 또는 사용자 계정에 이 Subscription에 대한 `pubsub.admin` 역할이 부여되어 있는지 확인하세요. 자세한 내용은 [Google Cloud Pub/Sub 액세스 제어 문서](https://cloud.google.com/pubsub/docs/access-control#console)를 참고하세요.

<div id="create-storage-bucket">
  ### 스토리지 버킷 생성
</div>

1. **Cloud Storage Buckets** 페이지로 이동합니다.

2. **Create bucket**을 선택하고 버킷 이름을 지정합니다. **Standard** [storage class](https://cloud.google.com/storage/docs/storage-classes)를 선택했는지 확인합니다.

   인스턴스가 실행 중인 서비스 계정 또는 계정에 다음 두 가지가 모두 있는지 확인합니다.

   * 이전 단계에서 생성한 버킷에 대한 액세스 권한
   * 이 버킷에 대한 `storage.objectAdmin` 역할. 자세한 내용은 [Google Cloud Storage IAM permissions documentation](https://cloud.google.com/storage/docs/access-control/using-iam-permissions#bucket-add)을 참조하세요.

   <Note>
     인스턴스는 서명된 파일 URL을 생성하기 위해 Google Cloud에서 `iam.serviceAccounts.signBlob` 권한도 필요합니다. 이 권한을 활성화하려면 인스턴스가 실행 중인 서비스 계정 또는 IAM 구성원에게 `Service Account Token Creator` 역할을 추가하세요.
   </Note>

3. CORS 액세스를 활성화합니다. 이 작업은 명령줄을 사용해서만 수행할 수 있습니다. 먼저, 다음 CORS 구성이 포함된 JSON 파일을 생성합니다.

   ```yaml
   cors:
   - maxAgeSeconds: 3600
     method:
      - GET
      - PUT
        origin:
      - '<YOUR_W&B SERVER_HOST>'
        responseHeader:
      - Content-Type
   ```

   origin 값의 스킴, 호스트, 포트가 정확히 일치해야 합니다.

4. `gcloud`가 설치되어 있고 올바른 Google Cloud 프로젝트에 로그인되어 있는지 확인합니다.

5. 다음 명령을 실행합니다.

   ```bash
   gcloud storage buckets update gs://<BUCKET_NAME> --cors-file=<CORS_CONFIG_FILE>
   ```

<div id="create-pubsub-notification">
  ### PubSub 알림 생성
</div>

Storage Bucket에서 Pub/Sub 토픽으로 알림 스트림을 생성하려면, 아래 절차를 명령줄에서 실행하세요.

<Note>
  알림 스트림을 생성하려면 CLI를 사용해야 합니다. `gcloud`가 설치되어 있는지 확인하세요.
</Note>

1. Google Cloud 프로젝트에 로그인합니다.

2. 터미널에서 다음 명령을 실행합니다:

   ```bash
   gcloud pubsub topics list  # 참고용 토픽 이름 목록
   gcloud storage ls          # 참고용 버킷 이름 목록

   # 버킷 알림 생성
   gcloud storage buckets notifications create gs://<BUCKET_NAME> --topic=<TOPIC_NAME>
   ```

[자세한 내용은 Cloud Storage 웹사이트의 문서를 참조하세요.](https://cloud.google.com/storage/docs/reporting-changes)

<div id="configure-wb-server">
  ### W&amp;B 서버 구성
</div>

1. 마지막으로 W&amp;B의 `System Connections` 페이지 `http(s)://YOUR-W&B-SERVER-HOST/console/settings/system`로 이동합니다.

2. `Google Cloud Storage (gcs)` 공급자를 선택합니다.

3. GCS 버킷 이름을 입력합니다.

   <Frame>
     <img src="/images/hosting/configure_file_store_gcp.png" alt="Google Cloud 파일 스토리지 구성" />
   </Frame>

4. **Update settings** 버튼을 눌러 새 설정을 적용합니다.

<div id="upgrade-wb-server">
  ## W&amp;B Server 업그레이드
</div>

W&amp;B Server는 W&amp;B Operator에 의해 자동으로 업그레이드됩니다. 이 기능을 끄려면 시스템 콘솔에서 이미지를 오버라이드하도록 `UserSpec`을 업데이트할 수 있습니다.

이미지를 특정 버전에 고정하려면:

1. 시스템 콘솔에서 ActiveSpec에 접속합니다: `https://<W&B URL>/console/settings/advanced/spec/active`.

2. 다음과 비슷한 구성 요소 이미지 설정을 복사합니다:

   ```yaml
     api:
       image:
         tag: 0.75.2
       initContainers:
         init-db:
           image:
             tag: 0.75.2
   ```

   <Frame>
     <img src="/images/hosting/active_spec.png" alt="W&B System Console - ActiveSpec" />
   </Frame>

3. 복사한 구성 요소 설정을 `UserSpec`에 붙여넣고 image tag를 교체합니다.

   ```yaml
   chart: {}
   values:
     api:
       image:
         tag: 0.76.3
       initContainers:
         init-db:
           image:
             tag: 0.76.3
   ```

   <Frame>
     <img src="/images/hosting/user_spec.png" alt="W&B System Console - UserSpec" />
   </Frame>

4. `Save`를 클릭합니다.

5. `Operator` 탭으로 이동한 다음 `Trigger reapply`를 클릭합니다.

   <Frame>
     <img src="/images/hosting/operator.png" alt="W&B System Console - Operator" />
   </Frame>

그러면 W&amp;B Operator가 구성을 조정하여 이미지를 지정된 버전에 고정합니다.