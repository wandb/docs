---
description: Google Cloud에서 W&B Server 호스팅.
title: Google Cloud에 W&B Platform 배포
---

<Note>
  W&amp;B는 [W&amp;B Multi-tenant Cloud](/ko/platform/hosting/hosting-options/multi_tenant_cloud) 또는 [W&amp;B Dedicated Cloud](/ko/platform/hosting/hosting-options/dedicated_cloud/)와 같은 완전 관리형 배포 옵션을 사용할 것을 권장합니다. W&amp;B 완전 관리형 서비스는 최소한의 설정만으로, 또는 설정 없이도 간편하고 안전하게 사용할 수 있습니다.
</Note>

Self-Managed W&amp;B Server 방식으로 배포하기로 했다면, Google Cloud에 플랫폼을 배포할 때 [W&amp;B Server Google Cloud Terraform Module](https://registry.terraform.io/modules/wandb/wandb/google/latest)을 사용할 것을 W&amp;B는 권장합니다.

이 모듈에 대한 문서는 매우 방대하며, 사용할 수 있는 모든 옵션을 포함하고 있습니다.

시작하기 전에, Terraform의 [State File](https://developer.hashicorp.com/terraform/language/state)을 저장하기 위해 Terraform에서 사용할 수 있는 [remote backends](https://developer.hashicorp.com/terraform/language/backend/remote) 중 하나를 선택할 것을 W&amp;B는 권장합니다.

State File은 모든 구성 요소를 다시 생성하지 않고도 배포를 업그레이드하거나 변경 사항을 적용하는 데 필요한 리소스입니다.

Terraform Module은 다음과 같은 `mandatory` 구성 요소를 배포합니다:

* VPC
* Cloud SQL for MySQL
* Cloud Storage Bucket
* Google Kubernetes Engine
* Memorystore for Redis
* KMS Crypto Key
* Load Balancer

다른 배포 옵션에는 다음과 같은 선택적 구성 요소도 포함될 수 있습니다:

* Memorystore for Redis
* Pub/Sub 메시징 시스템

<div id="prerequisite-permissions">
  ## 필수 권한
</div>

Terraform을 실행하는 계정은 사용 중인 Google Cloud 프로젝트에서 `roles/owner` 역할을 보유하고 있어야 합니다.

<div id="general-steps">
  ## 일반 단계
</div>

이 항목의 단계는 이 문서에서 다루는 모든 배포 옵션에 공통적으로 적용됩니다.

1. 개발 환경을 준비합니다.
   * [Terraform](https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli)을 설치합니다.
   * 사용하려는 코드를 저장할 Git 리포지토리를 만드는 것을 권장하지만, 파일을 로컬에만 보관해도 됩니다.
   * [Google Cloud Console](https://console.cloud.google.com/)에서 프로젝트를 생성합니다.
   * `gcloud auth application-default login`을 사용해 Google Cloud에 인증합니다. 이 전에 [gcloud를 설치](https://cloud.google.com/sdk/docs/install)했는지 확인합니다.

2. `terraform.tfvars` 파일을 생성합니다.

   `tvfars` 파일 내용은 설치 유형에 따라 맞춤 구성할 수 있지만, 최소 권장 내용은 아래 예시와 같습니다.

   ```bash
   project_id  = "wandb-project"
   region      = "europe-west2"
   zone        = "europe-west2-a"
   namespace   = "wandb"
   license     = "xxxxxxxxxxyyyyyyyyyyyzzzzzzz"
   subdomain   = "wandb-gcp"
   domain_name = "wandb.ml"
   ```

   여기에서 정의하는 변수들은 배포 전에 미리 결정해야 합니다. `namespace` 변수는 Terraform이 생성하는 모든 리소스 이름 앞에 붙는 문자열입니다.

   `subdomain`과 `domain`의 조합은 W&amp;B가 구성될 FQDN을 형성합니다. 위 예시에서 W&amp;B FQDN은 `wandb-gcp.wandb.ml`이 됩니다.

3. `variables.tf` 파일을 생성합니다.

   `terraform.tfvars`에서 설정한 각 옵션에 대해 Terraform은 해당하는 변수 선언을 요구합니다.

   ```hcl
   variable "project_id" {
     type        = string
     description = "Project ID"
   }

   variable "region" {
     type        = string
     description = "Google region"
   }

   variable "zone" {
     type        = string
     description = "Google zone"
   }

   variable "namespace" {
     type        = string
     description = "Namespace prefix used for resources"
   }

   variable "domain_name" {
     type        = string
     description = "Domain name for accessing the Weights & Biases UI."
   }

   variable "subdomain" {
     type        = string
     description = "Subdomain for access the Weights & Biases UI."
   }

   variable "license" {
     type        = string
     description = "W&B License"
   }
   ```

<div id="deployment-recommended-20-mins">
  ## 배포 - 권장 (~20분)
</div>

이는 가장 직관적인 배포 옵션 구성이며, 모든 `Mandatory` 구성 요소를 생성하고 `Kubernetes Cluster`에 최신 버전의 `W&B`를 설치합니다.

1. `main.tf` 파일을 생성합니다.

   [General Steps](#general-steps)에서 파일을 생성했던 것과 동일한 디렉터리에, 아래 내용을 포함한 `main.tf` 파일을 생성합니다.

   ```hcl
   provider "google" {
    project = var.project_id
    region  = var.region
    zone    = var.zone
   }

   provider "google-beta" {
    project = var.project_id
    region  = var.region
    zone    = var.zone
   }

   data "google_client_config" "current" {}

   provider "kubernetes" {
     host                   = "https://${module.wandb.cluster_endpoint}"
     cluster_ca_certificate = base64decode(module.wandb.cluster_ca_certificate)
     token                  = data.google_client_config.current.access_token
   }

   # 필요한 모든 서비스를 시작합니다
   module "wandb" {
     source  = "wandb/wandb/google"
     version = "~> 10.0"

     namespace   = var.namespace
     license     = var.license
     domain_name = var.domain_name
     subdomain   = var.subdomain
   }

   # 프로비저닝된 IP 주소로 DNS 레코드를 업데이트해야 합니다
   output "url" {
     value = module.wandb.url
   }

   output "address" {
     value = module.wandb.address
   }

   output "bucket_name" {
     value = module.wandb.bucket_name
   }
   ```

2. W&amp;B를 배포합니다.

   W&amp;B를 배포하려면 다음 명령을 실행하세요.

   ```bash
   terraform init
   terraform apply -var-file=terraform.tfvars
   ```

<div id="other-deployment-options">
  ## 기타 배포 옵션
</div>

세 가지 배포 옵션을 모두 조합하여 모든 설정을 하나의 파일에 넣을 수 있습니다.
[Terraform Module](https://github.com/wandb/terraform-google-wandb)은 표준 옵션 및 `Deployment - Recommended`에 나와 있는 최소 설정과 함께 조합할 수 있는 여러 가지 옵션을 제공합니다.

{/* ## 업그레이드 (곧 제공 예정) */}

<div id="manual-configuration">
  ## 수동 설정
</div>

W&amp;B의 파일 스토리지 백엔드로 Google Cloud Storage 버킷을 사용하려면 다음을 생성해야 합니다.

* [PubSub 토픽 및 구독](#create-pubsub-topic-and-subscription)
* [Storage 버킷](#create-storage-bucket)
* [PubSub 알림](#create-pubsub-notification)

<div id="create-pubsub-topic-and-subscription">
  ### Pub/Sub 주제 및 구독 생성
</div>

아래 절차에 따라 Pub/Sub 주제와 구독을 생성합니다.

1. Google Cloud Console에서 Pub/Sub 서비스로 이동합니다.
2. **Create Topic**을 선택하고 주제 이름을 입력합니다.
3. 페이지 하단에서 **Create subscription**을 선택합니다. **Delivery Type**이 **Pull**로 설정되어 있는지 확인합니다.
4. **Create**를 클릭합니다.

인스턴스가 실행 중인 서비스 계정 또는 계정에 이 구독에 대한 `pubsub.admin` 역할이 부여되어 있는지 확인합니다. 자세한 내용은 [Google Cloud Pub/Sub 액세스 제어 문서](https://cloud.google.com/pubsub/docs/access-control#console)를 참조하세요.

<div id="create-storage-bucket">
  ### Storage 버킷 생성
</div>

1. **Cloud Storage Buckets** 페이지로 이동합니다.

2. **Create bucket**를 선택하고 버킷 이름을 입력합니다. **Standard** [storage class](https://cloud.google.com/storage/docs/storage-classes)를 선택했는지 확인합니다.

   인스턴스가 실행 중인 서비스 계정 또는 계정에는 다음 두 가지가 모두 있어야 합니다.

   * 이전 단계에서 생성한 버킷에 대한 액세스 권한
   * 이 버킷에 대한 `storage.objectAdmin` 역할. 자세한 내용은 [Google Cloud Storage IAM permissions 문서](https://cloud.google.com/storage/docs/access-control/using-iam-permissions#bucket-add)를 참고하세요.

   <Note>
     인스턴스에서 서명된 파일 URL을 생성하려면 Google Cloud의 `iam.serviceAccounts.signBlob` 권한도 필요합니다. 이 권한을 활성화하려면 인스턴스가 실행 중인 서비스 계정 또는 IAM 멤버에 `Service Account Token Creator` 역할을 추가하세요.
   </Note>

3. CORS 액세스를 활성화합니다. 이는 명령줄을 사용해서만 설정할 수 있습니다. 먼저 다음 CORS 설정을 포함하는 JSON 파일을 생성합니다.

   ```yaml
   cors:
   - maxAgeSeconds: 3600
     method:
      - GET
      - PUT
        origin:
      - '<YOUR_W&B SERVER_HOST>'
        responseHeader:
      - Content-Type
   ```

   origin에 지정하는 값의 스킴, 호스트, 포트가 정확히 일치해야 합니다.

4. `gcloud`가 설치되어 있고 올바른 Google Cloud 프로젝트에 로그인되어 있는지 확인합니다.

5. 다음 명령을 실행합니다.

   ```bash
   gcloud storage buckets update gs://<BUCKET_NAME> --cors-file=<CORS_CONFIG_FILE>
   ```

<div id="create-pubsub-notification">
  ### PubSub 알림 생성
</div>

Storage Bucket에서 Pub/Sub 토픽으로 가는 알림 스트림을 생성하려면, 아래 절차를 명령줄에서 따르세요.

<Note>
  알림 스트림을 생성하려면 반드시 CLI를 사용해야 합니다. `gcloud`가 설치되어 있는지 확인하세요.
</Note>

1. Google Cloud 프로젝트에 로그인하세요.

2. 터미널에서 다음을 실행하세요:

   ```bash
   gcloud pubsub topics list  # 참고용으로 토픽 이름 나열
   gcloud storage ls          # 참고용으로 버킷 이름 나열

   # 버킷 알림 생성
   gcloud storage buckets notifications create gs://<BUCKET_NAME> --topic=<TOPIC_NAME>
   ```

[자세한 내용은 Cloud Storage 문서를 참고하세요.](https://cloud.google.com/storage/docs/reporting-changes)

<div id="configure-wb-server">
  ### W&amp;B 서버 설정
</div>

1. 마지막으로 `http(s)://YOUR-W&B-SERVER-HOST/console/settings/system`에 있는 W&amp;B `System Connections` 페이지로 이동합니다.

2. 공급자로 `Google Cloud Storage (gcs)`를 선택합니다.

3. GCS 버킷 이름을 입력합니다.

   <Frame>
     <img src="/images/hosting/configure_file_store_gcp.png" alt="Google Cloud 파일 스토리지 설정" />
   </Frame>

4. **Update settings**를 클릭하여 새 설정을 적용합니다.

<div id="upgrade-wb-server">
  ## W&amp;B Server 업그레이드
</div>

W&amp;B는 W&amp;B Operator에 의해 자동으로 업그레이드됩니다. 이 기능을 끄려면 시스템 콘솔에서 이미지를 재정의하도록 UserSpec을 업데이트할 수 있습니다.

이미지를 특정 버전에 고정하려면:

1. 시스템 콘솔에서 ActiveSpec 페이지에 접속합니다: `https://<W&B URL>/console/settings/advanced/spec/active`.

2. 다음과 유사한 컴포넌트 이미지 설정을 복사합니다:

   ```yaml
     api:
       image:
         tag: 0.75.2
       initContainers:
         init-db:
           image:
             tag: 0.75.2
   ```

   <Frame>
     <img src="/images/hosting/active_spec.png" alt="W&B System Console - ActiveSpec" />
   </Frame>

3. 복사한 컴포넌트 설정을 `UserSpec`에 붙여넣고, 이미지 태그를 원하는 버전으로 교체합니다.

   ```yaml
   chart: {}
   values:
     api:
       image:
         tag: 0.76.3
       initContainers:
         init-db:
           image:
             tag: 0.76.3
   ```

   <Frame>
     <img src="/images/hosting/user_spec.png" alt="W&B System Console - UserSpec" />
   </Frame>

4. `Save`를 클릭합니다.

5. `Operator` 탭에 접속한 뒤 `Trigger reapply`를 클릭합니다.

   <Frame>
     <img src="/images/hosting/operator.png" alt="W&B System Console - Operator" />
   </Frame>

W&amp;B Operator는 설정을 동기화하고 이미지를 지정된 버전에 고정합니다.