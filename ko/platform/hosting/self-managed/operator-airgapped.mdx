---
description: Kubernetes Operator를 사용하여 에어갭 환경에서 W&B Platform 배포하기
title: 에어갭 인스턴스용 Kubernetes Operator
---

import SelfManagedVersionRequirements from "/snippets/ko/_includes/self-managed-version-requirements.mdx";
import SelfManagedSslTlsRequirements from "/snippets/ko/_includes/self-managed-ssl-tls-requirements.mdx";
import SelfManagedMysqlRequirements from "/snippets/ko/_includes/self-managed-mysql-requirements.mdx";
import SelfManagedMysqlDatabaseCreation from "/snippets/ko/_includes/self-managed-mysql-database-creation.mdx";
import SelfManagedRedisRequirements from "/snippets/ko/_includes/self-managed-redis-requirements.mdx";
import SelfManagedObjectStorageRequirements from "/snippets/ko/_includes/self-managed-object-storage-requirements.mdx";
import SelfManagedHardwareRequirements from "/snippets/ko/_includes/self-managed-hardware-requirements.mdx";
import SelfManagedVerifyInstallation from "/snippets/ko/_includes/self-managed-verify-installation.mdx";

<div id="introduction">
  ## 소개
</div>

이 가이드는 고객이 직접 관리하는 에어갭 환경에 W&amp;B Platform을 배포하기 위한 단계별 지침을 제공합니다.

Helm 차트와 컨테이너 이미지를 호스팅하기 위해 내부 리포지토리 또는 레지스트리를 사용하세요. Kubernetes 클러스터에 적절한 액세스 권한이 있는 셸 콘솔에서 모든 명령을 실행하세요.

Kubernetes 애플리케이션을 배포하는 데 사용하는 모든 지속적 딜리버리 도구에서도 이와 유사한 명령을 사용할 수 있습니다.

<div id="step-1-prerequisites">
  ## 1단계: 사전 준비 사항
</div>

시작하기 전에 사용 중인 환경이 다음 요구 사항을 충족하는지 확인하세요:

<div id="version-requirements">
  ### 버전 요건
</div>

<SelfManagedVersionRequirements />

<div id="ssltls-requirements">
  ### SSL/TLS 요구 사항
</div>

<SelfManagedSslTlsRequirements />

<div id="hardware-requirements">
  ### 하드웨어 요구 사항
</div>

<SelfManagedHardwareRequirements />

<div id="mysql-database">
  ### MySQL 데이터베이스
</div>

<SelfManagedMysqlRequirements />

<div id="redis">
  ### Redis
</div>

<SelfManagedRedisRequirements />

<div id="object-storage">
  ### 오브젝트 스토리지
</div>

<SelfManagedObjectStorageRequirements />

<div id="additional-requirements">
  ### 추가 요구 사항
</div>

* 필요한 W&amp;B 이미지가 있는 내부 컨테이너 레지스트리에 대한 접근 권한
* W&amp;B Helm 차트용 내부 Helm 리포지토리에 대한 접근 권한

네트워킹 및 로드 밸런서 설정을 포함한 전체 인프라 요구 사항은 [reference architecture](/ko/platform/hosting/self-managed/ref-arch/#infrastructure-requirements)를 참조하세요.

<Note>
  W&amp;B는 에어갭 환경의 OpenShift Kubernetes 클러스터에 배포할 수 있습니다. 자세한 내용은 [reference architecture](/ko/platform/hosting/self-managed/ref-arch/#kubernetes)를 참조하고, 에어갭 OpenShift 배포에 맞게 조정할 수 있는 구체적인 설정 지침은 Operator 가이드의 [OpenShift section](/ko/platform/hosting/operator/#openshift-kubernetes-clusters)을 검토하세요.
</Note>

<div id="step-2-prepare-internal-container-registry">
  ## 2단계: 내부 컨테이너 레지스트리 준비
</div>

에어갭 배포를 성공적으로 수행하려면, 다음 컨테이너 이미지들이 에어갭 컨테이너 레지스트리에 준비되어 있어야 합니다.

W&amp;B Operator의 요구 사항을 파악하고 컨테이너 레지스트리를 최신 이미지를 사용하도록 정기적으로 유지 관리하는 것은 사용자 책임입니다. 필요한 컨테이너 이미지와 버전의 최신 목록은 Helm 차트를 참고하거나, [support](mailto:support@wandb.com) 또는 AISE에 문의하세요.

<div id="core-wb-component-containers">
  ### 핵심 W&amp;B 구성 요소 컨테이너
</div>

* [`docker.io/wandb/controller`](https://hub.docker.com/r/wandb/controller)
* [`docker.io/wandb/local`](https://hub.docker.com/r/wandb/local)
* [`docker.io/wandb/console`](https://hub.docker.com/r/wandb/console)
* [`docker.io/wandb/megabinary`](https://hub.docker.com/r/wandb/megabinary)

<div id="dependencies">
  ### 의존성
</div>

* [`docker.io/bitnamilegacy/redis`](https://hub.docker.com/r/bitnamilegacy/redis): 테스트 및 개발 환경에서 로컬 Redis 배포에 필요합니다. 로컬 Redis 배포를 사용하려면 이 이미지가 컨테이너 레지스트리에 등록되어 있는지 확인하세요. 프로덕션 환경에서의 Redis 요구 사항은 사전 준비 사항에 있는 [Redis 섹션](#redis)을 참조하세요.
* [`docker.io/otel/opentelemetry-collector-contrib`](https://hub.docker.com/r/otel/opentelemetry-collector-contrib): W&amp;B는 Kubernetes 레이어의 리소스에서 메트릭과 로그를 수집해 W&amp;B에 표시하기 위해 OpenTelemetry 에이전트를 사용합니다.
* [`quay.io/prometheus/prometheus`](https://quay.io/repository/prometheus/prometheus): W&amp;B는 다양한 컴포넌트에서 메트릭을 수집해 W&amp;B에 표시하기 위해 Prometheus를 사용합니다.
* [`quay.io/prometheus-operator/prometheus-config-reloader`](https://quay.io/repository/prometheus-operator/prometheus-config-reloader): Prometheus에 필요한 필수 의존성입니다.

<div id="get-required-images">
  ### 필요한 이미지 가져오기
</div>

Helm 차트 values에서 필요한 이미지와 버전의 전체 목록을 추출하려면 다음 단계를 수행합니다:

1. [W&amp;B Helm charts repository](https://github.com/wandb/helm-charts)에서 W&amp;B Operator 및 Platform Helm 차트를 다운로드합니다.

2. `values.yaml` 파일을 확인하여 모든 컨테이너 이미지와 해당 버전을 확인합니다:

   ```bash
   # Helm 차트에서 이미지 참조 추출
   helm show values wandb/operator \
     | awk -F': *' '/^[[:space:]]*repository:/{print $2}' \
     | grep -E '^wandb/' \
     | sort -u
   ```

   목록은 다음과 비슷할 수 있습니다. 이미지 버전은 다를 수 있습니다.

   ```text
   wandb/anaconda2
   wandb/console
   wandb/frontend-nginx
   wandb/local
   wandb/megabinary
   wandb/weave-python
   wandb/weave-trace
   ```

<div id="step-3-prepare-internal-helm-chart-repository">
  ## 3단계: 내부 Helm 차트 리포지토리 준비
</div>

컨테이너 이미지와 함께, 내부 Helm 차트 리포지토리에 다음 Helm 차트가 사용 가능한지도 반드시 확인해야 합니다. 다음 위치에서 다운로드하세요:

* [W&amp;B Operator](https://github.com/wandb/helm-charts/tree/main/charts/operator)
* [W&amp;B Platform](https://github.com/wandb/helm-charts/tree/main/charts/operator-wandb)

`operator` 차트는 Controller Manager라고도 불리는 W&amp;B Operator를 배포하는 데 사용됩니다. `platform` 차트는 커스텀 리소스 정의(CRD)에 설정된 values를 사용하여 W&amp;B Platform을 배포하는 데 사용됩니다.

<div id="step-4-set-up-helm-repository">
  ## 4단계: Helm 리포지토리 설정
</div>

이제 내부 리포지토리에서 W&amp;B Helm 차트를 가져올 수 있도록 Helm 리포지토리를 설정합니다. Helm 리포지토리를 추가하고 업데이트하려면 다음 명령을 실행하세요:

```bash
helm repo add local-repo https://charts.yourdomain.com
helm repo update
```

<div id="step-5-install-the-kubernetes-operator">
  ## 5단계: Kubernetes 오퍼레이터 설치
</div>

W&amp;B Kubernetes 오퍼레이터(컨트롤러 매니저라고도 함)는 W&amp;B 플랫폼 컴포넌트를 관리하는 역할을 합니다. 에어갭 환경에 설치하려면 내부 컨테이너 레지스트리를 사용하도록 설정해야 합니다.

이를 위해 기본 이미지 설정을 재정의하여 내부 컨테이너 레지스트리를 사용하도록 하고, 배포 유형이 에어갭임을 나타내도록 `airgapped: true` 키를 설정해야 합니다. 아래와 같이 `values.yaml` 파일을 수정합니다:

```yaml
image:
  repository: registry.yourdomain.com/library/controller
  tag: 1.13.3
airgapped: true
```

내부 레지스트리에 있는 사용 가능한 버전으로 태그를 교체합니다.

operator와 CRD를 설치합니다.

```bash
helm upgrade --install operator local-repo/operator -n wandb --create-namespace -f values.yaml
```

지원되는 값에 대한 자세한 내용은 [Kubernetes operator GitHub 리포지토리](https://github.com/wandb/helm-charts/blob/main/charts/operator/values.yaml)를 참조하세요.

<div id="step-6-set-up-mysql-database">
  ## 6단계: MySQL 데이터베이스 설정
</div>

W&amp;B Custom Resource를 설정하기 전에 외부 MySQL 데이터베이스를 먼저 구성해야 합니다. 운영 환경 배포의 경우 W&amp;B는 관리형 데이터베이스 서비스를 사용하는 것을 강력히 권장합니다. 그러나 직접 MySQL 인스턴스를 운영하는 경우 다음과 같이 데이터베이스와 사용자를 생성하십시오:

<SelfManagedMysqlDatabaseCreation />

MySQL 설정 매개변수에 대해서는 [레퍼런스 아키텍처의 MySQL 설정 섹션](/ko/platform/hosting/self-managed/ref-arch/#mysql-configuration-parameters)을 참조하십시오.

<div id="step-7-configure-wb-custom-resource">
  ## 7단계: W&amp;B Custom Resource 설정
</div>

W&amp;B Kubernetes operator를 설치한 후, Custom Resource(CR)를 설정하여 내부 Helm 리포지토리와 컨테이너 레지스트리를 가리키도록 해야 합니다.

이 설정을 통해 Kubernetes operator가 W&amp;B 플랫폼의 필수 컴포넌트를 배포할 때 내부 레지스트리와 리포지토리를 사용하도록 보장합니다.

아래 예시 CR을 복사하여 `wandb.yaml`라는 새 파일을 만듭니다.

```yaml
apiVersion: apps.wandb.com/v1
kind: WeightsAndBiases
metadata:
  labels:
    app.kubernetes.io/instance: wandb
    app.kubernetes.io/name: weightsandbiases
  name: wandb
  namespace: default

spec:
  chart:
    url: http://charts.yourdomain.com
    name: operator-wandb
    version: 0.18.0

  values:
    global:
      host: https://wandb.yourdomain.com
      license: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
      bucket:
        accessKey: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
        secretKey: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
        name: s3.yourdomain.com:port #예: s3.yourdomain.com:9000
        path: bucket_name
        provider: s3
        region: us-east-1
      mysql:
        database: wandb
        host: mysql.home.lab
        password: password
        port: 3306
        user: wandb
      redis:
        host: redis.yourdomain.com
        port: 6379
        password: password
      api:
        enabled: true
      glue:
        enabled: true
      executor:
        enabled: true
      extraEnv:
        ENABLE_REGISTRY_UI: 'true'

    app:
      image:
        repository: registry.yourdomain.com/local
        tag: 0.59.2

    console:
      image:
        repository: registry.yourdomain.com/console
        tag: 2.12.2

    api:
      image:
        repository: registry.yourdomain.com/megabinary
        tag: 0.59.2

    executor:
      image:
        repository: registry.yourdomain.com/megabinary
        tag: 0.59.2

    glue:
      image:
        repository: registry.yourdomain.com/megabinary
        tag: 0.59.2

    parquet:
      image:
        repository: registry.yourdomain.com/megabinary
        tag: 0.59.2

    weave:
      image:
        repository: registry.yourdomain.com/weave-python
        tag: 0.59.2

    otel:
      image:
        repository: registry.yourdomain.com/otel/opentelemetry-collector-contrib
        tag: 0.97.0

    prometheus:
      server:
        image:
          repository: registry.yourdomain.com/prometheus/prometheus
          tag: v2.47.0
      configmapReload:
        prometheus:
          image:
            repository: registry.yourdomain.com/prometheus-operator/prometheus-config-reloader
            tag: v0.67.0

    ingress:
      annotations:
        nginx.ingress.kubernetes.io/proxy-body-size: 0
      class: nginx

    
```

W&amp;B 플랫폼을 배포하기 위해 Kubernetes Operator는 CR에 정의된 값을 사용하여 내부 리포지토리에 있는 `operator-wandb` Helm 차트를 구성합니다.

모든 태그와 버전을 내부 레지스트리에서 사용 가능한 버전으로 교체하세요. 위 예시는 가장 일반적으로 사용되는 컴포넌트를 보여줍니다. 배포 요구 사항에 따라 `settingsMigrationJob`, `weave-trace`, `filestream` 등 추가 컴포넌트의 이미지 리포지토리를 추가로 구성해야 할 수도 있습니다. 구성 가능한 컴포넌트의 전체 목록은 [W&amp;B Helm repository values 파일](https://github.com/wandb/helm-charts/blob/main/charts/operator-wandb/values.yaml)을 참고하세요.

<div id="step-8-deploy-the-wb-platform">
  ## 8단계: W&amp;B 플랫폼 배포
</div>

이제 Kubernetes operator와 CR이 설정되었으므로 `wandb.yaml` 설정을 적용하여 W&amp;B 플랫폼을 배포합니다.

```bash
kubectl apply -f wandb.yaml
```

<div id="step-9-verify-your-installation">
  ## 9단계: 설치 확인
</div>

<SelfManagedVerifyInstallation />

<div id="faq">
  ## FAQ
</div>

배포 과정에서 아래의 자주 묻는 질문(FAQ)과 문제 해결 팁을 참고하세요.

<div id="there-is-another-ingress-class-can-that-class-be-used">
  ### 다른 ingress 클래스가 있습니다. 그 클래스를 사용해도 되나요?
</div>

네, `values.yaml`에서 ingress 설정을 수정하여 사용할 ingress 클래스를 지정할 수 있습니다.

<div id="the-certificate-bundle-has-more-than-one-certificate-would-that-work">
  ### 인증서 번들에 인증서가 여러 개 들어 있습니다. 그래도 괜찮나요?
</div>

`values.yaml` 파일의 `customCACerts` 섹션에서 인증서들을 각각 별도의 항목으로 나누어야 합니다.

<div id="how-do-you-prevent-the-kubernetes-operator-from-applying-unattended-updates-is-that-possible">
  ### Kubernetes operator가 자동으로 업데이트를 적용하지 않도록 하려면 어떻게 해야 하나요? 그렇게 할 수 있나요?
</div>

W&amp;B 콘솔에서 자동 업데이트를 끌 수 있습니다. 지원되는 버전에 대해 궁금한 점이 있으면 담당 W&amp;B 팀에 문의하세요. W&amp;B는 주요 W&amp;B Server 릴리스를 최초 릴리스 날짜로부터 12개월 동안 지원합니다. **Self-Managed** 인스턴스를 사용하는 고객은 지원을 유지하기 위해 제때 업그레이드할 책임이 있습니다. 지원이 종료된 버전을 계속 사용하는 것은 피하세요. [릴리스 정책 및 프로세스](/ko/release-notes/release-policies)를 참고하세요.

<Note>
  W&amp;B는 **Self-Managed** 인스턴스를 사용하는 고객에게, 지원을 유지하고 최신 기능, 성능 개선 및 버그 수정을 받기 위해 최소한 분기마다 한 번 이상 최신 릴리스로 배포를 업데이트할 것을 강력히 권장합니다.
</Note>

<div id="does-the-deployment-work-if-the-environment-has-no-connection-to-public-repositories">
  ### 환경이 퍼블릭 리포지토리에 연결되지 않은 경우에도 배포가 작동하나요?
</div>

설정에서 `airgapped`를 `true`로 지정하면 Kubernetes 오퍼레이터는 내부 리소스만 사용하며 퍼블릭 리포지토리에 연결을 시도하지 않습니다.