---
description: 에어갭 및 분리된 Kubernetes 환경에서 W&B Platform 배포
title: 에어갭 Kubernetes 환경에 배포
---

import SelfManagedVersionRequirements from "/snippets/ko/_includes/self-managed-version-requirements.mdx";
import SelfManagedSslTlsRequirements from "/snippets/ko/_includes/self-managed-ssl-tls-requirements.mdx";
import SelfManagedMysqlRequirements from "/snippets/ko/_includes/self-managed-mysql-requirements.mdx";
import SelfManagedMysqlDatabaseCreation from "/snippets/ko/_includes/self-managed-mysql-database-creation.mdx";
import SelfManagedRedisRequirements from "/snippets/ko/_includes/self-managed-redis-requirements.mdx";
import SelfManagedObjectStorageRequirements from "/snippets/ko/_includes/self-managed-object-storage-requirements.mdx";
import SelfManagedHardwareRequirements from "/snippets/ko/_includes/self-managed-hardware-requirements.mdx";
import SelfManagedVerifyInstallation from "/snippets/ko/_includes/self-managed-verify-installation.mdx";

<div id="introduction">
  ## 소개
</div>

이 가이드는 에어갭(air-gapped), 완전 분리, 또는 네트워크가 제한된 고객 관리 환경에서 W&amp;B Platform을 배포하기 위한 단계별 지침을 제공합니다. 에어갭 배포는 다음과 같은 환경에서 일반적입니다:

* 보안이 중요한 정부 기관
* 엄격한 네트워크 분리가 필요한 금융 기관
* 규정 준수 요구 사항이 있는 의료 기관
* 산업 제어 시스템(ICS) 환경
* 기밀 네트워크를 사용하는 연구 시설

내부 컨테이너 레지스트리와 Helm 리포지토리를 사용하여 필요한 W&amp;B 이미지와 차트를 호스팅하십시오. Kubernetes 클러스터에 적절한 액세스 권한이 있는 셸 콘솔에서 다음 명령을 실행하십시오.

이 명령들은 Kubernetes 애플리케이션을 배포하는 데 사용하는 어떤 CI/CD 도구와도 연동되도록 조정하여 사용할 수 있습니다.

인터넷 연결이 가능한 표준 온프레미스 Kubernetes 배포의 경우, [Kubernetes Operator로 W&amp;B 배포하기](/ko/platform/hosting/self-managed/operator)를 참조하십시오.

<div id="prerequisites">
  ## 사전 준비 사항
</div>

시작하기 전에 에어갭 환경이 다음 요건을 충족하는지 확인하세요.

<div id="version-requirements">
  ### 버전 요구 사항
</div>

<SelfManagedVersionRequirements />

<div id="ssltls-requirements">
  ### SSL/TLS 요구 사항
</div>

<SelfManagedSslTlsRequirements />

<div id="hardware-requirements">
  ### 하드웨어 요구사항
</div>

<SelfManagedHardwareRequirements />

<div id="mysql-database">
  ### MySQL 데이터베이스
</div>

<SelfManagedMysqlRequirements />

셀프 매니지드 인스턴스의 MySQL 설정 매개변수는 [레퍼런스 아키텍처의 MySQL 설정 섹션](/ko/platform/hosting/self-managed/ref-arch#mysql-configuration-parameters)을 참고하세요.

<div id="redis">
  ### Redis
</div>

<SelfManagedRedisRequirements />

<div id="object-storage">
  ### 오브젝트 스토리지
</div>

<SelfManagedObjectStorageRequirements />

오브젝트 스토리지 프로비저닝에 대한 자세한 지침은 [Bring Your Own Bucket (BYOB)](/ko/platform/hosting/data-security/secure-storage-connector) 가이드를 참조하세요. 에어갭 환경에서는 일반적으로 MinIO Enterprise, NetApp StorageGRID, Dell ECS와 같은 온프레미스 S3 호환 스토리지를 사용합니다.

<div id="air-gapped-specific-requirements">
  ### 에어갭 환경 전용 요구 사항
</div>

위의 일반 요구 사항 외에 에어갭 배포에는 다음이 필요합니다:

* **내부 컨테이너 레지스트리**: 필요한 모든 W&amp;B 이미지를 포함한 프라이빗 컨테이너 레지스트리(Harbor, JFrog Artifactory, Nexus 등)에 대한 접근
* **내부 Helm 리포지토리**: W&amp;B Helm 차트를 포함한 프라이빗 Helm 차트 리포지토리에 대한 접근
* **이미지 전송 기능**: 인터넷이 연결된 시스템에서 에어갭 레지스트리로 컨테이너 이미지를 전송할 수 있는 수단
* **라이선스 파일**: 유효한 W&amp;B Enterprise 라이선스. 라이선스를 발급받으려면(예: 인터넷이 연결된 머신에서) Requirements 페이지의 [License](/ko/platform/hosting/self-managed/requirements#license) 섹션을 참고하거나 W&amp;B 계정 팀에 문의하세요.

네트워킹 및 로드 밸런서 설정을 포함한 전체 인프라 요구 사항은 [reference architecture](/ko/platform/hosting/self-managed/ref-arch#infrastructure-requirements)를 참고하세요.

<div id="prepare-your-air-gapped-environment">
  ## 에어갭(Air-gapped) 환경을 준비하기
</div>

<div id="step-1-set-up-internal-container-registry">
  ### 1단계: 내부 컨테이너 레지스트리 설정
</div>

에어갭 배포를 성공적으로 수행하려면 필요한 모든 컨테이너 이미지가 에어갭 컨테이너 레지스트리에 미리 준비되어 있어야 합니다.

<Note>
  W&amp;B Operator의 요구 사항을 파악하고, 최신 이미지를 사용하도록 컨테이너 레지스트리를 정기적으로 유지 관리하는 책임은 사용자에게 있습니다. 필요한 컨테이너 이미지와 버전의 최신 목록은 Helm 차트를 참조하거나, [W&amp;B Support](mailto:support@wandb.com) 또는 담당 W&amp;B 지원 엔지니어에게 문의하십시오.
</Note>

<div id="core-wb-component-containers">
  #### 핵심 W&amp;B 구성 요소 컨테이너
</div>

다음 핵심 컨테이너 이미지가 필요합니다.

* [`docker.io/wandb/controller`](https://hub.docker.com/r/wandb/controller) - W&amp;B Kubernetes Operator
* [`docker.io/wandb/local`](https://hub.docker.com/r/wandb/local) - W&amp;B 애플리케이션 서버
* [`docker.io/wandb/console`](https://hub.docker.com/r/wandb/console) - W&amp;B 관리 콘솔
* [`docker.io/wandb/megabinary`](https://hub.docker.com/r/wandb/megabinary) - W&amp;B 마이크로서비스 (API, executor, glue, parquet)

<div id="dependency-containers">
  #### 종속 컨테이너
</div>

다음 서드파티 종속 이미지가 필요합니다.

* [`docker.io/bitnamilegacy/redis`](https://hub.docker.com/r/bitnamilegacy/redis) - 테스트 및 개발 중 로컬 Redis 배포에 필요합니다. 프로덕션 환경에서의 Redis 요구 사항은 사전 준비 사항의 [Redis 섹션](#redis)을 참조하세요.
* [`docker.io/otel/opentelemetry-collector-contrib`](https://hub.docker.com/r/otel/opentelemetry-collector-contrib) - 메트릭과 로그를 수집하기 위한 OpenTelemetry 에이전트
* [`quay.io/prometheus/prometheus`](https://quay.io/repository/prometheus/prometheus) - 메트릭 수집을 위한 Prometheus
* [`quay.io/prometheus-operator/prometheus-config-reloader`](https://quay.io/repository/prometheus-operator/prometheus-config-reloader) - Prometheus의 종속 이미지

<div id="get-the-complete-image-list">
  #### 전체 이미지 목록 가져오기
</div>

Helm 차트에서 필요한 이미지와 해당 버전의 전체 목록을 추출하려면 다음 단계를 따르세요.

1. 인터넷에 연결된 시스템에서 [W&amp;B Helm charts repository](https://github.com/wandb/helm-charts)에서 W&amp;B Helm 차트를 다운로드하세요.

   ```bash
   # helm-charts 리포지토리 클론
   git clone https://github.com/wandb/helm-charts.git
   cd helm-charts
   ```

2. `values.yaml` 파일을 확인해 모든 컨테이너 이미지와 해당 버전을 식별하세요.

   ```bash
   # operator 차트에서 이미지 참조 추출
   helm show values charts/operator | grep -E "repository:|tag:" | grep -v "^#"

   # platform 차트에서 이미지 참조 추출
   helm show values charts/operator-wandb | grep -E "repository:|tag:" | grep -v "^#"
   ```

   또는, 다음 명령을 사용해 버전 태그 없이 리포지토리 이름만 추출할 수 있습니다.

   ```bash
   helm show values charts/operator-wandb \
     | awk -F': *' '/^[[:space:]]*repository:/{print $2}' \
     | grep -v "^#" \
     | sort -u
   ```

   리포지토리 목록은 다음과 비슷한 형태입니다.

   ```text
   wandb/controller
   wandb/local
   wandb/console
   wandb/megabinary
   wandb/weave-python
   wandb/weave-trace
   otel/opentelemetry-collector-contrib
   prometheus/prometheus
   prometheus-operator/prometheus-config-reloader
   bitnamilegacy/redis
   ```

   각 이미지에 대한 구체적인 버전 태그를 확인하려면, 위의 첫 번째 명령(`grep -E "repository:|tag:"`)을 사용하세요. 이 명령은 리포지토리 이름과 해당 버전 태그를 모두 표시합니다.

<div id="transfer-images-to-air-gapped-registry">
  #### 이미지를 에어갭 레지스트리로 전송
</div>

1. 인터넷에 연결된 시스템에서 필요한 모든 이미지를 pull해서 저장합니다.

   <Note>
     아래 예시의 버전 번호를 위의 2단계에서 Helm 차트를 확인해 얻은 실제 버전으로 교체하세요. 여기 표시된 버전은 예시이며 시간이 지나면 오래될 수 있습니다.
   </Note>

   셸 변수를 사용해 버전을 일관되게 관리합니다:

   ```bash
   # 버전 변수 설정 (Helm 차트 버전에 맞게 업데이트)
   CONTROLLER_VERSION="1.13.3"
   APP_VERSION="0.59.2"
   CONSOLE_VERSION="2.12.2"

   # 이미지 pull
   docker pull wandb/controller:${CONTROLLER_VERSION}
   docker pull wandb/local:${APP_VERSION}
   docker pull wandb/console:${CONSOLE_VERSION}
   docker pull wandb/megabinary:${APP_VERSION}
   # ... 필요한 다른 모든 이미지를 해당 버전으로 pull

   # 이미지를 .tar 파일로 저장
   docker save wandb/controller:${CONTROLLER_VERSION} -o wandb-controller-${CONTROLLER_VERSION}.tar
   docker save wandb/local:${APP_VERSION} -o wandb-local-${APP_VERSION}.tar
   docker save wandb/console:${CONSOLE_VERSION} -o wandb-console-${CONSOLE_VERSION}.tar
   docker save wandb/megabinary:${APP_VERSION} -o wandb-megabinary-${APP_VERSION}.tar
   # ... 나머지 모든 이미지 저장
   ```

2. 승인된 방법(USB 드라이브, 보안 파일 전송 등)을 사용해 `.tar` 파일을 에어갭 환경으로 전송합니다.

3. 에어갭 환경에서 이미지를 로드하고 내부 레지스트리에 push합니다:

   ```bash
   # 위에서 사용한 것과 동일한 버전 변수 설정
   CONTROLLER_VERSION="1.13.3"
   APP_VERSION="0.59.2"
   CONSOLE_VERSION="2.12.2"
   INTERNAL_REGISTRY="registry.yourdomain.com"

   # 이미지 로드
   docker load -i wandb-controller-${CONTROLLER_VERSION}.tar
   docker load -i wandb-local-${APP_VERSION}.tar
   docker load -i wandb-console-${CONSOLE_VERSION}.tar
   docker load -i wandb-megabinary-${APP_VERSION}.tar
   # ... 나머지 모든 이미지 로드

   # 내부 레지스트리용 태그 지정
   docker tag wandb/controller:${CONTROLLER_VERSION} ${INTERNAL_REGISTRY}/wandb/controller:${CONTROLLER_VERSION}
   docker tag wandb/local:${APP_VERSION} ${INTERNAL_REGISTRY}/wandb/local:${APP_VERSION}
   docker tag wandb/console:${CONSOLE_VERSION} ${INTERNAL_REGISTRY}/wandb/console:${CONSOLE_VERSION}
   docker tag wandb/megabinary:${APP_VERSION} ${INTERNAL_REGISTRY}/wandb/megabinary:${APP_VERSION}
   # ... 나머지 모든 이미지 태그 지정

   # 내부 레지스트리에 push
   docker push ${INTERNAL_REGISTRY}/wandb/controller:${CONTROLLER_VERSION}
   docker push ${INTERNAL_REGISTRY}/wandb/local:${APP_VERSION}
   docker push ${INTERNAL_REGISTRY}/wandb/console:${CONSOLE_VERSION}
   docker push ${INTERNAL_REGISTRY}/wandb/megabinary:${APP_VERSION}
   # ... 나머지 모든 이미지를 push
   ```

<div id="step-2-set-up-internal-helm-chart-repository">
  ### 2단계: 내부 Helm 차트 리포지토리 설정
</div>

컨테이너 이미지와 함께, 다음 Helm 차트들이 내부 Helm 리포지토리에서 사용 가능한지 확인합니다:

* [W&amp;B Operator 차트](https://github.com/wandb/helm-charts/tree/main/charts/operator)
* [W&amp;B Platform 차트](https://github.com/wandb/helm-charts/tree/main/charts/operator-wandb)

1. 인터넷에 연결된 시스템에서 차트를 다운로드합니다:

   ```bash
   # W&B Helm 리포지토리 추가
   helm repo add wandb https://wandb.github.io/helm-charts
   helm repo update

   # 차트 다운로드
   helm pull wandb/operator --version 1.13.3
   helm pull wandb/operator-wandb --version 0.18.0
   ```

2. `.tgz` 차트 파일을 에어갭 환경으로 전송한 뒤, 리포지토리 운영 절차에 따라 내부 Helm 리포지토리에 업로드합니다.

   `operator` 차트는 W&amp;B Kubernetes Operator(Controller Manager)를 배포합니다. `operator-wandb` 차트는 커스텀 리소스(CR)에 설정된 values를 사용해 W&amp;B Platform을 배포합니다.

<div id="step-3-configure-helm-repository-access">
  ### 3단계: Helm 리포지토리 액세스 설정
</div>

1. 에어갭된 환경에서 Helm이 내부 리포지토리를 사용하도록 다음과 같이 설정합니다:

   ```bash
   helm repo add local-repo https://charts.yourdomain.com
   helm repo update
   ```

2. 차트를 사용할 수 있는지 확인합니다:

   ```bash
   helm search repo local-repo/operator
   helm search repo local-repo/operator-wandb
   ```

<div id="deploy-wb-in-air-gapped-environment">
  ## 망 분리(air-gapped) 환경에서 W&amp;B 배포
</div>

<div id="step-4-install-the-kubernetes-operator">
  ### 4단계: Kubernetes Operator 설치
</div>

W&amp;B Kubernetes Operator (controller manager)는 W&amp;B 플랫폼 컴포넌트를 관리합니다. 에어갭 환경에서 설치하려면 내부 컨테이너 레지스트리를 사용하도록 설정해야 합니다.

1. 다음 내용을 포함하는 `values.yaml` 파일을 생성합니다:

   ```yaml
   image:
     repository: registry.yourdomain.com/wandb/controller
     tag: 1.13.3

   airgapped: true
   ```

   <Note>
     `repository`와 `tag`를 1단계에서 내부 레지스트리로 가져온 실제 버전으로 바꾸십시오. 여기 표시된 버전(`1.13.3`)은 예시이며, 시간이 지나면 최신이 아니게 됩니다.
   </Note>

2. Operator와 Custom Resource Definition (CRD)를 설치합니다:

   ```bash
   helm upgrade --install operator local-repo/operator \
     --namespace wandb \
     --create-namespace \
     --values values.yaml
   ```

3. Operator가 실행 중인지 확인합니다:

   ```bash
   kubectl get pods -n wandb
   ```

   `Running` 상태인 operator pod가 보여야 합니다.

지원되는 값에 대한 전체 내용은 [Kubernetes operator GitHub repository values 파일](https://github.com/wandb/helm-charts/blob/main/charts/operator/values.yaml)을 참조하십시오.

<div id="step-5-set-up-mysql-database">
  ### 5단계: MySQL 데이터베이스 설정
</div>

W&amp;B Custom Resource를 설정하기 전에 먼저 외부 MySQL 데이터베이스를 설정하십시오. 프로덕션 배포의 경우 W&amp;B는 가능한 경우 관리형 데이터베이스 서비스를 사용하는 것을 강력히 권장합니다. 그러나 자체적으로 MySQL 인스턴스를 운영하는 경우 다음과 같이 데이터베이스와 사용자를 생성하십시오:

<SelfManagedMysqlDatabaseCreation />

MySQL 설정 파라미터에 대해서는 [참조 아키텍처의 MySQL 설정 섹션](/ko/platform/hosting/self-managed/ref-arch#mysql-configuration-parameters)을 참조하십시오.

<div id="step-6-configure-wb-custom-resource">
  ### 6단계: W&amp;B Custom Resource 설정
</div>

W&amp;B Kubernetes Operator를 설치한 후, Custom Resource(CR)를 설정하여 내부 Helm 리포지토리와 컨테이너 레지스트리를 가리키도록 지정합니다.

이 설정을 통해 Kubernetes Operator가 W&amp;B 플랫폼의 필수 구성 요소를 배포할 때 내부 레지스트리와 리포지토리를 사용하도록 보장합니다.

<Note>
  아래 예제 설정의 이미지 버전 태그는 시간이 지나면 최신 상태가 아닐 수 있습니다. 1단계에서 내부 레지스트리에 업로드한 실제 버전으로 모든 `tag:` 값을 교체하십시오.
</Note>

다음 내용을 포함하는 `wandb.yaml` 파일을 만드십시오:

```yaml
apiVersion: apps.wandb.com/v1
kind: WeightsAndBiases
metadata:
  labels:
    app.kubernetes.io/instance: wandb
    app.kubernetes.io/name: weightsandbiases
  name: wandb
  namespace: wandb

spec:
  chart:
    url: https://charts.yourdomain.com
    name: operator-wandb
    version: 0.18.0

  values:
    global:
      host: https://wandb.yourdomain.com
      license: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
      
      bucket:
        accessKey: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
        secretKey: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
        name: s3.yourdomain.com:9000
        path: wandb
        provider: s3
        region: us-east-1
      
      mysql:
        database: wandb
        host: mysql.yourdomain.com
        password: <your-mysql-password>
        port: 3306
        user: wandb
      
      redis:
        host: redis.yourdomain.com
        port: 6379
        password: <your-redis-password>
      
      api:
        enabled: true
      
      glue:
        enabled: true
      
      executor:
        enabled: true
      
      extraEnv:
        ENABLE_REGISTRY_UI: 'true'

    # 모든 컴포넌트 이미지가 내부 레지스트리를 사용하도록 구성
    app:
      image:
        repository: registry.yourdomain.com/wandb/local
        tag: 0.59.2

    console:
      image:
        repository: registry.yourdomain.com/wandb/console
        tag: 2.12.2

    api:
      image:
        repository: registry.yourdomain.com/wandb/megabinary
        tag: 0.59.2

    executor:
      image:
        repository: registry.yourdomain.com/wandb/megabinary
        tag: 0.59.2

    glue:
      image:
        repository: registry.yourdomain.com/wandb/megabinary
        tag: 0.59.2

    parquet:
      image:
        repository: registry.yourdomain.com/wandb/megabinary
        tag: 0.59.2

    weave:
      image:
        repository: registry.yourdomain.com/wandb/weave-python
        tag: 0.59.2

    otel:
      image:
        repository: registry.yourdomain.com/otel/opentelemetry-collector-contrib
        tag: 0.97.0

    prometheus:
      server:
        image:
          repository: registry.yourdomain.com/prometheus/prometheus
          tag: v2.47.0
      configmapReload:
        prometheus:
          image:
            repository: registry.yourdomain.com/prometheus-operator/prometheus-config-reloader
            tag: v0.67.0

    ingress:
      annotations:
        nginx.ingress.kubernetes.io/proxy-body-size: 0
      class: nginx
```

<Note>
  모든 플레이스홀더 값(호스트 이름, 비밀번호, 태그 등)을 실제 설정값으로 바꾸십시오. 위의 예시는 가장 일반적으로 사용되는 컴포넌트를 보여 줍니다.
</Note>

배포 요구사항에 따라 다음과 같은 추가 컴포넌트용 이미지 리포지토리를 설정해야 할 수도 있습니다:

* `settingsMigrationJob`
* `weave-trace`
* `filestream`
* `flat-runs-table`

설정 가능한 컴포넌트의 전체 목록은 [W&amp;B Helm 리포지토리 values 파일](https://github.com/wandb/helm-charts/blob/main/charts/operator-wandb/values.yaml)을 참고하십시오.

<div id="step-7-deploy-the-wb-platform">
  ### 7단계: W&amp;B 플랫폼 배포
</div>

1. 플랫폼을 배포하기 위해 W&amp;B Custom Resource를 적용합니다:

   ```bash
   kubectl apply -f wandb.yaml
   ```

2. 배포 진행 상황을 모니터링합니다:

   ```bash
   # 생성 중인 파드를 실시간으로 확인합니다
   kubectl get pods -n wandb --watch

   # 배포 상태를 확인합니다
   kubectl get weightsandbiases -n wandb

   # 오퍼레이터 로그를 확인합니다
   kubectl logs -n wandb deployment/wandb-operator-controller-manager
   ```

   오퍼레이터가 필요한 모든 컴포넌트를 생성하는 데 시간이 걸릴 수 있으므로, 배포가 완료되기까지 몇 분 정도 소요될 수 있습니다.

<div id="openshift-configuration">
  ## OpenShift 설정
</div>

W&amp;B는 에어갭 환경의 OpenShift Kubernetes 클러스터에서의 배포를 완벽하게 지원합니다. OpenShift 배포는 OpenShift의 더 엄격한 보안 정책으로 인해 추가적인 보안 컨텍스트 설정이 필요합니다.

<div id="openshift-security-context-constraints">
  ### OpenShift 보안 컨텍스트 제약 조건
</div>

OpenShift는 파드 권한을 제어하기 위해 Security Context Constraints(SCC)를 사용합니다. 기본적으로 OpenShift에서는 파드에 `restricted` SCC를 할당하며, 이로 인해 컨테이너를 root 사용자로 실행할 수 없고 특정 사용자 ID를 사용해야 합니다.

<div id="option-1-use-restricted-scc-recommended">
  #### 옵션 1: restricted SCC 사용 (권장)
</div>

Custom Resource에서 적절한 보안 컨텍스트를 설정하여 W&amp;B 컴포넌트가 restricted SCC에서 실행되도록 구성합니다:

```yaml
spec:
  values:
    # 모든 파드에 대한 보안 컨텍스트 구성
    app:
      podSecurityContext:
        fsGroup: 1000
        runAsUser: 1000
        runAsNonRoot: true
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault

    console:
      podSecurityContext:
        fsGroup: 1000
        runAsUser: 1000
        runAsNonRoot: true
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault

    # 다른 컴포넌트에 대해 반복: api, executor, glue, parquet, weave
```

<div id="option-2-create-custom-scc-if-required">
  #### 옵션 2: 사용자 지정 SCC 생성(필요한 경우)
</div>

배포에 `restricted` SCC에서 제공하지 않는 기능이 필요한 경우, 사용자 지정 SCC를 생성합니다:

```yaml
apiVersion: security.openshift.io/v1
kind: SecurityContextConstraints
metadata:
  name: wandb-scc
allowHostDirVolumePlugin: false
allowHostIPC: false
allowHostNetwork: false
allowHostPID: false
allowHostPorts: false
allowPrivilegeEscalation: false
allowPrivilegedContainer: false
allowedCapabilities: []
defaultAddCapabilities: []
fsGroup:
  type: MustRunAs
  ranges:
    - min: 1000
      max: 65535
readOnlyRootFilesystem: false
requiredDropCapabilities:
  - ALL
runAsUser:
  type: MustRunAsRange
  uidRangeMin: 1000
  uidRangeMax: 65535
seLinuxContext:
  type: MustRunAs
supplementalGroups:
  type: RunAsAny
volumes:
  - configMap
  - downwardAPI
  - emptyDir
  - persistentVolumeClaim
  - projected
  - secret
```

1. SCC를 적용합니다:

   ```bash
   oc apply -f wandb-scc.yaml
   ```

2. SCC를 W&amp;B 서비스 계정에 바인딩합니다:

   ```bash
   oc adm policy add-scc-to-user wandb-scc -z wandb-app -n wandb
   oc adm policy add-scc-to-user wandb-scc -z wandb-console -n wandb
   ```

<div id="openshift-routes">
  ### OpenShift 라우트
</div>

OpenShift에서는 표준 Kubernetes Ingress 대신 Routes를 사용합니다. W&amp;B에서 OpenShift Routes를 사용하도록 구성합니다:

```yaml
spec:
  values:
    ingress:
      enabled: false
    
    route:
      enabled: true
      host: wandb.apps.openshift.yourdomain.com
      tls:
        enabled: true
        termination: edge
        insecureEdgeTerminationPolicy: Redirect
```

<div id="openshift-image-pull-configuration">
  ### OpenShift 이미지 pull 설정
</div>

OpenShift 클러스터에서 인증이 필요한 내부 이미지 레지스트리를 사용하는 경우에는:

1. 이미지 pull 시크릿을 생성합니다:

   ```bash
   kubectl create secret docker-registry wandb-registry-secret \
     --docker-server=registry.yourdomain.com \
     --docker-username=<username> \
     --docker-password=<password> \
     --namespace=wandb
   ```

2. Custom Resource에서 해당 시크릿을 참조합니다:

   ```yaml
   spec:
     values:
       imagePullSecrets:
         - name: wandb-registry-secret
   ```

<div id="openshift-complete-example">
  ### OpenShift 전체 예제
</div>

다음은 OpenShift 에어갭 배포를 위한 전체 CR 예제입니다:

<Note>
  이 예제에 있는 모든 `tag:` 값은 1단계에서 내부 레지스트리로 전송한 실제 버전으로 교체하십시오. 여기에 표시된 버전은 단순한 예시이며 시간이 지나면 최신이 아닐 수 있습니다.
</Note>

```yaml
apiVersion: apps.wandb.com/v1
kind: WeightsAndBiases
metadata:
  name: wandb
  namespace: wandb

spec:
  chart:
    url: https://charts.yourdomain.com
    name: operator-wandb
    version: 0.18.0

  values:
    global:
      host: https://wandb.apps.openshift.yourdomain.com
      license: <your-license>
      
      bucket:
        accessKey: <your-access-key>
        secretKey: <your-secret-key>
        name: s3.yourdomain.com:9000
        path: wandb
        provider: s3
        region: us-east-1
      
      mysql:
        database: wandb
        host: mysql.yourdomain.com
        password: <your-mysql-password>
        port: 3306
        user: wandb
      
      redis:
        host: redis.yourdomain.com
        port: 6379
        password: <your-redis-password>

    # OpenShift 전용: Ingress 대신 Routes 사용
    ingress:
      enabled: false
    
    route:
      enabled: true
      host: wandb.apps.openshift.yourdomain.com
      tls:
        enabled: true
        termination: edge

    # 내부 레지스트리용 이미지 풀 시크릿
    imagePullSecrets:
      - name: wandb-registry-secret

    # OpenShift 제한된 SCC에 대한 보안 컨텍스트
    app:
      image:
        repository: registry.yourdomain.com/wandb/local
        tag: 0.59.2
      podSecurityContext:
        fsGroup: 1000
        runAsUser: 1000
        runAsNonRoot: true
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault

    console:
      image:
        repository: registry.yourdomain.com/wandb/console
        tag: 2.12.2
      podSecurityContext:
        fsGroup: 1000
        runAsUser: 1000
        runAsNonRoot: true
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault

    # api, executor, glue, parquet, weave에 대한 보안 컨텍스트 반복
    # (간결성을 위해 생략)
```

<Note>
  보안 요구 사항에 맞는 포괄적인 OpenShift 설정 예제가 필요하면 [W&amp;B Support](mailto:support@wandb.com) 또는 배정된 W&amp;B 지원 엔지니어에게 문의하십시오.
</Note>

<div id="verify-your-installation">
  ## 설치 확인
</div>

W&amp;B를 배포한 후 설치가 제대로 작동하는지 확인하세요:

<SelfManagedVerifyInstallation />

<div id="additional-air-gapped-verification">
  ### 추가 에어갭 검증
</div>

에어갭 배포인 경우, 다음 항목도 함께 검증합니다:

1. **이미지 pull**: 모든 파드가 내부 레지스트리에서 이미지를 성공적으로 pull 했는지 확인합니다:

   ```bash
   kubectl get pods -n wandb -o jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.status.phase}{"\t"}{.status.containerStatuses[*].image}{"\n"}{end}'
   ```

   모든 이미지는 내부 레지스트리를 가리켜야 하며, 모든 파드는 `Running` 상태여야 합니다.

2. **외부 연결**: 에어갭 모드에서는 W&amp;B가 외부로 연결을 시도하지 않는지(원래 시도하지 않아야 합니다) 확인합니다:

   ```bash
   kubectl logs -n wandb deployment/wandb-app --tail=100 | grep -i "connection"
   ```

3. **라이선스 검증**: W&amp;B 콘솔에 접속해 라이선스가 활성 상태인지 확인합니다.

<div id="troubleshooting">
  ## 문제 해결
</div>

<div id="image-pull-errors">
  ### 이미지 pull 오류
</div>

Pod가 이미지를 가져오지 못하는 경우:

1. 내부 레지스트리에 이미지가 존재하는지 확인합니다.
2. image pull secret이 올바르게 구성되어 있는지 확인합니다.
3. Kubernetes 노드에서 레지스트리로의 네트워크 연결을 확인합니다.
4. 레지스트리 인증 자격 증명이 올바른지 확인합니다.

   ```bash
   # 이미지 pull을 수동으로 테스트
   kubectl run test-pull --image=registry.yourdomain.com/wandb/local:0.59.2 --namespace=wandb
   kubectl logs test-pull -n wandb
   kubectl delete pod test-pull -n wandb
   ```

<div id="openshift-scc-errors">
  ### OpenShift SCC 오류
</div>

OpenShift에서 파드가 권한 오류로 실패하는 경우:

```bash
# 사용 중인 SCC 확인
oc get pod <pod-name> -n wandb -o yaml | grep scc

# 서비스 계정 권한 확인
oc describe scc wandb-scc
oc get rolebinding -n wandb
```

<div id="helm-chart-not-found">
  ### Helm 차트를 찾을 수 없음
</div>

operator가 플랫폼 차트를 찾을 수 없는 경우에는 다음을 확인하세요.

1. Custom Resource에서 차트 리포지토리 URL을 확인합니다.
2. operator 파드가 내부 Helm 리포지토리에 접속할 수 있는지 확인합니다.
3. 리포지토리에 해당 차트가 존재하는지 확인합니다:

   ```bash
   helm search repo local-repo/operator-wandb
   ```

<div id="frequently-asked-questions">
  ## 자주 묻는 질문
</div>

<div id="can-i-use-a-different-ingress-class">
  ### 다른 인그레스 클래스를 사용할 수 있나요?
</div>

네, Custom Resource에서 인그레스 설정을 수정하여 인그레스 클래스를 설정하면 됩니다:

```yaml
spec:
  values:
    ingress:
      class: your-ingress-class
```

<div id="how-do-i-handle-certificate-bundles-with-multiple-certificates">
  ### 여러 개의 인증서가 포함된 인증서 번들은 어떻게 처리해야 하나요?
</div>

인증서를 `customCACerts` 섹션에서 여러 항목으로 나누어 설정하세요:

```yaml
spec:
  values:
    customCACerts:
      cert1.crt: |
        -----BEGIN CERTIFICATE-----
        ...
        -----END CERTIFICATE-----
      cert2.crt: |
        -----BEGIN CERTIFICATE-----
        ...
        -----END CERTIFICATE-----
```

<div id="how-do-i-prevent-automatic-updates">
  ### 자동 업데이트를 어떻게 방지하나요?
</div>

operator가 W&amp;B를 자동으로 업데이트하지 않도록 다음과 같이 구성합니다:

1. operator 설치 설정에서 `airgapped: true`로 지정합니다(자동 업데이트 확인이 비활성화됩니다).
2. Custom Resource에서 `spec.chart.version`을 수동으로 업데이트하여 버전 업데이트를 제어합니다.
3. 필요에 따라 W&amp;B System Console에서 자동 업데이트를 비활성화합니다.

자세한 내용은 [Disable automatic app version updates](/ko/platform/hosting/self-managed/disable-automatic-app-version-updates)를 참고하세요.

<Note>
  W&amp;B는 Self-Managed 인스턴스를 사용하는 고객이 지원을 유지하고 최신 기능, 성능 개선, 버그 수정을 받기 위해 최소 분기마다 한 번 이상 최신 릴리스로 배포를 업데이트할 것을 강력히 권장합니다. W&amp;B는 메이저 릴리스를 최초 출시일로부터 12개월 동안 지원합니다. [Release policies and processes](/ko/release-notes/release-policies)를 참고하세요.
</Note>

<div id="does-the-deployment-work-with-no-connection-to-public-repositories">
  ### 배포가 퍼블릭 리포지토리에 연결 없이도 작동하나요?
</div>

네. 오퍼레이터 설정에서 `airgapped: true`를 지정하면 Kubernetes 오퍼레이터는 내부 리소스만 사용하며 퍼블릭 리포지토리에 연결을 시도하지 않습니다.

<div id="how-do-i-update-wb-in-an-air-gapped-environment">
  ### 망 분리(air-gapped) 환경에서 W&amp;B를 어떻게 업데이트하나요?
</div>

W&amp;B를 업데이트하려면 다음을 수행합니다:

1. 인터넷에 연결된 시스템에서 새로운 컨테이너 이미지를 pull 합니다.
2. 이미지를 망 분리(air-gapped) 레지스트리로 전송합니다.
3. 새로운 Helm 차트를 내부 리포지토리에 업로드합니다.
4. Custom Resource에서 `spec.chart.version`과 이미지 태그를 업데이트합니다.
5. 업데이트된 Custom Resource를 적용합니다.

   그러면 오퍼레이터가 W&amp;B 컴포넌트에 대해 롤링 업데이트를 수행합니다.

<div id="next-steps">
  ## 다음 단계
</div>

배포를 성공적으로 완료한 후 다음 작업을 수행하세요:

1. **사용자 인증 구성**: [SSO](/ko/platform/hosting/iam/sso) 또는 기타 인증 방법을 설정합니다
2. **모니터링 설정**: W&amp;B 인스턴스와 인프라에 대한 모니터링을 구성합니다
3. **업데이트 계획 수립**: [서버 업그레이드 프로세스](/ko/platform/hosting/server-upgrade-process)를 검토하고 업데이트 주기를 수립합니다
4. **백업 구성**: MySQL 데이터베이스에 대한 백업 절차를 마련합니다
5. **프로세스 문서화**: 에어갭(air-gapped) 환경의 전용 업데이트 절차를 위한 런북(runbook)을 작성합니다

<div id="getting-help">
  ## 도움 받기
</div>

배포 중에 문제가 발생하면 다음을 수행하세요.

* 인프라 관련 지침은 [Reference Architecture](/ko/platform/hosting/self-managed/ref-arch)를 검토하세요
* 설정 세부 정보는 [Operator guide](/ko/platform/hosting/self-managed/operator)를 참고하세요
* [W&amp;B Support](mailto:support@wandb.com) 또는 배정된 W&amp;B 지원 엔지니어에게 문의하세요
* OpenShift 관련 문제의 경우 Red Hat OpenShift 문서를 참고하세요