---
title: fastai
---

import ApiKeyCreateStreamlined from "/snippets/ko/_includes/api-key-create-streamlined.mdx";

`WandbCallback` 클래스를 사용하여 **fastai**를 W&amp;B와 연동할 수 있습니다. 자세한 내용은 [예제가 포함된 대화형 문서](https://app.wandb.ai/borisd13/demo_config/reports/Visualize-track-compare-Fastai-models--Vmlldzo4MzAyNA)를 확인하세요.

<div id="sign-up-and-create-an-api-key">
  ## 회원가입 및 API 키 생성
</div>

API 키는 사용자의 컴퓨터를 W&amp;B에 인증하는 데 사용됩니다. 사용자 프로필에서 API 키를 생성할 수 있습니다.

<ApiKeyCreateStreamlined />

1. 오른쪽 상단에서 사용자 프로필 아이콘을 클릭합니다.
2. **User Settings**를 선택한 다음, 아래로 스크롤하여 **API Keys** 섹션으로 이동합니다.

<div id="install-the-wandb-library-and-log-in">
  ## `wandb` 라이브러리 설치 및 로그인
</div>

로컬 환경에서 `wandb` 라이브러리를 설치하고 로그인하려면:

<Tabs>
  <Tab title="Command Line">
    1. `WANDB_API_KEY` [환경 변수](/ko/models/track/environment-variables/)에 API 키를 설정합니다.

       ```bash
       export WANDB_API_KEY=<your_api_key>
       ```

    2. `wandb` 라이브러리를 설치한 뒤 로그인합니다.

       ```shell
       pip install wandb

       wandb login
       ```
  </Tab>

  <Tab title="Python">
    ```bash
    pip install wandb
    ```

    ```python
    import wandb
    wandb.login()
    ```
  </Tab>

  <Tab title="Python notebook">
    ```notebook
    !pip install wandb

    import wandb
    wandb.login()
    ```
  </Tab>
</Tabs>

<div id="add-the-wandbcallback-to-the-learner-or-fit-method">
  ## `learner` 또는 `fit` 메서드에 `WandbCallback` 추가하기
</div>

```python
import wandb
from fastai.callback.wandb import *

# wandb 실행 로깅 시작
wandb.init(project="my_project")

# 하나의 학습 단계에서만 로깅하려면
learn.fit(..., cbs=WandbCallback())

# 모든 학습 단계에서 지속적으로 로깅하려면
learn = learner(..., cbs=WandbCallback())
```

<Note>
  Fastai 1 버전을 사용하는 경우 [Fastai v1 문서](/ko/models/integrations/fastai/v1/)를 참고하세요.
</Note>

<div id="wandbcallback-arguments">
  ## WandbCallback 인수
</div>

`WandbCallback`은(는) 다음 인수들을 받습니다:

| Args                     | Description                                                                                                                                                                                                                                                  |
| ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| log                      | 모델의 `gradients`, `parameters`, `all` 또는 `None`(기본값)을 기록할지 여부입니다. loss와 metric은 항상 기록됩니다.                                                                                                                                 |
| log&#95;preds               | 예측 샘플을 기록할지 여부입니다(기본값은 `True`).                                                                                                                                                                                               |
| log&#95;preds&#95;every&#95;epoch | 예측을 매 epoch마다 기록할지, 아니면 마지막에만 기록할지 여부입니다(기본값은 `False`).                                                                                                                                                                                    |
| log&#95;model               | 모델을 기록할지 여부입니다(기본값은 `False`). 이 옵션을 사용하려면 `SaveModelCallback`도 필요합니다.                                                                                                                                                                  |
| model&#95;name              | 저장할 `file`의 이름입니다. `SaveModelCallback` 설정을 덮어씁니다.                                                                                                                                                                                                |
| log&#95;dataset             | <ul><li><code>False</code> (기본값)</li><li><code>True</code>로 설정하면 learn.dls.path가 가리키는 폴더를 기록합니다.</li><li>기록할 폴더를 지정하기 위해 경로를 명시적으로 설정할 수도 있습니다.</li></ul><p><em>참고: 하위 폴더 &quot;models&quot;는 항상 무시됩니다.</em></p> |
| dataset&#95;name            | 기록되는 데이터셋의 이름입니다(기본값은 `folder name`).                                                                                                                                                                                                           |
| valid&#95;dl                | 예측 샘플에 사용되는 항목을 포함하는 `DataLoaders`입니다(기본값은 `learn.dls.valid`에서 임의로 선택된 항목입니다).                                                                                                                                                  |
| n&#95;preds                 | 기록할 예측의 개수입니다(기본값은 36개).                                                                                                                                                                                                                |
| seed                     | 무작위 샘플을 정의할 때 사용됩니다.                                                                                                                                                                                                                            |

커스텀 워크플로우에서는 데이터셋과 모델을 수동으로 기록할 수 있습니다:

* `log_dataset(path, name=None, metadata={})`
* `log_model(path, name=None, metadata={})`

*참고: 하위 폴더 &quot;models&quot;는 모두 무시됩니다.*

<div id="distributed-training">
  ## 분산 학습
</div>

`fastai`는 컨텍스트 매니저 `distrib_ctx`를 사용해 분산 학습을 지원합니다. W&amp;B는 이를 자동으로 처리하여, 멀티 GPU 실험을 별도 설정 없이 바로 추적할 수 있습니다.

다음과 같은 최소 예제를 살펴보세요:

<Tabs>
  <Tab title="스크립트">
    ```python
    import wandb
    from fastai.vision.all import *
    from fastai.distributed import *
    from fastai.callback.wandb import WandbCallback

    wandb.require(experiment="service")
    path = rank0_first(lambda: untar_data(URLs.PETS) / "images")

    def train():
        dls = ImageDataLoaders.from_name_func(
            path,
            get_image_files(path),
            valid_pct=0.2,
            label_func=lambda x: x[0].isupper(),
            item_tfms=Resize(224),
        )
        wandb.init("fastai_ddp", entity="capecape")
        cb = WandbCallback()
        learn = vision_learner(dls, resnet34, metrics=error_rate, cbs=cb).to_fp16()
        with learn.distrib_ctx(sync_bn=False):
            learn.fit(1)

    if __name__ == "__main__":
        train()
    ```

    그런 다음 터미널에서 다음을 실행합니다:

    ```shell
    $ torchrun --nproc_per_node 2 train.py
    ```

    이 경우 머신에는 GPU가 2개 있습니다.
  </Tab>

  <Tab title="Python 노트북">
    이제 노트북 환경에서 바로 분산 학습을 실행할 수 있습니다.

    ```python
    import wandb
    from fastai.vision.all import *

    from accelerate import notebook_launcher
    from fastai.distributed import *
    from fastai.callback.wandb import WandbCallback

    wandb.require(experiment="service")
    path = untar_data(URLs.PETS) / "images"

    def train():
        dls = ImageDataLoaders.from_name_func(
            path,
            get_image_files(path),
            valid_pct=0.2,
            label_func=lambda x: x[0].isupper(),
            item_tfms=Resize(224),
        )
        wandb.init("fastai_ddp", entity="capecape")
        cb = WandbCallback()
        learn = vision_learner(dls, resnet34, metrics=error_rate, cbs=cb).to_fp16()
        with learn.distrib_ctx(in_notebook=True, sync_bn=False):
            learn.fit(1)

    notebook_launcher(train, num_processes=2)
    ```
  </Tab>
</Tabs>

<div id="log-only-on-the-main-process">
  ### 메인 프로세스에서만 로깅하기
</div>

위 예시에서 `wandb`는 프로세스마다 하나의 실행을 시작합니다. 학습이 끝나면 실행이 두 개 생기게 됩니다. 이는 가끔 혼란스러울 수 있어, 메인 프로세스에서만 로그를 남기고 싶을 수 있습니다. 그러려면 현재 코드가 어떤 프로세스에서 실행 중인지 수동으로 판별하고, 나머지 프로세스에서는 실행을 생성하지 않도록 해야 합니다(즉, 다른 모든 프로세스에서는 `wandb.init`를 호출하지 않아야 합니다).

<Tabs>
  <Tab title="스크립트">
    ```python
    import wandb
    from fastai.vision.all import *
    from fastai.distributed import *
    from fastai.callback.wandb import WandbCallback

    wandb.require(experiment="service")
    path = rank0_first(lambda: untar_data(URLs.PETS) / "images")

    def train():
        cb = []
        dls = ImageDataLoaders.from_name_func(
            path,
            get_image_files(path),
            valid_pct=0.2,
            label_func=lambda x: x[0].isupper(),
            item_tfms=Resize(224),
        )
        if rank_distrib() == 0:
            run = wandb.init("fastai_ddp", entity="capecape")
            cb = WandbCallback()
        learn = vision_learner(dls, resnet34, metrics=error_rate, cbs=cb).to_fp16()
        with learn.distrib_ctx(sync_bn=False):
            learn.fit(1)

    if __name__ == "__main__":
        train()
    ```

    터미널에서 다음을 실행합니다:

    ```
    $ torchrun --nproc_per_node 2 train.py
    ```
  </Tab>

  <Tab title="Python 노트북">
    ```python
    import wandb
    from fastai.vision.all import *

    from accelerate import notebook_launcher
    from fastai.distributed import *
    from fastai.callback.wandb import WandbCallback

    wandb.require(experiment="service")
    path = untar_data(URLs.PETS) / "images"

    def train():
        cb = []
        dls = ImageDataLoaders.from_name_func(
            path,
            get_image_files(path),
            valid_pct=0.2,
            label_func=lambda x: x[0].isupper(),
            item_tfms=Resize(224),
        )
        if rank_distrib() == 0:
            run = wandb.init("fastai_ddp", entity="capecape")
            cb = WandbCallback()
        learn = vision_learner(dls, resnet34, metrics=error_rate, cbs=cb).to_fp16()
        with learn.distrib_ctx(in_notebook=True, sync_bn=False):
            learn.fit(1)

    notebook_launcher(train, num_processes=2)
    ```
  </Tab>
</Tabs>

<div id="examples">
  ## 예시
</div>

* [Fastai 모델 시각화, 추적, 비교하기](https://app.wandb.ai/borisd13/demo_config/reports/Visualize-track-compare-Fastai-models--Vmlldzo4MzAyNA): 자세하게 정리된 단계별 안내입니다.
* [CamVid에서의 이미지 분할](https://bit.ly/fastai-wandb): 이 연동 기능의 예제 사용 사례입니다.