---
title: リファレンス アーキテクチャー
description: W&B リファレンス アーキテクチャー
menu:
  default:
    identifier: ja-guides-hosting-hosting-options-self-managed-ref-arch
    parent: self-managed
weight: 1
---

このページでは、W&B のデプロイメントのためのリファレンスアーキテクチャと、プロダクション環境におけるプラットフォーム運用を支える推奨インフラ・リソースについて解説します。

W&B の導入環境に応じて、デプロイメントの堅牢性を高めるさまざまなサービスを活用できます。

たとえば、主要なクラウドプロバイダーは、データベースの設定や保守、可用性向上、レジリエンスを簡素化できる堅牢なマネージドデータベースサービスを提供しています。

このリファレンスアーキテクチャでは、一般的なデプロイメントシナリオに対応し、W&B のデプロイメントとクラウドベンダー各社のサービスを統合して、パフォーマンスと信頼性を最大限に高める方法を紹介します。

## はじめに

プロダクション環境でアプリケーションを実行する場合、固有の課題に直面することがあります。W&B も例外ではありません。できるだけ運用を簡素化できるよう設計していますが、アーキテクチャや設計によっては複雑な点も発生します。通常、プロダクションデプロイメントでは、ハードウェア、オペレーティングシステム、ネットワーク、ストレージ、セキュリティ、W&B プラットフォームそのもの、およびその他依存コンポーネントの管理が必要です。この責任は、環境の初期セットアップだけでなく、継続的な運用・保守にも及びます。

W&B のセルフマネージド運用がご自身のチーム・要件に適しているか、慎重にご検討ください。

プロダクション品質のアプリケーション運用・保守に関する十分な知識が、セルフマネージド W&B の導入前に求められます。もしチームで支援が必要な場合は、当社プロフェッショナルサービスチームおよびパートナーが導入・最適化のサポートをいたします。

W&B の運用を自分で管理せず、マネージドソリューションを利用する場合は、[W&B Multi-tenant Cloud]({{< relref path="/guides/hosting/hosting-options/saas_cloud.md" lang="ja" >}}) や [W&B Dedicated Cloud]({{< relref path="/guides/hosting/hosting-options/dedicated_cloud.md" lang="ja" >}}) をご覧ください。

## インフラストラクチャ

{{< img src="/images/hosting/reference_architecture.png" alt="W&B インフラストラクチャ図" >}}

### アプリケーション層

アプリケーション層は、ノード障害にも強いマルチノード Kubernetes クラスターで構成されます。Kubernetes クラスターは W&B の各 Pod を実行・管理します。

### ストレージ層

ストレージ層は、MySQL データベースとオブジェクトストレージで構成されます。MySQL データベースはメタデータを格納し、オブジェクトストレージはモデルやデータセット等のアーティファクトを保存します。

## インフラ必須要件

### Kubernetes
W&B Server アプリケーションは [Kubernetes Operator]({{< relref path="kubernetes-operator/" lang="ja" >}}) として複数の Pod をデプロイします。そのため、W&B には次の条件を満たす Kubernetes クラスターが必要です。
- 正しく設定・動作している Ingress コントローラー
- Persistent Volume のプロビジョニングが可能であること

### MySQL
W&B はメタデータを MySQL データベースに保存します。データベースのパフォーマンスやストレージ要件は、モデルパラメータやメタデータの構造によって異なります。例えば、トレーニング run 数が増えるとデータベースサイズが成長し、run テーブルやユーザーワークスペース、レポートへのクエリ量に応じて負荷も増加します。

セルフマネージド MySQL データベースを導入する際は、次の点にご注意ください。

- **バックアップ**: データベースは定期的に別の設備へバックアップしましょう。W&B では最低1週間保持の毎日バックアップを推奨します。
- **パフォーマンス**: サーバーのディスクは高速である必要があります。SSDや高速 NAS での運用を推奨します。
- **モニタリング**: データベースの負荷監視が必要です。CPU 使用率が 5 分以上 40% を継続した場合、リソース不足の兆候です。
- **可用性**: 可用性・耐障害性要件によっては、更新内容をリアルタイムで複製するホットスタンバイ（待機系サーバー）を別マシン上に準備し、プライマリサーバー障害時のフェイルオーバーも検討してください。

### オブジェクトストレージ
W&B にはプリサイン付き URL と CORS サポートつきのオブジェクトストレージが必要です。次のいずれかのサービスを利用できます。

- [CoreWeave AI Object Storage](https://docs.coreweave.com/docs/products/storage/object-storage): AI ワークロードに最適化された高性能・S3互換のオブジェクトストレージ
- [Amazon S3](https://aws.amazon.com/s3/): スケーラビリティ、可用性、セキュリティ、パフォーマンスに優れたオブジェクトストレージ
- [Google Cloud Storage](https://cloud.google.com/storage): 大規模な非構造化データ向けのマネージドストレージサービス
- [Azure Blob Storage](https://azure.microsoft.com/products/storage/blobs): テキストやバイナリ、画像・動画・ログなど大量な非構造化データ向けクラウドベースストレージ
- S3互換ストレージ例: [MinIO](https://github.com/minio/minio)（パブリック/プライベートクラウド、自社インフラ上にホスト可能）

### バージョン
| ソフトウェア   | 最小バージョン                                 |
| -------------- | ---------------------------------------------- |
| Kubernetes     | v1.29                                          |
| MySQL          | v8.0.0、"General Availability"（正式版）のみ   |

### ネットワーク

ネットワークデプロイメントの場合、_インストール時・運用時_ の両方で次のエンドポイントへの外向き通信（egress）が必要です:
* https://deploy.wandb.ai
* https://charts.wandb.ai
* https://docker.io
* https://quay.io
* `https://gcr.io`

エアギャップ構成については [Kubernetes operator for air-gapped instances]({{< relref path="kubernetes-operator/operator-airgapped.md" lang="ja" >}}) をご覧ください。
実験のニーズを追跡する各システムおよびトレーニングインフラから、W&B 本体とオブジェクトストレージへのアクセスが必要です。

### DNS
W&B デプロイメントの FQDN（完全修飾ドメイン名）は、Aレコードで Ingress/ロードバランサーの IP アドレスに解決できる必要があります。

### SSL/TLS
W&B では安全なクライアント-サーバー通信のため、有効な署名済み SSL/TLS 証明書が必要です。SSL/TLS の終端処理は Ingress/ロードバランサー側で行います。W&B Server アプリケーション側では SSL/TLS 接続の終端処理は行いません。

ご注意：自己署名証明書や独自 CA の利用は推奨していません。

### 対応 CPU アーキテクチャ
W&B は Intel (x86) CPU アーキテクチャで動作します。ARM は非対応です。

## インフラのプロビジョニング
本番導入時には Terraform を用いたデプロイを推奨します。Terraform では、リソースや相互参照・依存関係をコードで定義します。W&B 公式の Terraform モジュールが主要クラウドプロバイダー向けに用意されています。詳細は [セルフマネージドクラウドアカウントでの W&B Server デプロイ]({{< relref path="/guides/hosting/hosting-options/self-managed.md#deploy-wb-server-within-self-managed-cloud-accounts" lang="ja" >}}) をご覧ください。

## サイジング
導入計画時のご参考として、以下の一般的なガイドラインをご確認ください。新規デプロイでは全コンポーネントを継続的に監視し、実際の利用状況をもとに随時調整してください。プロダクション運用開始後もパフォーマンス最適化のため、定期的な見直し・調整を継続しましょう。

### Models のみ

#### Kubernetes

| 環境           | CPU	            | メモリ	             | ディスク           | 
| -------------- | ------------------ | ------------------ | ------------------ | 
| テスト/開発    | 2コア              | 16 GB              | 100 GB             |
| 本番           | 8コア              | 64 GB              | 100 GB             |

上記は Kubernetes のワーカーノード1台あたりの構成例です。

#### MySQL

| 環境           | CPU	            | メモリ	             | ディスク           | 
| -------------- | ------------------ | ------------------ | ------------------ | 
| テスト/開発    | 2コア              | 16 GB              | 100 GB             |
| 本番           | 8コア              | 64 GB              | 500 GB             |

上記は MySQL ノード1台あたりの構成例です。

### Weave のみ

#### Kubernetes

| 環境           | CPU                | メモリ             | ディスク           | 
| -------------- | ------------------ | ------------------ | ------------------ | 
| テスト/開発    | 4コア              | 32 GB              | 100 GB             |
| 本番           | 12コア             | 96 GB              | 100 GB             |

上記は Kubernetes のワーカーノード1台あたりの構成例です。

#### MySQL

| 環境           | CPU                | メモリ             | ディスク           | 
| -------------- | ------------------ | ------------------ | ------------------ | 
| テスト/開発    | 2コア              | 16 GB              | 100 GB             |
| 本番           | 8コア              | 64 GB              | 500 GB             |

上記は MySQL ノード1台あたりの構成例です。

### Models + Weave

#### Kubernetes

| 環境           | CPU                | メモリ             | ディスク           | 
| -------------- | ------------------ | ------------------ | ------------------ | 
| テスト/開発    | 4コア              | 32 GB              | 100 GB             |
| 本番           | 16コア             | 128 GB             | 100 GB             |

上記は Kubernetes のワーカーノード1台あたりの構成例です。

#### MySQL

| 環境           | CPU                | メモリ             | ディスク           | 
| -------------- | ------------------ | ------------------ | ------------------ | 
| テスト/開発    | 2コア              | 16 GB              | 100 GB             |
| 本番           | 8コア              | 64 GB              | 500 GB             |

上記は MySQL ノード1台あたりの構成例です。

## クラウドプロバイダー別インスタンス推奨

### サービス対応

| クラウド     | Kubernetes	 | MySQL	                | オブジェクトストレージ     |   
| ------------ | ------------- | --------------------- | -------------------------- | 
| AWS          | EKS           | RDS Aurora            | S3                         |
| GCP          | GKE           | Google Cloud SQL - Mysql | Google Cloud Storage (GCS) |
| Azure        | AKS           | Azure Database for Mysql | Azure Blob Storage         |


### マシンタイプ

これらの推奨構成は、セルフマネージドで W&B をクラウド基盤に導入する場合の各ノードに適用されるものです。

#### AWS

| 環境         | K8s (Models のみ) | K8s (Weave のみ) | K8s (Models&Weave) | MySQL              |  
| ------------ | ----------------- | ---------------- | ------------------ | ------------------ |  
| テスト/開発  | r6i.large         | r6i.xlarge       | r6i.xlarge         | db.r6g.large       | 
| 本番         | r6i.2xlarge       | r6i.4xlarge      | r6i.4xlarge        | db.r6g.2xlarge     | 

#### GCP

| 環境         | K8s (Models のみ) | K8s (Weave のみ) | K8s (Models&Weave) | MySQL              |  
| ------------ | ----------------- | ---------------- | ------------------ | ------------------ |  
| テスト/開発  | n2-highmem-2      | n2-highmem-4     | n2-highmem-4       | db-n1-highmem-2    | 
| 本番         | n2-highmem-8      | n2-highmem-16    | n2-highmem-16      | db-n1-highmem-8    | 

#### Azure

| 環境         | K8s (Models のみ) | K8s (Weave のみ) | K8s (Models&Weave) | MySQL               |  
| ------------ | ----------------- | ---------------- | ------------------ | ------------------- |  
| テスト/開発  | Standard_E2_v5    | Standard_E4_v5   | Standard_E4_v5     | MO_Standard_E2ds_v4 | 
| 本番         | Standard_E8_v5    | Standard_E16_v5  | Standard_E16_v5    | MO_Standard_E8ds_v4 |
