---
title: リファレンス アーキテクチャー
description: W&B リファレンスアーキテクチャー
menu:
  default:
    identifier: ref-arch
    parent: self-managed
weight: 1
---

このページでは、W&B のリファレンスアーキテクチャーについて説明し、プラットフォームの本番環境デプロイに適した推奨インフラストラクチャーやリソース概要を示します。

W&B のデプロイメント環境の選択に応じて、様々なサービスがデプロイメントの堅牢性を高めるのに役立ちます。

例えば、大手クラウドプロバイダーは、データベースの構成、保守、高可用性、耐障害性を簡素化する強力なマネージドデータベースサービスを提供しています。

このリファレンスアーキテクチャーは、よくあるデプロイメントシナリオに対応しており、クラウドベンダーのサービスと連携することで W&B デプロイメントのパフォーマンスと信頼性を最適化する方法を示します。

## はじめに

本番環境でアプリケーションを運用する場合には、固有の課題が伴い、それは W&B でも例外ではありません。私たちはプロセスの簡素化を目指していますが、独自のアーキテクチャーや設計判断によっては複雑さが生じることもあります。一般的に、本番デプロイメントの管理には、ハードウェア、オペレーティングシステム、ネットワーク、ストレージ、セキュリティ、W&B プラットフォーム自体、その他依存関係など、さまざまなコンポーネントの管理が含まれます。この責任は、環境の初期セットアップだけでなく、運用中の保守にも及びます。

W&B のセルフマネージド運用がチームや特定の要件に合っているか、十分にご検討ください。

本番レベルのアプリケーションを運用・維持するための十分な知識は、セルフマネージド W&B をデプロイする前の重要な前提となります。もしチームで支援が必要な場合は、当社のプロフェッショナルサービスチームやパートナーが、導入や最適化のサポートを提供しています。

W&B を自分で管理せずに運用するマネージドソリューションについては、[W&B Multi-tenant Cloud]({{< relref "/guides/hosting/hosting-options/saas_cloud.md" >}}) や [W&B Dedicated Cloud]({{< relref "/guides/hosting/hosting-options/dedicated_cloud.md" >}}) をご参照ください。

## インフラストラクチャー

{{< img src="/images/hosting/reference_architecture.png" alt="W&B インフラストラクチャーダイアグラム" >}}

### アプリケーション層

アプリケーション層は、ノード障害時にも耐障害性を持つマルチノードの Kubernetes クラスターで構成されます。この Kubernetes クラスターにて W&B の各種 Pod が稼働・管理されます。

### ストレージ層

ストレージ層は、MySQL データベースとオブジェクトストレージで構成されます。MySQL データベースはメタデータを格納し、オブジェクトストレージはモデルやデータセットなどのアーティファクトを保存します。

## インフラストラクチャー要件

### Kubernetes
W&B Server アプリケーションは [Kubernetes Operator]({{< relref "kubernetes-operator/" >}}) としてデプロイされ、複数の Pod を展開します。そのため、以下を備えた Kubernetes クラスターが必要です：
- 完全に設定済みで機能する Ingress コントローラ
- 永続ボリュームのプロビジョニング機能

### MySQL
W&B はメタデータを MySQL データベースに保存します。データベースのパフォーマンスやストレージ要件は、モデルパラメータの種類や関連メタデータによって異なります。例えば、トレーニング run を多く追跡するとデータベースサイズが増え、run テーブルやユーザーワークスペース、レポートでのクエリによってデータベースの負荷が増大します。

セルフマネージドの MySQL データベースをデプロイする際は、以下をご検討ください：

- **バックアップ**：データベースを定期的に別の場所にバックアップしてください。W&B では毎日のバックアップと、最低１週間分の保持を推奨しています。
- **パフォーマンス**：サーバーが稼働するディスクは高速である必要があります。W&B では SSD またはアクセラレート NAS 上での運用を推奨します。
- **モニタリング**：負荷の監視も重要です。もし CPU 使用率が 5 分以上にわたりシステム全体の 40% を超える場合、リソース不足の兆候と考えられます。
- **可用性**：可用性や耐久性要件に応じて、すべての更新をリアルタイムでプライマリサーバーからストリーミングするホットスタンバイを別マシンに構成し、プライマリサーバー障害時にフェイルオーバーできるようにすることも推奨されます。

### オブジェクトストレージ
W&B では、事前署名付き URL と CORS 対応のオブジェクトストレージが必要です。以下のいずれかを利用できます：

- [CoreWeave AI Object Storage](https://docs.coreweave.com/docs/products/storage/object-storage)：AI ワークロードのための高性能、S3 互換オブジェクトストレージサービス
- [Amazon S3](https://aws.amazon.com/s3/)：業界トップレベルのスケーラビリティ、可用性、セキュリティ、パフォーマンスを持つオブジェクトストレージ
- [Google Cloud Storage](https://cloud.google.com/storage)：スケール可能な非構造化データのためのマネージドストレージサービス
- [Azure Blob Storage](https://azure.microsoft.com/products/storage/blobs)：大量の非構造化データ（テキスト、バイナリ、画像、動画、ログなど）のためのクラウドベース オブジェクトストレージ
- [MinIO](https://github.com/minio/minio) など、クラウドや自社インフラ上でホストする S3 互換ストレージ

### バージョン
| ソフトウェア    | 最小バージョン                                  |
| --------------- | ----------------------------------------------- |
| Kubernetes      | v1.29                                           |
| MySQL           | v8.0.0（"General Availability" リリースのみ）  |

### ネットワーキング

ネットワーク環境でのデプロイの場合、_インストール時とランタイムの両方で_ 以下エンドポイントへのアウトバウンド接続が必要です：
* https://deploy.wandb.ai
* https://charts.wandb.ai
* https://docker.io
* https://quay.io
* `https://gcr.io`

エアギャップ環境でのデプロイについては、[Kubernetes operator for air-gapped instances]({{< relref "kubernetes-operator/operator-airgapped.md" >}}) をご参照ください。
W&B およびオブジェクトストレージへのアクセスは、トレーニング用インフラストラクチャーと、実験の管理ニーズを満たす各システムに必要となります。

### DNS
W&B デプロイメントの完全修飾ドメイン名（FQDN）は、A レコードを使用して Ingress/ロードバランサーの IP アドレスに解決される必要があります。

### SSL/TLS
W&B では、クライアントとサーバー間の安全な通信のため、有効な署名付き SSL/TLS 証明書が必要です。SSL/TLS の終端処理は Ingress/ロードバランサー上で実施してください。W&B Server アプリケーション自体は、SSL または TLS コネクションを終端しません。

ご注意：W&B では、自己署名証明書やカスタム CA の利用は推奨していません。

### サポートされる CPU アーキテクチャー
W&B は Intel（x86）CPU アーキテクチャー上で動作します。ARM には対応していません。

## インフラストラクチャーのプロビジョニング
Terraform は、本番環境での W&B デプロイの推奨手法です。Terraform では必要なリソース、それらの相互参照や依存関係を定義できます。W&B は主要クラウドプロバイダー向けに Terraform モジュールを提供しています。詳細は [Deploy W&B Server within self managed cloud accounts]({{< relref "/guides/hosting/hosting-options/self-managed.md#deploy-wb-server-within-self-managed-cloud-accounts" >}}) をご参照ください。

## サイジング
デプロイメントを計画する際の出発点として、以下の一般的な指針を参考にしてください。新規デプロイメントでは全コンポーネントの監視を徹底し、実際の使用パターンに基づいて調整を行うことをおすすめします。本番運用中もパフォーマンスを維持するため、継続的な監視・調整を行ってください。

### Models のみ

#### Kubernetes

| 環境           | CPU	              | メモリ	          | ディスク              | 
| -------------- | ------------------ | ------------------ | ------------------ |
| テスト/開発    | 2 コア             | 16 GB              | 100 GB            |
| 本番           | 8 コア             | 64 GB              | 100 GB            |

数値は Kubernetes ワーカーノード 1 台ごとになります。

#### MySQL

| 環境           | CPU	              | メモリ	          | ディスク              | 
| -------------- | ------------------ | ------------------ | ------------------ |
| テスト/開発    | 2 コア             | 16 GB              | 100 GB            |
| 本番           | 8 コア             | 64 GB              | 500 GB            |

数値は MySQL ノード 1 台ごとになります。

### Weave のみ

#### Kubernetes

| 環境           | CPU                | メモリ             | ディスク              | 
| -------------- | ------------------ | ------------------ | ------------------ |
| テスト/開発    | 4 コア             | 32 GB              | 100 GB            |
| 本番           | 12 コア            | 96 GB              | 100 GB            |

数値は Kubernetes ワーカーノード 1 台ごとになります。

#### MySQL

| 環境           | CPU                | メモリ             | ディスク              | 
| -------------- | ------------------ | ------------------ | ------------------ |
| テスト/開発    | 2 コア             | 16 GB              | 100 GB            |
| 本番           | 8 コア             | 64 GB              | 500 GB            |

数値は MySQL ノード 1 台ごとになります。

### Models と Weave

#### Kubernetes

| 環境           | CPU                | メモリ             | ディスク              | 
| -------------- | ------------------ | ------------------ | ------------------ |
| テスト/開発    | 4 コア             | 32 GB              | 100 GB            |
| 本番           | 16 コア            | 128 GB             | 100 GB            |

数値は Kubernetes ワーカーノード 1 台ごとになります。

#### MySQL

| 環境           | CPU                | メモリ             | ディスク              | 
| -------------- | ------------------ | ------------------ | ------------------ |
| テスト/開発    | 2 コア             | 16 GB              | 100 GB            |
| 本番           | 8 コア             | 64 GB              | 500 GB            |

数値は MySQL ノード 1 台ごとになります。

## クラウドプロバイダー別インスタンス推奨例

### サービス

| クラウド      | Kubernetes    | MySQL                    | オブジェクトストレージ                |   
| ------------- | ------------- | ------------------------ | --------------------------------------| 
| AWS           | EKS           | RDS Aurora               | S3                                   |
| GCP           | GKE           | Google Cloud SQL - Mysql | Google Cloud Storage (GCS)            |
| Azure         | AKS           | Azure Database for Mysql | Azure Blob Storage                    |

### マシンタイプ

これらの推奨は、クラウドインフラ上における W&B セルフマネージドデプロイの各ノードに当てはまります。

#### AWS

| 環境         | K8s (Models のみ) | K8s (Weave のみ)  | K8s (Models&Weave) | MySQL               |  
| ------------ | ------------------ | ----------------- | -------------------| --------------------|
| テスト/開発  | r6i.large          | r6i.xlarge        | r6i.xlarge          | db.r6g.large         |
| 本番         | r6i.2xlarge        | r6i.4xlarge       | r6i.4xlarge         | db.r6g.2xlarge       |

#### GCP

| 環境         | K8s (Models のみ) | K8s (Weave のみ)  | K8s (Models&Weave) | MySQL                |  
| ------------ | ------------------ | ----------------- | -------------------| ---------------------|
| テスト/開発  | n2-highmem-2       | n2-highmem-4      | n2-highmem-4        | db-n1-highmem-2      |
| 本番         | n2-highmem-8       | n2-highmem-16     | n2-highmem-16       | db-n1-highmem-8      |

#### Azure

| 環境         | K8s (Models のみ) | K8s (Weave のみ)  | K8s (Models&Weave) | MySQL                   |  
| ------------ | ------------------ | ----------------- | -------------------| ------------------------|
| テスト/開発  | Standard_E2_v5     | Standard_E4_v5    | Standard_E4_v5       | MO_Standard_E2ds_v4     |
| 本番         | Standard_E8_v5     | Standard_E16_v5   | Standard_E16_v5      | MO_Standard_E8ds_v4     |
