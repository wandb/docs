---
title: パラメータの重要度
description: モデルのハイパーパラメーターと出力メトリクスの関係性を可視化する
menu:
  default:
    identifier: ja-guides-models-app-features-panels-parameter-importance
    parent: panels
weight: 60
---

あなたのハイパーパラメーターのうち、どれがメトリクスの望ましい値を予測するのに最も有効か、また高い相関があったかを明らかにしましょう。

{{< img src="/images/general/parameter-importance-1.png" alt="パラメータの重要度パネル" >}}

**相関** とは、ハイパーパラメーターと選択したメトリクス（この例では val_loss）との間の線形相関のことです。高い相関があるということは、ハイパーパラメーターの値が高くなるほどメトリクスも高くなり、その逆もまた成り立つことを意味します。相関は見るべき良いメトリクスですが、入力間の二次的な相互作用を捉えることができず、スケールが大きく異なる入力同士の比較では混乱を招くこともあります。

そのため、W&B では **重要度** メトリクスも計算します。W&B はハイパーパラメーターを入力、メトリクスを出力としてランダムフォレストを学習し、その特徴量重要度の値をレポートします。

この手法のアイディアは、[Jeremy Howard](https://twitter.com/jeremyphoward) 氏との会話から着想を得たものです。彼は [Fast.ai](https://fast.ai) でランダムフォレストの特徴量重要度を用いたハイパーパラメータ空間の探索を提唱しています。W&B ではこの [レクチャー](https://course18.fast.ai/lessonsml1/lesson4.html)（および [ノート](https://forums.fast.ai/t/wiki-lesson-thread-lesson-4/7540)）をぜひ参考にして、その背景にある動機を学ぶことをおすすめしています。

ハイパーパラメータ重要度パネルは、高い相関を持つハイパーパラメーター間の複雑な相互作用を整理してくれます。その結果、ハイパーパラメーター探索をよりきめ細かく調整でき、*どの* ハイパーパラメーターがモデルの性能予測に特に効いているかを知ることができます。

## ハイパーパラメータ重要度パネルの作成

1. ご自身の W&B Project にアクセスします。
2. **Add panels** ボタンを選択します。
3. **CHARTS** ドロップダウンを展開し、**Parallel coordinates** を選択します。

{{% alert %}}
パネルが空の場合は、runs がグループ化されていないか確認してください
{{% /alert %}}

{{< img src="/images/app_ui/hyperparameter_importance_panel.gif" alt="自動パラメーター可視化" >}}

パラメータマネージャでは、表示するパラメータと非表示にするパラメータを手動で設定可能です。

{{< img src="/images/app_ui/hyperparameter_importance_panel_manual.gif" alt="表示・非表示フィールドの手動設定" >}}

## ハイパーパラメータ重要度パネルの読み解き方

{{< img src="/images/general/parameter-importance-4.png" alt="特徴量重要度分析" >}}

このパネルでは、トレーニングスクリプト内で [wandb.Run.config]({{< relref path="/guides/models/track/config/" lang="ja" >}}) オブジェクトへ渡された全パラメータを表示します。続いて、これらの config パラメータと選択したモデルメトリクス（この例では `val_loss`）との特徴量重要度と相関を表示します。

### 重要度（Importance）

重要度カラムは、各ハイパーパラメーターが選択したメトリクスを予測するのにどれほど役立ったかを示します。多種類のハイパーパラメーターを一気にチューニングしつつ、このプロットでさらに深掘りすべきパラメータを絞り込み、次の sweep をより重要なパラメータに限定することで、より良いモデルを素早く低コストで見つける、といった使い方ができます。

{{% alert %}}
W&B は、線形モデルではなくツリーベースのモデルを使って重要度を算出しています。ツリーモデルはカテゴリカルデータや標準化されていないデータにも強い耐性があります。
{{% /alert %}}

上記の図では、`epochs`, `learning_rate`, `batch_size`, `weight_decay` がかなり重要であることが分かります。

### 相関（Correlations）

相関は、個別のハイパーパラメーターとメトリクス値との間の線形関係を捉えます。たとえば、SGD オプティマイザーを使うことで `val_loss` に有意な関係があるか（この例では「ある」）といった、ハイパーパラメーター使用とメトリクスとの関係性を明らかにします。相関値は -1 から 1 までで、プラスなら正の相関、マイナスなら負の相関、0 なら相関なしです。一般的には、絶対値で 0.7 を超えると強い相関とみなされます。

このグラフを使えば、メトリクスと高い相関がある値（この例なら stochastic gradient descent や adam など）をより詳しく探ったり、エポック数を増やしてみたり、といった追加の解析が可能です。

{{% alert %}}
* 相関は関連性の証拠であって、必ずしも因果を示すものではありません。
* 相関値は外れ値の影響を受けやすく、特にためしたハイパーパラメーターのサンプル数が少ない場合は強い関係が中程度に見えてしまうこともあります。
* そして、相関はハイパーパラメーターとメトリクスの間の線形関係しか捉えません。強い多項式的な関係があっても、それは相関値には表れません。
{{% /alert %}}

重要度と相関に差があるのは、重要度はハイパーパラメーター相互の影響も評価するのに対し、相関は各パラメータのメトリクスへの直接的な効果のみを見るためです。また、相関は線形関係しか捉えませんが、重要度はより複雑な関係性も捉えることができます。

ご覧のとおり、重要度と相関の両方がハイパーパラメーターがモデル性能にどう関与しているかを理解するための強力なツールとなります。