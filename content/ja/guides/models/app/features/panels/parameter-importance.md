---
title: パラメータの重要度
description: モデルのハイパーパラメーターと出力メトリクスの関係を可視化する
menu:
  default:
    identifier: parameter-importance
    parent: panels
weight: 60
---

あなたのハイパーパラメーターのうち、どれがメトリクスの望ましい値を最もよく予測したか、または強く相関していたかを調べることができます。

{{< img src="/images/general/parameter-importance-1.png" alt="パラメータの重要度パネル" >}}

**相関** とは、ハイパーパラメーターと選択したメトリクス（この例では val_loss）との線形的な関係を示します。したがって、相関が高い場合、ハイパーパラメーターの値が高いとメトリクスの値も高くなり、その逆も成り立ちます。相関はとても有用なメトリクスですが、入力変数間の2次的な相互作用を捉えることができず、異なるレンジの入力を比較するときは混乱が生じる場合があります。

そこで、W&B では **重要度** という指標も算出しています。W&B ではハイパーパラメーターを入力値、メトリクスをターゲット出力としてランダムフォレストをトレーニングし、その特徴量重要度をレポートします。

この手法のアイデアは、[Jeremy Howard](https://twitter.com/jeremyphoward) との会話が着想となっています。彼は [Fast.ai](https://fast.ai) でランダムフォレストの特徴量重要度を使ったハイパーパラメーター探索の先駆者です。W&B は、この [講義](https://course18.fast.ai/lessonsml1/lesson4.html) や [ノート](https://forums.fast.ai/t/wiki-lesson-thread-lesson-4/7540) を参考にして、この分析の背景やモチベーションを学ぶことをおすすめします。

ハイパーパラメーターの重要度パネルは、強い相関のあるハイパーパラメーター間の複雑な相互作用を解きほぐします。これにより、ハイパーパラメーターのなかでどれがモデル性能の予測に最も影響するかを可視化し、より効果的なチューニングを支援します。

## ハイパーパラメーター重要度パネルの作成方法

1. W&B のプロジェクトに移動します。
2. **Add panels** ボタンを選択します。
3. **CHARTS** ドロップダウンを展開し、**Parallel coordinates** を選びます。

{{% alert %}}
パネルが空の場合は、run がグループ化されていないか確認してください。
{{% /alert %}}

{{< img src="/images/app_ui/hyperparameter_importance_panel.gif" alt="パラメータ自動可視化" >}}

パラメータマネージャーで可視・非表示のパラメータを手動で設定できます。

{{< img src="/images/app_ui/hyperparameter_importance_panel_manual.gif" alt="表示・非表示フィールドの手動設定" >}}

## ハイパーパラメーター重要度パネルの読み解き方

{{< img src="/images/general/parameter-importance-4.png" alt="特徴量重要度分析" >}}

このパネルは、トレーニングスクリプト内で [wandb.Run.config]({{< relref "/guides/models/track/config/" >}}) オブジェクトに渡したすべてのパラメータを表示します。次に、これらの config パラメータと、選択したモデルメトリクス（この例では `val_loss`）との特徴量重要度と相関を示します。

### 重要度

重要度カラムは、各ハイパーパラメーターが選択したメトリクスを予測するのにどれだけ役立ったかを示しています。例えば、多数のハイパーパラメーターをチューニングし、その中でどれをさらに調査すべきかをこのグラフで特定することができます。その後の sweep では最も重要なハイパーパラメーターに絞って探索できるため、より良いモデルをより早く、そして安価に見つけることができます。

{{% alert %}}
W&B は線形モデルよりも、カテゴリカルデータや正規化されていないデータへの耐性が高いツリーベースモデル（決定木系モデル）で重要度を計算しています。
{{% /alert %}}

前述の画像では、`epochs`, `learning_rate`, `batch_size`, `weight_decay` が比較的重要なパラメータだったことが分かります。

### 相関

相関は、各ハイパーパラメーターとメトリクスの値との線形的な関係を示します。例えば、SGD オプティマイザーのような特定のハイパーパラメータを使ったときに、`val_loss` と有意な関係があるかどうか（この例では「ある」）を調べることができます。相関値は -1 から 1 までで、正の値は正の線形相関、負の値は負の線形相関、0 だと相関なしを意味します。一般に、0.7 を超える相関係数値（正・負問わず）は強い相関を示します。

このグラフを使って、メトリクスとの相関が高い値（この例では確率的勾配降下法や adam など）や、より多くのエポックでのトレーニングを検討することができます。

{{% alert %}}
* 相関はあくまでも関連を示すもので、必ずしも因果関係を示すものではありません。
* 相関は外れ値に影響を受けやすく、特に試したハイパーパラメータのサンプル数が少ないと、強い関係が中程度に見えてしまうことがあります。
* また、相関はハイパーパラメーターとメトリクス間の線形関係のみを捉えるため、強い多項式的関係があっても相関として現れません。
{{% /alert %}}

重要度と相関値に差が出るのは、重要度はハイパーパラメーター間の相互作用も考慮しているのに対し、相関は各ハイパーパラメーター単体でメトリクスへの影響を測っているためです。また、相関は線形関係しか識別できませんが、重要度はより複雑な関係性も捉えることができます。

ご覧のとおり、重要度と相関はどちらもハイパーパラメーターがモデル性能にどのように影響するかを理解するための強力なツールです。