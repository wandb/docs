---
title: パラメータの重要度
description: モデルのハイパーパラメーターと出力メトリクスの関係を可視化する
menu:
  default:
    identifier: ja-guides-models-app-features-panels-parameter-importance
    parent: panels
weight: 60
---

メトリクスの望ましい 値 を最もよく予測し、高い相関を持っていたハイパーパラメーターがどれかを見つけましょう。

{{< img src="/images/general/parameter-importance-1.png" alt="パラメータの重要度 パネル" >}}

**相関** は、ハイパーパラメーターと選択したメトリクス（この例では `val_loss`）の間の線形相関を表します。相関が高いということは、ハイパーパラメーターの 値 が高いときにメトリクスの 値 も高くなる（その逆も同様）ことを意味します。相関は有用なメトリクスですが、入力間の 2 次の相互作用は捉えられず、スケールが大きく異なる入力同士の比較は複雑になりがちです。

そのため W&B は **重要度** というメトリクスも計算します。W&B はハイパーパラメーターを入力、メトリクスを目的出力としてランダムフォレストを学習し、そのランダムフォレストの特徴量の重要度をレポートします。

この手法のアイデアは、ランダムフォレストの特徴量重要度を使ってハイパーパラメータ空間を探索する手法を先駆けた [Jeremy Howard](https://twitter.com/jeremyphoward) との会話に着想を得ています。W&B は、この 分析 の背景にある動機を学ぶために、この [講義](https://course18.fast.ai/lessonsml1/lesson4.html)（およびこの [ノート](https://forums.fast.ai/t/wiki-lesson-thread-lesson-4/7540)）を強くおすすめします。

ハイパーパラメータの重要度 パネルは、高い相関を持つハイパーパラメーター間の複雑な相互作用を解きほぐします。これにより、モデル性能の予測という観点でどのハイパーパラメーターが最も重要かを示し、ハイパーパラメーター探索をよりうまく チューニング できるようにします。

## ハイパーパラメータの重要度 パネルを作成する

1. W&B の プロジェクト に移動します。
2. ボタン **Add panels** を選択します。
3. **CHARTS** ドロップダウンを開き、**Parallel coordinates** を選びます。

{{% alert %}}
空のパネルが表示される場合は、run がグループ化されていないことを確認してください
{{% /alert %}}

{{< img src="/images/app_ui/hyperparameter_importance_panel.gif" alt="パラメータの自動 可視化" >}}

パラメータマネージャーを使うと、表示するパラメータと非表示にするパラメータを手動で設定できます。

{{< img src="/images/app_ui/hyperparameter_importance_panel_manual.gif" alt="表示と非表示のフィールドを手動で設定" >}}

## ハイパーパラメータの重要度 パネルの読み方

{{< img src="/images/general/parameter-importance-4.png" alt="特徴量の重要度 分析" >}}

このパネルには、トレーニングスクリプト 内で [wandb.Run.config]({{< relref path="/guides/models/track/config/" lang="ja" >}}) オブジェクトに渡されたすべてのパラメータが表示されます。次に、選択したモデルのメトリクス（この例では `val_loss`）に対する、これら設定パラメータの特徴量の重要度と相関が表示されます。

### 重要度

重要度 列は、選んだメトリクスの予測に各ハイパーパラメーターがどの程度有用だったかを示します。多数のハイパーパラメーターの チューニング を始め、このプロットを使ってさらに探る価値のあるものに絞り込む場面を想像してください。その後の Sweeps は最も重要なハイパーパラメーターに限定でき、より良い モデル をより速く、低コストで見つけられます。

{{% alert %}}
W&B は、線形モデルではなく木（決定木）ベースのモデルを用いて重要度を計算します。木ベースのモデルのほうが、カテゴリカル データ や正規化されていない データ に対して寛容だからです。
{{% /alert %}}

前の画像では、`epochs, learning_rate, batch_size` および `weight_decay` が比較的重要であることがわかります。

### 相関

相関は、個々のハイパーパラメーターとメトリクスの値との間の線形関係を捉えます。たとえば SGD オプティマイザーの使用と `val_loss` の間に有意な関係があるか（この例では「ある」）という問いに答えます。相関は -1 から 1 の範囲をとり、正の値は正の線形相関、負の値は負の線形相関、0 は相関なしを表します。一般に、絶対値が 0.7 を超えると強い相関とみなされます。

このグラフを使って、メトリクスと相関が高い 値 をさらに探る（この例では、rmsprop や nadam よりも SGD（stochastic gradient descent）や adam を選ぶ）あるいは、より多くのエポックで学習する、といった判断ができます。

{{% alert %}}
* 相関は関連の証拠を示すものであり、必ずしも因果を意味しません。
* 相関は外れ値に敏感です。特に試したハイパーパラメーターのサンプル数が小さい場合、強い関係が中程度に見えてしまうことがあります。
* 最後に、相関はハイパーパラメーターとメトリクスの線形関係しか捉えません。強い多項式的な関係があっても、相関では捉えられません。
{{% /alert %}}

重要度と相関の違いは、重要度がハイパーパラメーター間の相互作用を考慮する一方で、相関は個々のハイパーパラメーターがメトリクスの値に及ぼす影響だけを測ることに由来します。さらに、相関が捉えるのは線形関係だけですが、重要度はより複雑な関係も捉えられます。

ご覧のとおり、重要度と相関はいずれも、ハイパーパラメーターがモデルの性能にどのように影響するかを理解するための強力な ツール です。